import{s as P}from"./index-DFZh32pl.js";import{i as K,r as D,R as G,n as V,q as N,v as n,f as l,x as y,C as E,N as Y,K as w,L as j,c as _,w as ee,B as R,F as B,A,y as J,O as ae,z as x,W as L}from"./index-C2be9rQA.js";import{v as le}from"./v4-CQkTLCs1.js";import{V as p,d as S,e as te}from"./VContainer-DsKJp95U.js";import{a as F,V as q}from"./VToolbar-1nvAAjx6.js";import{V as H}from"./scopeId-PTROHj70.js";import{V as Q}from"./VToolbarItems-CF4RUgiK.js";import{V as ne,a as M}from"./VRow-gKmD3Obl.js";import{V as W}from"./VTextField-DFkSeFBJ.js";import{c as X,e as Z}from"./VCard-lbrzBylh.js";import{a as oe}from"./VList-BSiSbCAy.js";import{V as ie}from"./VDivider-CVpoQYAf.js";import{V as se}from"./VAutocomplete-CD7TkQgJ.js";import{V as ue}from"./VDialog-Bf56H1qk.js";import{s as z,a as re,m as de}from"./FormRenderer.vue_vue_type_style_index_0_lang-muOh0nm8.js";import{V as ve,a as me,b as fe,c as ce}from"./VExpansionPanels-Vjk1kE5T.js";var v=(e=>(e[e.UNKNOWN=0]="UNKNOWN",e[e.JSON=1]="JSON",e[e.TAG=2]="TAG",e[e.STRING=3]="STRING",e[e.UUID_ARRAY=4]="UUID_ARRAY",e))(v||{});const ge=K({__name:"AddTag",props:{convention:{},organisation:{}},emits:["save","close"],setup(e,{emit:O}){const r=D(""),i=D("");typeof e.convention=="object"?(r.value=e.convention.ConventionUUID,i.value=e.convention.OrganisationUUID):r.value=e.convention||"",typeof e.organisation=="object"?i.value=e.organisation.OrganisationUUID:i.value.length===0&&(i.value=e.organisation||"");const d=O,g=D({ID:0,TagUUID:le(),ConventionID:0,ConventionUUID:r.value||G,OrganisationID:0,OrganisationUUID:i.value||G,Title:"",Key:""}),U=Y(),T=()=>{U.saveTag(g.value).then(c=>{c&&(g.value=c,d("save",c),d("close"))})};return(c,s)=>(V(),N(Z,null,{default:n(()=>[l(q,{dark:"",color:"primary"},{default:n(()=>[l(p,{icon:"",dark:"",onClick:s[0]||(s[0]=a=>d("close"))},{default:n(()=>[l(S,null,{default:n(()=>s[3]||(s[3]=[y("mdi:mdi-close")])),_:1})]),_:1}),l(F,null,{default:n(()=>s[4]||(s[4]=[y("Add Tag")])),_:1}),l(H),l(Q,null,{default:n(()=>[l(p,{variant:"text",onClick:T},{default:n(()=>s[5]||(s[5]=[y(" Save ")])),_:1})]),_:1})]),_:1}),l(X,null,{default:n(()=>[l(te,{fluid:!0},{default:n(()=>[l(ne,null,{default:n(()=>[l(M,{cols:"12"},{default:n(()=>[l(W,{label:E(P).formLabelDisplayName,type:"text",variant:"outlined",modelValue:g.value.Title,"onUpdate:modelValue":s[1]||(s[1]=a=>g.value.Title=a)},null,8,["label","modelValue"])]),_:1}),l(M,{cols:"12"},{default:n(()=>[l(W,{label:E(P).formLabelTagKey,type:"text",variant:"outlined",modelValue:g.value.Key,"onUpdate:modelValue":s[2]||(s[2]=a=>g.value.Key=a)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}))}}),$e=K({__name:"SelectTags",props:w({convention:{},organisation:{},chips:{type:Boolean,default:!1},clearable:{type:Boolean,default:!1},hint:{default:""},label:{},variant:{},showKey:{type:Boolean,default:!1},showUuid:{type:Boolean,default:!1},inputType:{default:()=>v.UNKNOWN}},{modelValue:{required:!0},modelModifiers:{}}),emits:w(["change"],["update:modelValue"]),setup(e,{emit:O}){const r=j(e,"modelValue"),i=O,d=D([]),g=Y(),U=D([]),T=D([]),c=D(""),s=D(""),a=D(v.UNKNOWN),m=_(()=>[...U.value,...T.value].map(u=>({title:`${u.Title}${e.showKey?` [ ${u.Key} ]`:""}${e.showUuid?` (${u.TagUUID})`:""}`,value:d.value.find(t=>t&&t.TagUUID&&t.TagUUID===u.TagUUID)||u})));typeof e.convention=="object"?(c.value=e.convention.ConventionUUID,s.value=e.convention.OrganisationUUID):c.value=e.convention||"",typeof e.organisation=="object"?s.value=e.organisation.OrganisationUUID:s.value.length===0&&(s.value=e.organisation||""),(async()=>{const o=[];c.value&&o.push(g.getConventionTags(c.value)),s.value&&o.push(g.getOrganisationTags(s.value));const u=await Promise.all(o);if(c.value&&s.value?(T.value=u[0].sort((t,f)=>t.Title.localeCompare(f.Title)),U.value=u[1].sort((t,f)=>t.Title.localeCompare(f.Title))):c.value&&u.length==1?T.value=u[0].sort((t,f)=>t.Title.localeCompare(f.Title)):s.value&&u.length==1&&(U.value=u[0].sort((t,f)=>t.Title.localeCompare(f.Title))),e.inputType===v.TAG||e.inputType===v.UNKNOWN&&Array.isArray(r.value))a.value=v.TAG,m.value.forEach(t=>{Array.isArray(r.value)&&r.value.find(b=>b.TagUUID===t.value.TagUUID)&&d.value.push(t.value)});else if(e.inputType===v.JSON||e.inputType===v.UNKNOWN&&typeof r.value=="string"){a.value=v.JSON;try{const t=JSON.parse(r.value);m.value.forEach(f=>{t.find(k=>k.TagUUID===f.value.TagUUID)&&d.value.push(f.value)})}catch{}}else if(e.inputType===v.UUID_ARRAY){a.value=v.UUID_ARRAY;try{const t=r.value,f=[...U.value,...T.value];d.value=t.map(b=>f.find(k=>k.TagUUID==b))}catch{}}else if(e.inputType===v.STRING){a.value=v.STRING;try{if(typeof r.value!="string")return;const t=JSON.parse(r.value),f=[...U.value,...T.value];d.value=t.map(b=>f.find(k=>k.TagUUID==b))}catch{}}})();const I=D(!1),h=()=>{I.value=!0},C=o=>{o.ConventionUUID.length>0?T.value.push(o):o.OrganisationUUID.length>0&&U.value.push(o),d.value.push(o),$()},$=()=>{switch(a.value){default:case v.TAG:{r.value=d.value,i("change");break}case v.JSON:{r.value=JSON.stringify(d.value),i("change");break}case v.STRING:{r.value=JSON.stringify(d.value.map(o=>o&&o.TagUUID?o.TagUUID:"")),i("change");break}case v.UUID_ARRAY:{r.value=d.value.map(o=>o&&o.TagUUID?o.TagUUID:""),i("change");break}}};return ee(d,$),(o,u)=>(V(),R(B,null,[l(se,{modelValue:d.value,"onUpdate:modelValue":u[1]||(u[1]=t=>d.value=t),chips:o.chips,multiple:"",label:o.label||"Tags",variant:o.variant||"solo",hint:o.hint,"persistent-hint":!0,clearable:o.clearable,items:m.value,"item-title":"title","item-value":"value"},{"prepend-item":n(()=>[l(oe,{title:"New Tag",onClick:u[0]||(u[0]=t=>h())},{prepend:n(()=>[l(S,{icon:"mdi:mdi-plus"})]),_:1}),l(ie,{class:"mt-2"})]),_:1},8,["modelValue","chips","label","variant","hint","clearable","items"]),l(ue,{modelValue:I.value,"onUpdate:modelValue":u[3]||(u[3]=t=>I.value=t),scrollable:!0},{default:n(()=>[l(ge,{convention:o.convention,organisation:o.organisation,onClose:u[2]||(u[2]=t=>I.value=!1),onSave:C},null,8,["convention","organisation"])]),_:1},8,["modelValue"])],64))}}),Re=K({__name:"EditOrderedItems",props:w({closeable:{type:Boolean,default:!1},showDelete:{type:Boolean,default:!0},hasOrder:{type:Boolean,default:!0},newItem:{type:[Function,Boolean]},label:{default:"Name"},labelParent:{default:""},title:{default:"Edit Ordered Items"},showSave:{type:Boolean,default:!1},slotNamePrefix:{default:"item"}},{modelValue:{required:!0},modelModifiers:{}}),emits:w(["add","save","close"],["update:modelValue"]),setup(e,{emit:O}){const r=O,i=j(e,"modelValue"),d=()=>{r("save"),r("close")},g=()=>{if(e.newItem){let a;e.hasOrder?(a=e.newItem(),a.Order=i.value.length+1):a=e.newItem(),i.value.push(a)}else e.hasOrder?i.value.push({ID:0,Order:i.value.length+1}):i.value.push({ID:0})},U=a=>{i.value.splice(a,1)},T=a=>{re(a,i.value)},c=a=>{de(a,i.value)},s=a=>e.labelParent&&a[e.labelParent]?a[e.labelParent][e.label]:a[e.label];return i.value.find(a=>a.Order===0)&&z(i.value),i.value.find(a=>i.value.find(m=>m.Order===a.Order&&m!==a))&&z(i.value),(a,m)=>(V(),N(Z,null,{default:n(()=>[l(q,{dark:"",color:"primary"},{default:n(()=>[a.closeable?(V(),N(p,{key:0,icon:"",dark:"",onClick:m[0]||(m[0]=I=>r("close"))},{default:n(()=>[l(S,null,{default:n(()=>m[1]||(m[1]=[y("mdi:mdi-close")])),_:1})]),_:1})):A("",!0),l(F,null,{default:n(()=>[y(J(a.title),1)]),_:1}),l(H),l(Q,null,{default:n(()=>[a.newItem!==void 0?(V(),N(p,{key:0,variant:"text",onClick:g},{default:n(()=>m[2]||(m[2]=[y(" Add ")])),_:1})):A("",!0),a.showSave?(V(),N(p,{key:1,variant:"text",onClick:d},{default:n(()=>m[3]||(m[3]=[y(" Save ")])),_:1})):A("",!0)]),_:1})]),_:1}),l(X,{class:"pa-0"},{default:n(()=>[l(ve,null,{default:n(()=>[(V(!0),R(B,null,ae(i.value,(I,h)=>(V(),N(me,{key:I.ID,class:"mt-0"},{default:n(()=>[l(fe,null,{actions:n(({expanded:C})=>[a.showDelete?(V(),N(p,{key:0,icon:"mdi:mdi-close",size:"x-small",color:"red",class:"mr-1",onClick:$=>U(h)},null,8,["onClick"])):A("",!0),l(S,{class:"align-self-center text-h5",icon:C?"mdi:mdi-chevron-up":"mdi:mdi-chevron-down",variant:"flat",size:"x-small"},null,8,["icon"])]),default:n(()=>[a.hasOrder?(V(),R(B,{key:0},[l(p,{icon:"mdi:mdi-menu-up",size:"x-small",color:"primary",class:"mr-1",onClick:x(C=>c(I),["stop"])},null,8,["onClick"]),l(p,{icon:"mdi:mdi-menu-down",size:"x-small",color:"secondary",class:"mr-4",onClick:x(C=>T(I),["stop"])},null,8,["onClick"])],64)):A("",!0),L(a.$slots,`${a.slotNamePrefix}_${h}_title`,{},()=>[y(J(s(I)),1)])]),_:2},1024),l(ce,{class:"px-0"},{default:n(()=>[L(a.$slots,`${a.slotNamePrefix}_${h}`)]),_:2},1024)]),_:2},1024))),128))]),_:3})]),_:3})]),_:3}))}});export{v as I,$e as _,Re as a};
