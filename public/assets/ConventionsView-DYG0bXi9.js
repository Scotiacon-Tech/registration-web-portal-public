import{F as Y}from"./form-Cqw16b_M.js";import{P as H}from"./permission-Ba-8wP-4.js";import{i as B,M as G,N as q,r as f,l as z,n as a,q as s,v as o,f as l,A as v,x as D,y as j,F as E,G as Q,D as O,P as M,w as J,U as K,Q as W,H as X,V as Z}from"./index-CKB4TnKb.js";import{u as ee}from"./useStoreAPI-DhmCstio.js";import{_ as te}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-Ba2wt0tZ.js";import{E as oe}from"./EditConventionDialog-DKwuGSce.js";import{G as h}from"./group-Dg_peWef.js";import{C as P}from"./canDo-BwtnSX1y.js";import{C as ne}from"./canEditRegistrations-BlgXo3U5.js";import{C as ae}from"./canViewOperations-B4lcDGNX.js";import{G as b}from"./userData-C9aLtvAh.js";import{u as ie}from"./useAdvancedMode-Ipo1dppG.js";import{V as le,a as se,b as re,c as $,d as ue,e as de}from"./VCard-CH352nYW.js";import{V as ve}from"./forwardRefs-K-nQ9nT4.js";import{V as w,e as me}from"./VContainer-DO5312cJ.js";import{V as A,a as x}from"./VRow-B_xC0EDX.js";import{_ as F}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{C as pe}from"./canEditOrganisation-DAzNfH9H.js";import{v as fe}from"./v4-CQkTLCs1.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-DARxWqPW.js";import"./VOverlay-Bo0agEAJ.js";import"./scopeId-C9O_eJsl.js";import"./createSimpleFunctional-Bbwnoz7X.js";import"./layout-Bh3YHkaV.js";import"./VTextField-D0HqGk-L.js";import"./form-5uxQzLj5.js";import"./VDialog-DSNC5Snz.js";import"./ModelDialog.vue_vue_type_script_setup_true_lang-D2OOfbML.js";import"./VToolbar-BGm-KrXg.js";import"./index-fwfMqYug.js";import"./VTextarea-CAr9aiXI.js";import"./VCheckbox-BJSLivSf.js";import"./VCheckboxBtn-VCZ8pC9W.js";import"./VForm-Df8efMuM.js";import"./VFileInput-CRa5-Zat.js";import"./VChip-h4PodwTt.js";const ce=(C=void 0,c=void 0)=>C===void 0?!1:c===void 0?P(C,h.GROUP_TYPE_CONVENTION).EditConvention:P(C,h.GROUP_TYPE_CONVENTION,c.ConventionUUID,c).EditConvention,Ce=(C,c)=>C===void 0?!1:P(C,h.GROUP_TYPE_CONVENTION,c.ConventionUUID,c).ViewRegistration,ge=["innerHTML"],De={key:0,class:"text-green"},_e={key:1,class:"text-red"},Ue={key:0,class:"text-green"},Ve={key:1,class:"text-red"},Ie=B({__name:"ConventionCard",props:G({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:G(["delete","duplicated"],["update:modelValue"]),setup(C,{emit:c}){const R=M(),_=c,e=q(C,"modelValue"),m=ee(),U=b(),V=f(m.GetConventionLogoURL(e.value.ConventionUUID)),k=f(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),I=ie(),g=f(!1),y=f(!1),T=f(ce(U,e.value)),L=f(ne(U,e.value)),S=f(Ce(U,e.value)),i=f(ae(U,e.value)),n=()=>{y.value=!1,V.value=`${m.GetConventionLogoURL(e.value.ConventionUUID)}?ts=${Date.now()}`},r=u=>{R.deleteConvention(e.value.ConventionUUID).then(t=>{t?u&&(u("Convention Deleted"),_("delete")):u&&u("Failed to Delete Convention"),setTimeout(()=>{g.value=!1},2e3)}).catch(()=>{u&&(u("Failed to Delete Organisation"),g.value=!1)})},p=()=>{R.duplicateConvention(e.value.ConventionUUID).then(u=>{u&&_("duplicated",u)})};return(u,t)=>{const d=z("RouterLink");return a(),s(de,null,{default:o(()=>[l(le,{class:"flex-1-1 align-content-start"},{default:o(()=>[V.value?(a(),s(ve,{key:0,src:V.value,title:e.value.Name,class:"logo text-center"},null,8,["src","title"])):v("",!0),e.value.Name?(a(),s(se,{key:1},{default:o(()=>[D(j(e.value.Name)+" ",1),T.value&&E(I)?(a(),s(w,{key:0,class:"float-right",icon:"mdi:mdi-content-duplicate",size:"small",title:"Duplicate Convention Structure",variant:"flat",onClick:p})):v("",!0)]),_:1})):v("",!0),e.value.Description?(a(),s(re,{key:2,class:"text-wrap subtitle"},{default:o(()=>[Q("div",{innerHTML:e.value.Description},null,8,ge)]),_:1})):v("",!0),l($,{class:"px-0 pb-0"},{default:o(()=>[t[5]||(t[5]=D(" Visibility:  ")),e.value.Visible?(a(),O("span",De,"Visible")):(a(),O("span",_e,"Hidden"))]),_:1}),l($,{class:"px-0 pb-0"},{default:o(()=>[t[6]||(t[6]=D(" Registration:  ")),u.open?(a(),O("span",Ue,"Open")):(a(),O("span",Ve,"Closed"))]),_:1})]),_:1}),l(ue,null,{default:o(()=>[l(A,{"no-gutters":""},{default:o(()=>[T.value?(a(),s(x,{key:0,class:"ma-1"},{default:o(()=>[l(w,{variant:"tonal",color:"primary",onClick:t[0]||(t[0]=N=>y.value=!0),width:"100%"},{default:o(()=>t[7]||(t[7]=[D("Edit")])),_:1})]),_:1})):v("",!0),v("",!0),T.value?(a(),s(x,{key:2,class:"ma-1"},{default:o(()=>[l(d,{to:`/admin/conventions/${e.value.Slug?e.value.Slug:e.value.ConventionUUID}`},{default:o(()=>[l(w,{variant:"tonal",color:"red",width:"100%"},{default:o(()=>t[9]||(t[9]=[D("Configuration")])),_:1})]),_:1},8,["to"])]),_:1})):v("",!0),S.value||L.value?(a(),s(x,{key:3,class:"ma-1"},{default:o(()=>[l(d,{to:`/admin/conventions/${e.value.Slug?e.value.Slug:e.value.ConventionUUID}/registrations`},{default:o(()=>[l(w,{variant:"tonal",color:"green",width:"100%"},{default:o(()=>t[10]||(t[10]=[D("Registrations")])),_:1})]),_:1},8,["to"])]),_:1})):v("",!0),i.value?(a(),s(x,{key:4,class:"ma-1"},{default:o(()=>[l(d,{to:`/admin/conventions/${e.value.Slug?e.value.Slug:e.value.ConventionUUID}/operations`},{default:o(()=>[l(w,{variant:"tonal",color:"black",width:"100%"},{default:o(()=>t[11]||(t[11]=[D("Operations")])),_:1})]),_:1},8,["to"])]),_:1})):v("",!0),T.value?(a(),s(x,{key:5,class:"ma-1"},{default:o(()=>[l(d,{to:`/admin/conventions/${e.value.Slug?e.value.Slug:e.value.ConventionUUID}/reports`},{default:o(()=>[l(w,{variant:"tonal",color:"purple",width:"100%"},{default:o(()=>t[12]||(t[12]=[D("Reports")])),_:1})]),_:1},8,["to"])]),_:1})):v("",!0)]),_:1})]),_:1}),y.value?(a(),s(oe,{key:0,modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=N=>y.value=N),convention:e.value,"onUpdate:convention":t[2]||(t[2]=N=>e.value=N),onDelete:t[3]||(t[3]=N=>g.value=!0),onSave:n,title:`${e.value.Name} General Settings`},null,8,["modelValue","convention","title"])):v("",!0),g.value?(a(),s(te,{key:1,modelValue:g.value,"onUpdate:modelValue":t[4]||(t[4]=N=>g.value=N),"confirmation-text":"I UNDERSTAND",message:k.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:r},null,8,["modelValue","message"])):v("",!0)]),_:1})}}}),ye=F(Ie,[["__scopeId","data-v-71843f16"]]),Ne=B({__name:"ConventionsView",emits:["pageTitle"],setup(C,{emit:c}){var S;c("pageTitle","Conventions");const _=M(),e=b(),m=f([]),U=f([]),V=K();let k=((S=V.params.organisation)==null?void 0:S.toString())||"";const I=f();J(V,()=>{var i,n;k!==((i=V.params.organisation)==null?void 0:i.toString())&&(k=((n=V.params.organisation)==null?void 0:n.toString())||"",g())});const g=()=>{k?_.getOrganisation(k).then(i=>{i&&(I.value=i,_.getConventionList(i.OrganisationUUID).then(n=>{n&&(m.value=n.sort((r,p)=>r.ID>p.ID?-1:r.ID<p.ID?1:0),y())}))}).catch(()=>{}):_.getPermissionAccessList(H.PERMISSION_TYPE_NULL).then(i=>{i&&(m.value=i.Conventions.sort((n,r)=>n.ID>r.ID?-1:n.ID<r.ID?1:0),y())})},y=()=>{m.value.forEach(i=>{_.getConventionForms(i.ConventionUUID).then(n=>{n&&(U.value=[...U.value,...n])}).catch(n=>{console.error(n)})})},T=()=>{var i,n;if(I.value){const r={ID:0,ConventionUUID:fe(),OrganisationID:((i=I.value)==null?void 0:i.ID)||0,OrganisationUUID:((n=I.value)==null?void 0:n.OrganisationUUID)||Z,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};_.saveConvention(r).then(p=>{p&&m.value.push(p)})}},L=i=>{m.value.splice(i,1)};return g(),(i,n)=>(a(),s(me,null,{default:o(()=>[l(A,{class:"justify-center"},{default:o(()=>[(a(!0),O(X,null,W(m.value,(r,p)=>(a(),s(x,{key:r.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:o(()=>{var u,t;return[l(ye,{modelValue:m.value[p],"onUpdate:modelValue":d=>m.value[p]=d,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((u=r.Organisation)==null?void 0:u.Slug)||((t=r.Organisation)==null?void 0:t.OrganisationUUID)||"",open:!!U.value.find(d=>d.ConventionUUID===r.ConventionUUID&&d.Type===E(Y).FORM_TYPE_REGISTRATION&&d.State&&d.State.New),onDelete:d=>L(p),onDuplicated:d=>m.value.push(d)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete","onDuplicated"])]}),_:2},1024))),128))]),_:1}),l(A,null,{default:o(()=>[I.value&&E(pe)(E(e),I.value)?(a(),s(x,{key:0,class:"text-right"},{default:o(()=>[l(w,{color:"primary",onClick:T},{default:o(()=>n[0]||(n[0]=[D("New")])),_:1})]),_:1})):v("",!0)]),_:1})]),_:1}))}}),st=F(Ne,[["__scopeId","data-v-8defc85d"]]);export{st as default};
