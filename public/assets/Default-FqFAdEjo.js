import{p as L,r as h,s as I,c as y,a as ve,w as x,o as fe,b as ge,d as E,u as pe,e as X,t as D,f as t,m as F,h as Z,i as Y,j as ee,k as q,l as z,n as V,q as k,v as r,x as ae,y as G,z as he,A as R,B,E as te,C as le,D as ye,F as Ve,G as J,H as ke,I as oe,J as ne,K as _e,L as be,T as Se,S as Te}from"./index-CFtvHSTm.js";import{G as Ce,R as H,a as we}from"./userData-nHAF7FK7.js";import{u as Ie}from"./useAvatar-lJalV96_.js";import{C as Pe}from"./canEditOrganisation-C0JTQe8u.js";import{G as M}from"./group-Dg_peWef.js";import{C as O}from"./canDo-m5amdxW-.js";import{C as Re}from"./canViewOperations-B6TXiZLG.js";import{u as Le}from"./useAdvancedMode-Jw9aAwXW.js";import{m as Ne,V as K,a as Be}from"./VToolbar-BNXtFjO6.js";import{V as Ee}from"./scopeId-DKE8rBEE.js";import{V as Ue}from"./VTextField-C8wqxUU0.js";import{u as U,m as Ae,V as xe,a as j,b as De,c as Me,d as se,e as W,f as Oe,g as He,h as ze,i as Ge,j as $e,k as Fe,l as Ye,n as je,o as qe}from"./VContainer-DVuJuxYL.js";import{m as re,u as ue,a as ie,c as ce}from"./layout-WsCwUcCX.js";import{u as Je,V as Q,a as T,b as Ke}from"./VList-DHk4551i.js";import{V as $,a as We}from"./forwardRefs-CXA_Io71.js";import{V as Qe}from"./VDivider-DT1RtQia.js";import{V as Xe,a as de}from"./VNavigationDrawer-C1Z8Kn2x.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Ze}from"./index-fwfMqYug.js";import"./useStoreAPI-BFMwn0Jq.js";import"./createSimpleFunctional-Qmnwq4y5.js";import"./form-BjYlemnI.js";const ea=(e,s=void 0)=>e===void 0?!1:s===void 0?O(e,M.GROUP_TYPE_CONVENTION).ManageUsers:O(e,M.GROUP_TYPE_CONVENTION,s.ConventionUUID,s).ManageUsers,aa=(e,s=void 0)=>{let l;return e===void 0?!1:(s===void 0?l=O(e,M.GROUP_TYPE_CONVENTION):l=O(e,M.GROUP_TYPE_CONVENTION,s.ConventionUUID,s),l.EditConvention||l.ManageViews||l.ViewRegistration||l.EditRegistration)},ta=L({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");function la(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{canScroll:l}=s;let u=0,o=0;const a=h(null),n=I(0),d=I(0),m=I(0),f=I(!1),c=I(!1),v=y(()=>Number(e.scrollThreshold)),C=y(()=>ve((v.value-n.value)/v.value||0)),_=()=>{const g=a.value;if(!g||l&&!l.value)return;u=n.value,n.value="window"in g?g.pageYOffset:g.scrollTop;const S=g instanceof Window?document.documentElement.scrollHeight:g.scrollHeight;if(o!==S){o=S;return}c.value=n.value<u,m.value=Math.abs(n.value-v.value)};return x(c,()=>{d.value=d.value||n.value}),x(f,()=>{d.value=0}),fe(()=>{x(()=>e.scrollTarget,g=>{var w;const S=g?document.querySelector(g):window;S&&S!==a.value&&((w=a.value)==null||w.removeEventListener("scroll",_),a.value=S,a.value.addEventListener("scroll",_,{passive:!0}))},{immediate:!0})}),ge(()=>{var g;(g=a.value)==null||g.removeEventListener("scroll",_)}),l&&x(l,_,{immediate:!0}),{scrollThreshold:v,currentScroll:n,currentThreshold:m,isScrollActive:f,scrollRatio:C,isScrollingUp:c,savedScroll:d}}const oa=L({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...Ne(),...re(),...ta(),height:{type:[Number,String],default:64}},"VAppBar"),na=E()({name:"VAppBar",props:oa(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:l}=s;const u=h(),o=pe(e,"modelValue"),a=y(()=>{var p;const i=new Set(((p=e.scrollBehavior)==null?void 0:p.split(" "))??[]);return{hide:i.has("hide"),fullyHide:i.has("fully-hide"),inverted:i.has("inverted"),collapse:i.has("collapse"),elevate:i.has("elevate"),fadeImage:i.has("fade-image")}}),n=y(()=>{const i=a.value;return i.hide||i.fullyHide||i.inverted||i.collapse||i.elevate||i.fadeImage||!o.value}),{currentScroll:d,scrollThreshold:m,isScrollingUp:f,scrollRatio:c}=la(e,{canScroll:n}),v=y(()=>a.value.hide||a.value.fullyHide),C=y(()=>e.collapse||a.value.collapse&&(a.value.inverted?c.value>0:c.value===0)),_=y(()=>e.flat||a.value.fullyHide&&!o.value||a.value.elevate&&(a.value.inverted?d.value>0:d.value===0)),g=y(()=>a.value.fadeImage?a.value.inverted?1-c.value:c.value:void 0),S=y(()=>{var b,N;if(a.value.hide&&a.value.inverted)return 0;const i=((b=u.value)==null?void 0:b.contentHeight)??0,p=((N=u.value)==null?void 0:N.extensionHeight)??0;return v.value?d.value<m.value||a.value.fullyHide?i+p:i:i+p});X(y(()=>!!e.scrollBehavior),()=>{Z(()=>{v.value?a.value.inverted?o.value=d.value>m.value:o.value=f.value||d.value<m.value:o.value=!0})});const{ssrBootStyles:w}=Je(),{layoutItemStyles:A}=ue({id:e.name,order:y(()=>parseInt(e.order,10)),position:D(e,"location"),layoutSize:S,elementSize:I(void 0),active:o,absolute:D(e,"absolute")});return U(()=>{const i=K.filterProps(e);return t(K,F({ref:u,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"},e.class],style:[{...A.value,"--v-toolbar-image-opacity":g.value,height:void 0,...w.value},e.style]},i,{collapse:C.value,flat:_.value}),l)}),{}}}),sa=L({...Ae({icon:"$menu",variant:"text"})},"VAppBarNavIcon"),ra=E()({name:"VAppBarNavIcon",props:sa(),setup(e,s){let{slots:l}=s;return U(()=>t(xe,F(e,{class:["v-app-bar-nav-icon"]}),l)),{}}}),ua=L({...j(),...De(),...ie()},"VLayout"),ia=E()({name:"VLayout",props:ua(),setup(e,s){let{slots:l}=s;const{layoutClasses:u,layoutStyles:o,getLayoutItem:a,items:n,layoutRef:d}=ce(e),{dimensionStyles:m}=Me(e);return U(()=>{var f;return t("div",{ref:d,class:[u.value,e.class],style:[m.value,o.value,e.style]},[(f=l.default)==null?void 0:f.call(l)])}),{getLayoutItem:a,items:n}}}),ca=Y({__name:"DashboardLayout",props:{user:{}},setup(e){const s=Ie(),l=ee(),u=h(!1),o=h("Default Title"),a=h(""),n=h(q(e.user)),d=h(s(n.value.UserUUID)),m=te.getInstance(),f=Le();m.on("user.profile.saved",i=>{n.value=q(i)});const c=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",v=h(localStorage.getItem("theme")||c());l.global.name.value=v.value;const C=()=>{v.value=="light"?v.value="dark":v.value="light",l.global.name.value=v.value,localStorage.setItem("theme",v.value)},_=async i=>{o.value=i;const p=await le();document.title=`${p!=null&&p.Name?`${p.Name} - `:""} ${o.value}`},g=h(aa(e.user)),S=h(Re(e.user)),w=h(Pe(e.user)),A=h(ea(e.user));return(i,p)=>{const b=z("RouterLink"),N=z("RouterView");return V(),k(ia,{class:"h-100"},{default:r(()=>[t(na,{color:"blue-darken-3"},{default:r(()=>[t(Be,null,{default:r(()=>[ae(G(o.value),1)]),_:1}),t(Ee),t(Ue,{modelValue:a.value,"onUpdate:modelValue":p[0]||(p[0]=P=>a.value=P),"prepend-inner-icon":"mdi:mdi-magnify",label:"Search",variant:"underlined","hide-details":"",clearable:!0,class:"d-none"},null,8,["modelValue"]),t(ra,{variant:"text",onClick:p[1]||(p[1]=he(P=>u.value=!u.value,["stop"]))})]),_:1}),t(Xe,{modelValue:u.value,"onUpdate:modelValue":p[2]||(p[2]=P=>u.value=P),location:"right",temporary:!0},{default:r(()=>[t(Q,null,{default:r(()=>[t(b,{to:{name:"Profile"}},{default:r(()=>[t(T,{title:n.value.DisplayName},{prepend:r(()=>[d.value?(V(),k($,{key:0,src:d.value,class:"rounded-circle mr-2",height:"32",width:"32"},null,8,["src"])):(V(),k(se,{key:1,icon:"mdi:mdi-account-circle",size:"x-large"}))]),_:1},8,["title"])]),_:1})]),_:1}),t(Qe),t(N,{name:"navigation"},{default:r(()=>[t(Q,null,{default:r(()=>[t(b,{to:"/"},{default:r(()=>[t(T,{"prepend-icon":"mdi:mdi-view-dashboard-outline",title:"Home",value:"home"})]),_:1}),g.value||w.value||A.value?(V(),k(Ke,{key:0,value:"Admin"},{activator:r(({props:P})=>[t(T,F(P,{"prepend-icon":"mdi:mdi-security",title:"Admin"}),null,16)]),default:r(()=>[g.value||S.value?(V(),k(b,{key:0,to:"/admin/conventions"},{default:r(()=>[t(T,{"prepend-icon":"mdi:mdi-domain",title:"Conventions",value:"Conventions"})]),_:1})):R("",!0),B(f)&&(w.value||g.value)?(V(),k(b,{key:1,to:"/admin/email/templates"},{default:r(()=>[t(T,{"prepend-icon":"mdi:mdi-email-edit-outline",title:"Email Templates",value:"Email Templates"})]),_:1})):R("",!0),w.value?(V(),k(b,{key:2,to:"/admin/organisations"},{default:r(()=>[t(T,{"prepend-icon":"mdi:mdi-store",title:"Organisations",value:"Organisations"})]),_:1})):R("",!0),A.value?(V(),k(b,{key:3,to:"/admin/groups"},{default:r(()=>[t(T,{"prepend-icon":"mdi:mdi-key-chain-variant",title:"Permissions",value:"Permissions"})]),_:1})):R("",!0)]),_:1})):R("",!0),t(b,{to:{name:"Profile"}},{default:r(()=>[t(T,{"prepend-icon":"mdi:mdi-account-circle",title:"Manage Account"})]),_:1}),t(T,{"prepend-icon":"mdi:mdi-theme-light-dark",onClick:C,title:`${v.value=="light"?"Dark":"Light"} Mode`},null,8,["title"]),t(b,{to:"/logout"},{default:r(()=>[t(T,{"prepend-icon":"mdi:mdi-logout",title:"Logout",value:"Logout"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(de,null,{default:r(()=>[t(N,{onPageTitle:_,"logged-in":!0})]),_:1})]),_:1})}}}),da=me(ca,[["__scopeId","data-v-2607ab80"]]),ma="/assets/graze-logo-R84bxePu.svg",va=Y({__name:"LoginLayout",async setup(e){let s,l;const u=ee(),o=h();o.value=([s,l]=ye(()=>le()),s=await s,l(),s),document.title=`${o.value?`${o.value.Name} - `:"Convention"} Registration System`;const a=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",n=h(localStorage.getItem("theme")||a());return u.global.name.value=n.value,(d,m)=>{const f=z("RouterView");return V(),Ve(ke,null,[t(W,{class:"logo-container text-center"},{default:r(()=>{var c;return[o.value&&o.value.Logo?(V(),k($,{key:0,src:o.value.Logo,class:"graze-logo ma-auto"},null,8,["src"])):(V(),k($,{key:1,src:B(ma),class:"graze-logo ma-auto"},null,8,["src"])),J("h1",null,G(((c=o.value)==null?void 0:c.Name)||"Graze")+" Registration System",1)]}),_:1}),t(W,{class:"login-container text-center mb-0 rounded rounded-lg mb-md-10"},{default:r(()=>[t(We,null,{default:r(()=>[t(se,{class:"ma-2 pa-5 bg-indigo rounded-circle",color:"white",icon:"mdi:mdi-lock-outline"})]),_:1}),J("h2",null,G(B(Ze).headingSignIn),1),t(f,{"logged-in":!1})]),_:1})],64)}}}),fa=me(va,[["__scopeId","data-v-7a044b9b"]]),ga=L({...j(),...ie({fullHeight:!0}),...oe()},"VApp"),pa=E()({name:"VApp",props:ga(),setup(e,s){let{slots:l}=s;const u=ne(e),{layoutClasses:o,getLayoutItem:a,items:n,layoutRef:d}=ce(e),{rtlClasses:m}=_e();return U(()=>{var f;return t("div",{ref:d,class:["v-application",u.themeClasses.value,o.value,m.value,e.class],style:[e.style]},[t("div",{class:"v-application__wrap"},[(f=l.default)==null?void 0:f.call(l)])])}),{getLayoutItem:a,items:n,theme:u}}}),ha=L({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...Oe(),...j(),...He(),...re(),...ze(),...Ge({tag:"footer"}),...oe()},"VFooter"),ya=E()({name:"VFooter",props:ha(),setup(e,s){let{slots:l}=s;const u=h(),{themeClasses:o}=ne(e),{backgroundColorClasses:a,backgroundColorStyles:n}=$e(D(e,"color")),{borderClasses:d}=Fe(e),{elevationClasses:m}=Ye(e),{roundedClasses:f}=je(e),c=I(32),{resizeRef:v}=qe(_=>{_.length&&(c.value=_[0].target.clientHeight)}),C=y(()=>e.height==="auto"?c.value:parseInt(e.height,10));return X(()=>e.app,()=>{const _=ue({id:e.name,order:y(()=>parseInt(e.order,10)),position:y(()=>"bottom"),layoutSize:C,elementSize:y(()=>e.height==="auto"?void 0:C.value),active:y(()=>e.app),absolute:D(e,"absolute")});Z(()=>{u.value=_.layoutItemStyles.value})}),U(()=>t(e.tag,{ref:v,class:["v-footer",o.value,a.value,d.value,m.value,f.value,e.class],style:[n.value,e.app?u.value:{height:be(e.height)},e.style]},l)),{}}}),za=Y({__name:"Default",emits:["pageTitle"],setup(e,{emit:s}){let l=Ce();const u=Se.getInstance(),o=u.getTokenByService("GrazeAPI"),a=h(!1),n=h(!1),d=s,m=te.getInstance();m.on("login",c=>{l=c,a.value=!0}),m.on("logout",()=>{l=void 0,a.value=!1}),m.on("tokenManager.tokenUpdated",()=>{a.value=!0,n.value=!0}),m.on("tokenManager.sessionExpired",()=>{a.value=!1,n.value=!1,H(),location.reload()}),o?l?o.AccessExpires<=Date.now()&&o.RefreshExpires>Date.now()?u.refreshToken(o):o.AccessExpires>Date.now()?(H(),a.value=!1,n.value=!0):(a.value=!0,n.value=!0):we().then(c=>{l=c,a.value=!0,n.value=!0}).catch(()=>{a.value=!1,n.value=!0}):(H(),a.value=!1,n.value=!0);const f=c=>{d("pageTitle",c)};return(c,v)=>(V(),k(Te,null,{default:r(()=>[t(pa,{class:"bg-image"},{default:r(()=>[n.value?(V(),k(de,{key:0},{default:r(()=>[a.value&&B(l)?(V(),k(da,{key:0,user:B(l),onPageTitle:f},null,8,["user"])):(V(),k(fa,{key:1}))]),_:1})):R("",!0),t(ya,null,{default:r(()=>v[0]||(v[0]=[ae(" Powered by Graze ")])),_:1})]),_:1})]),_:1}))}});export{za as default};
