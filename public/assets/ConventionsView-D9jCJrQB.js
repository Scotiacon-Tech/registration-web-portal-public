import{F as W}from"./form-Cqw16b_M.js";import{P as X}from"./permission-Ba-8wP-4.js";import{i as B,K as h,L as j,r as v,k as $,w as z,n as r,q as m,v as e,f as o,C as w,N as M,_ as Y,l as Z,A as U,x as k,y as ee,D as te,B as F,Q as oe,O as ne,F as ae,R as le}from"./index-B6R-Aew_.js";import{u as H}from"./useStoreAPI-mak240Gx.js";import{_ as ie}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-Ce0byss1.js";import{u as se}from"./useModel-CnXSo3g2.js";import{_ as ue}from"./ModelDialog.vue_vue_type_script_setup_true_lang-B4x0NI1l.js";import{s as b}from"./index-DFZh32pl.js";import{e as K,V as O}from"./VContainer-5F-xl_LL.js";import{V as N,a as c}from"./VRow-DudUHBc5.js";import{V as Q}from"./forwardRefs-CMwBLL0X.js";import{V as P}from"./VTextField-CYZGqgEG.js";import{V as re}from"./VTextarea-BSTO4oAs.js";import{V as de}from"./VCheckbox-4GteNv1n.js";import{V as me}from"./VForm-BsW2Bslw.js";import{V as ve}from"./VFileInput-BCNPFgA6.js";import{G as A}from"./group-Dg_peWef.js";import{C as G}from"./canDo-DPNcnx_U.js";import{C as fe}from"./canEditRegistrations-D6Tsf1oU.js";import{C as pe}from"./canViewOperations-Dv3MKgll.js";import{G as J}from"./userData-wRJNXzUe.js";import{u as ce}from"./useAdvancedMode-CUUu6oip.js";import{V as ge,a as Ce,b as Ve,c as q,d as De,e as _e}from"./VCard-CZR32_ie.js";import{C as Ue}from"./canEditOrganisation-CIMEqtuP.js";import{v as Ie}from"./v4-CQkTLCs1.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-Dy-5Gd8l.js";import"./scopeId-BHr0vU4H.js";import"./createSimpleFunctional-COPlfcGM.js";import"./VDialog-UUxtY51J.js";import"./VToolbar-Cc0csT3P.js";import"./form-D2XRgosz.js";import"./VCheckboxBtn-en88wBBO.js";import"./VChip-Bhmw1Fdc.js";const ye=(g=void 0,C=void 0)=>g===void 0?!1:C===void 0?G(g,A.GROUP_TYPE_CONVENTION).EditConvention:G(g,A.GROUP_TYPE_CONVENTION,C.ConventionUUID,C).EditConvention,we=(g,C)=>g===void 0?!1:G(g,A.GROUP_TYPE_CONVENTION,C.ConventionUUID,C).ViewRegistration,Le=B({__name:"EditConventionDialog",props:h({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:h(["update:convention","delete","save"],["update:modelValue"]),setup(g,{emit:C}){const T=g,L=M(),a=H(),{title:f=""}=T,V=C,I=j(g,"modelValue"),D=se(T,V,void 0,void 0,"convention"),l=v($(D.value));z(D,()=>{l.value=$(D.value)});const _=v(`${a.GetConventionLogoURL(l.value.ConventionUUID)}?${new Date().getTime()}`),y=v(),x=v(),E=()=>{_.value=URL.createObjectURL(y.value.files[0])},R=()=>{V("delete")},u=()=>{l.value=$(D.value)},i=async()=>{var n;const s=new FormData((n=x.value)==null?void 0:n.$el);if(s.get("Image")&&s.get("Image").size>0)return s.set("ConventionUUID",l.value.ConventionUUID),await a.SaveConventionLogo(s)},d=s=>{i(),L.saveConvention(l.value).then(n=>{n?s&&s("Convention Data Saved").then(()=>{D.value=n,V("save",n)}):s&&s("Failed to save")}).catch(()=>{s("Failed to save")})};return(s,n)=>(r(),m(ue,{modelValue:I.value,"onUpdate:modelValue":n[5]||(n[5]=t=>I.value=t),onDelete:R,onReset:u,onSave:d,title:w(f),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[o(K,{class:"pa-0",fluid:!0},{default:e(()=>[o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(Q,{class:"imgLogo mx-auto",src:_.value||""},null,8,["src"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(P,{label:w(b).formLabelName,name:"Name",variant:"outlined",modelValue:l.value.Name,"onUpdate:modelValue":n[0]||(n[0]=t=>l.value.Name=t)},null,8,["label","modelValue"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(re,{label:w(b).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:l.value.Description,"onUpdate:modelValue":n[1]||(n[1]=t=>l.value.Description=t)},null,8,["label","modelValue"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(P,{label:w(b).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:l.value.DetailLink,"onUpdate:modelValue":n[2]||(n[2]=t=>l.value.DetailLink=t)},null,8,["label","modelValue"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(P,{label:w(b).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:l.value.Slug,"onUpdate:modelValue":n[3]||(n[3]=t=>l.value.Slug=t)},null,8,["label","modelValue"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(de,{label:w(b).formConventionVisible,name:"Visible",modelValue:l.value.Visible,"onUpdate:modelValue":n[4]||(n[4]=t=>l.value.Visible=t)},null,8,["label","modelValue"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(me,{ref_key:"conventionImageForm",ref:x,enctype:"multipart/form-data"},{default:e(()=>[o(ve,{label:w(b).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:y,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:E},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),Ne=Y(Le,[["__scopeId","data-v-319537e0"]]),xe=["innerHTML"],ke={key:0,class:"text-green"},Se={key:1,class:"text-red"},Te={key:0,class:"text-green"},Re={key:1,class:"text-red"},be=B({__name:"ConventionCard",props:h({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:h(["delete","duplicated"],["update:modelValue"]),setup(g,{emit:C}){const T=M(),L=C,a=j(g,"modelValue"),f=H(),V=J(),I=v(f.GetConventionLogoURL(a.value.ConventionUUID)),D=v(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),l=ce(),_=v(!1),y=v(!1),x=v(ye(V,a.value)),E=v(fe(V,a.value)),R=v(we(V,a.value)),u=v(pe(V,a.value)),i=()=>{y.value=!1,I.value=`${f.GetConventionLogoURL(a.value.ConventionUUID)}?ts=${Date.now()}`},d=n=>{T.deleteConvention(a.value.ConventionUUID).then(t=>{t?n&&(n("Convention Deleted"),L("delete")):n&&n("Failed to Delete Convention"),setTimeout(()=>{_.value=!1},2e3)}).catch(()=>{n&&(n("Failed to Delete Organisation"),_.value=!1)})},s=()=>{T.duplicateConvention(a.value.ConventionUUID).then(n=>{n&&L("duplicated",n)})};return(n,t)=>{const p=Z("RouterLink");return r(),m(_e,null,{default:e(()=>[o(ge,{class:"flex-1-1 align-content-start"},{default:e(()=>[I.value?(r(),m(Q,{key:0,src:I.value,title:a.value.Name,class:"logo text-center"},null,8,["src","title"])):U("",!0),a.value.Name?(r(),m(Ce,{key:1},{default:e(()=>[k(ee(a.value.Name)+" ",1),x.value&&w(l)?(r(),m(O,{key:0,class:"float-right",icon:"mdi:mdi-content-duplicate",size:"small",title:"Duplicate Convention Structure",variant:"flat",onClick:s})):U("",!0)]),_:1})):U("",!0),a.value.Description?(r(),m(Ve,{key:2,class:"text-wrap subtitle"},{default:e(()=>[te("div",{innerHTML:a.value.Description},null,8,xe)]),_:1})):U("",!0),o(q,{class:"px-0 pb-0"},{default:e(()=>[t[5]||(t[5]=k(" Visibility:  ")),a.value.Visible?(r(),F("span",ke,"Visible")):(r(),F("span",Se,"Hidden"))]),_:1}),o(q,{class:"px-0 pb-0"},{default:e(()=>[t[6]||(t[6]=k(" Registration:  ")),n.open?(r(),F("span",Te,"Open")):(r(),F("span",Re,"Closed"))]),_:1})]),_:1}),o(De,null,{default:e(()=>[o(N,{"no-gutters":""},{default:e(()=>[x.value?(r(),m(c,{key:0,class:"ma-1"},{default:e(()=>[o(O,{variant:"tonal",color:"primary",onClick:t[0]||(t[0]=S=>y.value=!0),width:"100%"},{default:e(()=>t[7]||(t[7]=[k("Edit")])),_:1})]),_:1})):U("",!0),U("",!0),x.value?(r(),m(c,{key:2,class:"ma-1"},{default:e(()=>[o(p,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}`},{default:e(()=>[o(O,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>t[9]||(t[9]=[k("Configuration")])),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),R.value||E.value?(r(),m(c,{key:3,class:"ma-1"},{default:e(()=>[o(p,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}/registrations`},{default:e(()=>[o(O,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>t[10]||(t[10]=[k("Registrations")])),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),u.value?(r(),m(c,{key:4,class:"ma-1"},{default:e(()=>[o(p,{to:`/admin/conventions/${a.value.Slug?a.value.Slug:a.value.ConventionUUID}/operations`},{default:e(()=>[o(O,{variant:"tonal",color:"black",width:"100%"},{default:e(()=>t[11]||(t[11]=[k("Operations")])),_:1})]),_:1},8,["to"])]),_:1})):U("",!0)]),_:1})]),_:1}),y.value?(r(),m(Ne,{key:0,modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=S=>y.value=S),convention:a.value,"onUpdate:convention":t[2]||(t[2]=S=>a.value=S),onDelete:t[3]||(t[3]=S=>_.value=!0),onSave:i,title:`${a.value.Name} General Settings`},null,8,["modelValue","convention","title"])):U("",!0),_.value?(r(),m(ie,{key:1,modelValue:_.value,"onUpdate:modelValue":t[4]||(t[4]=S=>_.value=S),"confirmation-text":"I UNDERSTAND",message:D.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:d},null,8,["modelValue","message"])):U("",!0)]),_:1})}}}),Oe=Y(be,[["__scopeId","data-v-c9733907"]]),Ee=B({__name:"ConventionsView",emits:["pageTitle"],setup(g,{emit:C}){var R;C("pageTitle","Conventions");const L=M(),a=J(),f=v([]),V=v([]),I=oe();let D=((R=I.params.organisation)==null?void 0:R.toString())||"";const l=v();z(I,()=>{var u,i;D!==((u=I.params.organisation)==null?void 0:u.toString())&&(D=((i=I.params.organisation)==null?void 0:i.toString())||"",_())});const _=()=>{D?L.getOrganisation(D).then(u=>{u&&(l.value=u,L.getConventionList(u.OrganisationUUID).then(i=>{i&&(f.value=i.sort((d,s)=>d.ID>s.ID?-1:d.ID<s.ID?1:0),y())}))}).catch(()=>{}):L.getPermissionAccessList(X.PERMISSION_TYPE_NULL).then(u=>{u&&(f.value=u.Conventions.sort((i,d)=>i.ID>d.ID?-1:i.ID<d.ID?1:0),y())})},y=()=>{f.value.forEach(u=>{L.getConventionForms(u.ConventionUUID).then(i=>{i&&(V.value=[...V.value,...i])}).catch(i=>{console.error(i)})})},x=()=>{var u,i;if(l.value){const d={ID:0,ConventionUUID:Ie(),OrganisationID:((u=l.value)==null?void 0:u.ID)||0,OrganisationUUID:((i=l.value)==null?void 0:i.OrganisationUUID)||le,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};L.saveConvention(d).then(s=>{s&&f.value.push(s)})}},E=u=>{f.value.splice(u,1)};return _(),(u,i)=>(r(),m(K,null,{default:e(()=>[o(N,{class:"justify-center"},{default:e(()=>[(r(!0),F(ae,null,ne(f.value,(d,s)=>(r(),m(c,{key:d.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var n,t;return[o(Oe,{modelValue:f.value[s],"onUpdate:modelValue":p=>f.value[s]=p,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((n=d.Organisation)==null?void 0:n.Slug)||((t=d.Organisation)==null?void 0:t.OrganisationUUID)||"",open:!!V.value.find(p=>p.ConventionUUID===d.ConventionUUID&&p.Type===w(W).FORM_TYPE_REGISTRATION&&p.State&&p.State.New),onDelete:p=>E(s),onDuplicated:p=>f.value.push(p)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete","onDuplicated"])]}),_:2},1024))),128))]),_:1}),o(N,null,{default:e(()=>[l.value&&w(Ue)(w(a),l.value)?(r(),m(c,{key:0,class:"text-right"},{default:e(()=>[o(O,{color:"primary",onClick:x},{default:e(()=>i[0]||(i[0]=[k("New")])),_:1})]),_:1})):U("",!0)]),_:1})]),_:1}))}}),pt=Y(Ee,[["__scopeId","data-v-8defc85d"]]);export{pt as default};
