import{i as O,r as d,j as K,D as E,q as w,v as a,z as Q,a1 as X,F as r,y as C,x as u,H as G,G as v,f as l,A as g,R as S,P as Y,l as ee,n as s}from"./index-DcKBb7fk.js";import{s as R}from"./index-fwfMqYug.js";import{S as U}from"./setupLogin-Bi2QRGDq.js";import{E as i}from"./emailFormVariant-DbFKH7n9.js";import{V as ae}from"./VForm-9O2njEJp.js";import{a as k,V as y}from"./VRow-CcmXANCC.js";import{V as x}from"./VTextField-C1dFdLDj.js";import{V as b,e as M}from"./VContainer-DI-_rbra.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{G as te}from"./userData-BHVT4jqe.js";import{V as le,a as re,c as se,e as oe}from"./VCard-Cgz4kbGF.js";import"./form-hFQiDDpT.js";import"./forwardRefs-Dgxk6Fjf.js";import"./createSimpleFunctional-CM7T0et9.js";const ne={key:1,class:"ma-auto text-left"},ue={key:2,class:"ma-auto text-left"},ie={key:3,class:"ma-auto text-left"},de={class:"text-red-darken-1 font-weight-bold"},me={class:"text-center mt-4"},fe=O({__name:"EmailLoginForm",props:{variant:{default:()=>i.COMBINED}},setup(_){const A=S(),L=Y(),V=d(!0),D=d(!1),T=d(!1),h=d(!1),o=d(""),n=d(""),I=d(!1),p=d({required:t=>!!t||"Required.",min:t=>t.length>=8||"Min 8 characters",email:t=>!!t.match(/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/)||"Valid email address required"}),m=d(""),f=d(!1),q=new URL(location.href).searchParams.get("token")||"";q!==""&&(V.value=!1,h.value=!0,L.validateAccount(q,_.variant).then(({created:t,tokens:e,user:N})=>{try{U(e,N,A,t)}catch(c){console.error(c)}}).catch(t=>{console.error(t),m.value=t.ErrorMessage}));const W=K(),F=()=>(m.value="",!(p.value.required(o.value)!==!0||p.value.email(o.value)!==!0||p.value.required(n.value)!==!0||p.value.min(n.value)!==!0)),$=t=>{if(t.preventDefault(),!F())return;const N=new URL(location.href).searchParams.get("state");f.value=!0,L.oAuthLogin("internal",o.value,n.value,N||"").then(({created:c,tokens:H,user:J})=>{U(H,J,A,c)}).catch(()=>{m.value="Login failed, check credentials, try another login method or create account",f.value=!1})},B=t=>{t.preventDefault(),F()&&(f.value=!0,L.registerAccount(o.value,n.value).then(e=>{V.value=!1,e&&(T.value=!0)}).catch(()=>{m.value="Unable to register, address may be in use",f.value=!1}))},j=()=>{L.requestLoginLink(o.value).then(t=>{V.value=!1,t&&(D.value=!0)}).catch(()=>{m.value="A problem was encountered, please try again",f.value=!1})},Z=()=>{A.back()};return(t,e)=>{const N=ee("router-link");return s(),E("div",null,[V.value?(s(),w(ae,{key:0,onSubmit:e[3]||(e[3]=Q(()=>{},["stop"])),class:X(`ma-auto vForm pa-3 rounded-lg theme-${r(W).global.name.value}`),disabled:f.value},{default:a(()=>[l(y,null,{default:a(()=>[l(k,null,{default:a(()=>[l(x,{margin:"normal",required:"",id:"email",label:"Email Address",name:"email",autoComplete:"email",autoFocus:"",variant:"outlined",modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=c=>o.value=c),rules:[p.value.required,p.value.email],clearable:!0},null,8,["modelValue","rules"])]),_:1})]),_:1}),l(y,null,{default:a(()=>[l(k,null,{default:a(()=>[l(x,{margin:"normal",required:"",name:"password",label:"Password",type:I.value?"text":"password",id:"password",autoComplete:"current-password",variant:"outlined",modelValue:n.value,"onUpdate:modelValue":e[1]||(e[1]=c=>n.value=c),"append-icon":I.value?"mdi:mdi-eye-off":"mdi:mdi-eye","onClick:append":e[2]||(e[2]=c=>I.value=!I.value),counter:"",hint:"At least 8 characters",rules:[p.value.required,p.value.min],clearable:!0},null,8,["type","modelValue","append-icon","rules"])]),_:1})]),_:1}),m.value?(s(),w(y,{key:0},{default:a(()=>[l(k,{class:"text-red-darken-1 font-weight-bold"},{default:a(()=>[u(C(m.value),1)]),_:1})]),_:1})):g("",!0),l(y,{justify:"space-between"},{default:a(()=>[t.variant===r(i).COMBINED||t.variant===r(i).REGISTER?(s(),w(k,{key:0,cols:"12",sm:"7",order:"2","order-sm":"1"},{default:a(()=>[l(b,{onClick:B,color:"orange-darken-2",disabled:f.value},{default:a(()=>e[4]||(e[4]=[u(" Create Account ")])),_:1},8,["disabled"])]),_:1})):g("",!0),t.variant===r(i).COMBINED||t.variant===r(i).LOGIN?(s(),w(k,{key:1,cols:"12",sm:"5",order:"1","order-sm":"2"},{default:a(()=>[l(b,{onClick:$,color:"success",disabled:f.value,type:"submit"},{default:a(()=>e[5]||(e[5]=[u(" Sign In ")])),_:1},8,["disabled"])]),_:1})):g("",!0),t.variant===r(i).ADD_CREDENTIAL?(s(),w(k,{key:2,cols:"12",sm:"6",class:"flex-grow-0"},{default:a(()=>[l(b,{onClick:B,color:"orange-darken-2",disabled:f.value},{default:a(()=>e[6]||(e[6]=[u(" Add Email ")])),_:1},8,["disabled"])]),_:1})):g("",!0)]),_:1}),t.variant===r(i).COMBINED||t.variant===r(i).LOGIN?(s(),w(M,{key:1},{default:a(()=>[l(y,null,{default:a(()=>[l(k,null,{default:a(()=>[l(b,{variant:"text",onClick:j},{default:a(()=>[u(C(r(R).buttonForgottenPassword),1)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0),t.variant===r(i).COMBINED||t.variant===r(i).LOGIN?(s(),w(M,{key:2},{default:a(()=>[l(y,null,{default:a(()=>[l(k,null,{default:a(()=>[l(b,{variant:"flat",color:"primary",onClick:Z},{default:a(()=>[u(C(r(R).buttonReturnToLogin),1)]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1},8,["class","disabled"])):D.value?(s(),E("p",ne,C(r(R).messageResetEmail),1)):T.value?(s(),E("p",ue,C(r(R).messageVerifyNewAccountEmail),1)):h.value?(s(),E("p",ie,[u(C(r(R).messageVerifiedNewAccountMessage)+" ",1),m.value?(s(),E(G,{key:0},[e[10]||(e[10]=v("br",null,null,-1)),e[11]||(e[11]=v("br",null,null,-1)),v("span",de,[e[7]||(e[7]=u(" An error occurred creating or recovering account:")),e[8]||(e[8]=v("br",null,null,-1)),u(" "+C(m.value),1)]),e[12]||(e[12]=v("br",null,null,-1)),e[13]||(e[13]=v("br",null,null,-1)),e[14]||(e[14]=v("span",{class:"text-red-darken-4"}," Please contact registration if you require further assistance. ",-1)),v("div",me,[l(N,{to:"/"},{default:a(()=>[l(b,{color:"red"},{default:a(()=>e[9]||(e[9]=[u("Close")])),_:1})]),_:1})])],64)):g("",!0)])):g("",!0)])}}}),P=z(fe,[["__scopeId","data-v-7989e03c"]]),ve=O({__name:"LoginWithEmailView",props:{variant:{default:()=>i.COMBINED}},emits:["pageTitle"],setup(_,{emit:A}){A("pageTitle","Email Login");const V=S(),D=te(),h=new URL(location.href).searchParams.get("token")||"";return D&&_.variant!=="ADD_CREDENTIAL"&&!h&&(Date.now()-new Date(D.CreatedAt||"").getTime()>2e4?V.push("/"):V.push("/profile")),(o,n)=>(s(),E("div",null,[o.variant=="ADD_CREDENTIAL"?(s(),w(M,{key:0,style:{"max-width":"550px"}},{default:a(()=>[l(oe,null,{default:a(()=>[l(le,{class:"text-center"},{default:a(()=>[l(re,null,{default:a(()=>n[0]||(n[0]=[u("Add an E-Mail Address")])),_:1})]),_:1}),l(se,null,{default:a(()=>[l(P,{variant:o.variant},null,8,["variant"])]),_:1})]),_:1})]),_:1})):(s(),E(G,{key:1},[n[1]||(n[1]=v("h2",null,"Email",-1)),l(P,{variant:o.variant},null,8,["variant"])],64))]))}}),he=z(ve,[["__scopeId","data-v-c311e024"]]);export{he as default};
