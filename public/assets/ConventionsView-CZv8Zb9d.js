import{F as X}from"./form-Cqw16b_M.js";import{P as Z}from"./permission-Ba-8wP-4.js";import{i as M,K as h,L as j,r as v,k as A,w as z,n as d,q as f,v as e,f as t,C as L,N as Y,_ as q,b as ee,l as te,A as U,x as k,y as oe,D as ne,B as F,Q as ae,O as le,F as ie,R as se}from"./index-Bl6vN6z6.js";import{u as H}from"./useStoreAPI-D4zVnZS8.js";import{_ as ue}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-C_61NpvY.js";import{u as re}from"./useModel-Cuxh1T0O.js";import{_ as de}from"./ModelDialog.vue_vue_type_script_setup_true_lang-CFsDWU2t.js";import{s as R}from"./index-DFZh32pl.js";import{e as Q,V as O}from"./VContainer-B_erhKyg.js";import{V as N,a as c}from"./VRow-DHTh0_wo.js";import{V as J}from"./forwardRefs-DqZZjb2J.js";import{V as P}from"./VTextField-O6UbgWjU.js";import{V as me}from"./VTextarea-CIh0LKCP.js";import{V as ve}from"./VCheckbox-1ORS2wPw.js";import{V as fe}from"./VForm-CoYBBEc8.js";import{V as pe}from"./VFileInput-C2xaoMZV.js";import{G as B}from"./group-Dg_peWef.js";import{C as G}from"./canDo-EM20Kv95.js";import{C as ce}from"./canEditRegistrations-xgM44n71.js";import{C as ge}from"./canViewOperations-BcgWQWe_.js";import{G as W}from"./userData-BraDd-V7.js";import{V as Ce,a as Ve,b as De,c as K,d as _e,e as Ue}from"./VCard-wpi2T3Ja.js";import{C as Ie}from"./canEditOrganisation-BeDPczqW.js";import{v as ye}from"./v4-CQkTLCs1.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-DbWXHPil.js";import"./scopeId-BiuWR_m1.js";import"./createSimpleFunctional-lMN-3CyO.js";import"./VDialog-ldWwgpmq.js";import"./VToolbar-B14pgjrJ.js";import"./form-Ciuie580.js";import"./VCheckboxBtn-_GU9uK2C.js";import"./VChip-BMOW25TY.js";const we=(g=void 0,C=void 0)=>g===void 0?!1:C===void 0?G(g,B.GROUP_TYPE_CONVENTION).EditConvention:G(g,B.GROUP_TYPE_CONVENTION,C.ConventionUUID,C).EditConvention,Le=(g,C)=>g===void 0?!1:G(g,B.GROUP_TYPE_CONVENTION,C.ConventionUUID,C).ViewRegistration,Ne=M({__name:"EditConventionDialog",props:h({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:h(["update:convention","delete","save"],["update:modelValue"]),setup(g,{emit:C}){const S=g,w=Y(),n=H(),{title:p=""}=S,V=C,I=j(g,"modelValue"),D=re(S,V,void 0,void 0,"convention"),l=v(A(D.value));z(D,()=>{l.value=A(D.value)});const _=v(`${n.GetConventionLogoURL(l.value.ConventionUUID)}?${new Date().getTime()}`),y=v(),x=v(),E=()=>{_.value=URL.createObjectURL(y.value.files[0])},T=()=>{V("delete")},r=()=>{l.value=A(D.value)},s=async()=>{var i;const u=new FormData((i=x.value)==null?void 0:i.$el);if(u.get("Image")&&u.get("Image").size>0)return u.set("ConventionUUID",l.value.ConventionUUID),await n.SaveConventionLogo(u)},m=u=>{s(),w.saveConvention(l.value).then(i=>{i?u&&u("Convention Data Saved").then(()=>{D.value=i,V("save",i)}):u&&u("Failed to save")}).catch(()=>{u("Failed to save")})};return(u,i)=>(d(),f(de,{modelValue:I.value,"onUpdate:modelValue":i[5]||(i[5]=a=>I.value=a),onDelete:T,onReset:r,onSave:m,title:L(p),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[t(Q,{class:"pa-0",fluid:!0},{default:e(()=>[t(N,null,{default:e(()=>[t(c,null,{default:e(()=>[t(J,{class:"imgLogo mx-auto",src:_.value||""},null,8,["src"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(c,null,{default:e(()=>[t(P,{label:L(R).formLabelName,name:"Name",variant:"outlined",modelValue:l.value.Name,"onUpdate:modelValue":i[0]||(i[0]=a=>l.value.Name=a)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(c,null,{default:e(()=>[t(me,{label:L(R).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:l.value.Description,"onUpdate:modelValue":i[1]||(i[1]=a=>l.value.Description=a)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(c,null,{default:e(()=>[t(P,{label:L(R).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:l.value.DetailLink,"onUpdate:modelValue":i[2]||(i[2]=a=>l.value.DetailLink=a)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(c,null,{default:e(()=>[t(P,{label:L(R).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:l.value.Slug,"onUpdate:modelValue":i[3]||(i[3]=a=>l.value.Slug=a)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(c,null,{default:e(()=>[t(ve,{label:L(R).formConventionVisible,name:"Visible",modelValue:l.value.Visible,"onUpdate:modelValue":i[4]||(i[4]=a=>l.value.Visible=a)},null,8,["label","modelValue"])]),_:1})]),_:1}),t(N,null,{default:e(()=>[t(c,null,{default:e(()=>[t(fe,{ref_key:"conventionImageForm",ref:x,enctype:"multipart/form-data"},{default:e(()=>[t(pe,{label:L(R).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:y,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:E},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),xe=q(Ne,[["__scopeId","data-v-319537e0"]]),ke=["innerHTML"],be={key:0,class:"text-green"},Se={key:1,class:"text-red"},Te={key:0,class:"text-green"},Re={key:1,class:"text-red"},Oe=M({__name:"ConventionCard",props:h({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:h(["delete","duplicated"],["update:modelValue"]),setup(g,{emit:C}){const S=Y(),w=C,n=j(g,"modelValue"),p=H(),V=W(),I=v(p.GetConventionLogoURL(n.value.ConventionUUID)),D=v(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),l=v(!1),_=v(!1),y=v(!1),x=v(we(V,n.value)),E=v(ce(V,n.value)),T=v(Le(V,n.value)),r=v(ge(V,n.value)),s=()=>{y.value=!1,I.value=`${p.GetConventionLogoURL(n.value.ConventionUUID)}?ts=${Date.now()}`},m=a=>{S.deleteConvention(n.value.ConventionUUID).then(o=>{o?a&&(a("Convention Deleted"),w("delete")):a&&a("Failed to Delete Convention"),setTimeout(()=>{_.value=!1},2e3)}).catch(()=>{a&&(a("Failed to Delete Organisation"),_.value=!1)})},u=()=>{S.duplicateConvention(n.value.ConventionUUID).then(a=>{a&&w("duplicated",a)})},i=a=>{a.altKey&&a.ctrlKey&&a.code==="KeyA"&&(l.value=!l.value)};return window.addEventListener("keydown",i),ee(()=>{window.removeEventListener("keydown",i)}),(a,o)=>{const $=te("RouterLink");return d(),f(Ue,null,{default:e(()=>[t(Ce,{class:"flex-1-1 align-content-start"},{default:e(()=>[I.value?(d(),f(J,{key:0,src:I.value,title:n.value.Name,class:"logo text-center"},null,8,["src","title"])):U("",!0),n.value.Name?(d(),f(Ve,{key:1},{default:e(()=>[k(oe(n.value.Name)+" ",1),x.value&&l.value?(d(),f(O,{key:0,class:"float-right",icon:"mdi:mdi-content-duplicate",size:"small",title:"Duplicate Convention Structure",variant:"flat",onClick:u})):U("",!0)]),_:1})):U("",!0),n.value.Description?(d(),f(De,{key:2,class:"text-wrap subtitle"},{default:e(()=>[ne("div",{innerHTML:n.value.Description},null,8,ke)]),_:1})):U("",!0),t(K,{class:"px-0 pb-0"},{default:e(()=>[o[5]||(o[5]=k(" Visibility:  ")),n.value.Visible?(d(),F("span",be,"Visible")):(d(),F("span",Se,"Hidden"))]),_:1}),t(K,{class:"px-0 pb-0"},{default:e(()=>[o[6]||(o[6]=k(" Registration:  ")),a.open?(d(),F("span",Te,"Open")):(d(),F("span",Re,"Closed"))]),_:1})]),_:1}),t(_e,null,{default:e(()=>[t(N,{"no-gutters":""},{default:e(()=>[x.value?(d(),f(c,{key:0,class:"ma-1"},{default:e(()=>[t(O,{variant:"tonal",color:"primary",onClick:o[0]||(o[0]=b=>y.value=!0),width:"100%"},{default:e(()=>o[7]||(o[7]=[k("Edit")])),_:1})]),_:1})):U("",!0),U("",!0),x.value?(d(),f(c,{key:2,class:"ma-1"},{default:e(()=>[t($,{to:`/admin/conventions/${n.value.Slug?n.value.Slug:n.value.ConventionUUID}`},{default:e(()=>[t(O,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>o[9]||(o[9]=[k("Configuration")])),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),T.value||E.value?(d(),f(c,{key:3,class:"ma-1"},{default:e(()=>[t($,{to:`/admin/conventions/${n.value.Slug?n.value.Slug:n.value.ConventionUUID}/registrations`},{default:e(()=>[t(O,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>o[10]||(o[10]=[k("Registrations")])),_:1})]),_:1},8,["to"])]),_:1})):U("",!0),r.value?(d(),f(c,{key:4,class:"ma-1"},{default:e(()=>[t($,{to:`/admin/conventions/${n.value.Slug?n.value.Slug:n.value.ConventionUUID}/operations`},{default:e(()=>[t(O,{variant:"tonal",color:"black",width:"100%"},{default:e(()=>o[11]||(o[11]=[k("Operations")])),_:1})]),_:1},8,["to"])]),_:1})):U("",!0)]),_:1})]),_:1}),y.value?(d(),f(xe,{key:0,modelValue:y.value,"onUpdate:modelValue":o[1]||(o[1]=b=>y.value=b),convention:n.value,"onUpdate:convention":o[2]||(o[2]=b=>n.value=b),onDelete:o[3]||(o[3]=b=>_.value=!0),onSave:s,title:`${n.value.Name} General Settings`},null,8,["modelValue","convention","title"])):U("",!0),_.value?(d(),f(ue,{key:1,modelValue:_.value,"onUpdate:modelValue":o[4]||(o[4]=b=>_.value=b),"confirmation-text":"I UNDERSTAND",message:D.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:m},null,8,["modelValue","message"])):U("",!0)]),_:1})}}}),Ee=q(Oe,[["__scopeId","data-v-acbef06b"]]),Fe=M({__name:"ConventionsView",emits:["pageTitle"],setup(g,{emit:C}){var T;C("pageTitle","Conventions");const w=Y(),n=W(),p=v([]),V=v([]),I=ae();let D=((T=I.params.organisation)==null?void 0:T.toString())||"";const l=v();z(I,()=>{var r,s;D!==((r=I.params.organisation)==null?void 0:r.toString())&&(D=((s=I.params.organisation)==null?void 0:s.toString())||"",_())});const _=()=>{D?w.getOrganisation(D).then(r=>{r&&(l.value=r,w.getConventionList(r.OrganisationUUID).then(s=>{s&&(p.value=s.sort((m,u)=>m.ID>u.ID?-1:m.ID<u.ID?1:0),y())}))}).catch(()=>{}):w.getPermissionAccessList(Z.PERMISSION_TYPE_NULL).then(r=>{r&&(p.value=r.Conventions.sort((s,m)=>s.ID>m.ID?-1:s.ID<m.ID?1:0),y())})},y=()=>{p.value.forEach(r=>{w.getConventionForms(r.ConventionUUID).then(s=>{s&&(V.value=[...V.value,...s])}).catch(s=>{console.error(s)})})},x=()=>{var r,s;if(l.value){const m={ID:0,ConventionUUID:ye(),OrganisationID:((r=l.value)==null?void 0:r.ID)||0,OrganisationUUID:((s=l.value)==null?void 0:s.OrganisationUUID)||se,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};w.saveConvention(m).then(u=>{u&&p.value.push(u)})}},E=r=>{p.value.splice(r,1)};return _(),(r,s)=>(d(),f(Q,null,{default:e(()=>[t(N,{class:"justify-center"},{default:e(()=>[(d(!0),F(ie,null,le(p.value,(m,u)=>(d(),f(c,{key:m.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var i,a;return[t(Ee,{modelValue:p.value[u],"onUpdate:modelValue":o=>p.value[u]=o,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((i=m.Organisation)==null?void 0:i.Slug)||((a=m.Organisation)==null?void 0:a.OrganisationUUID)||"",open:!!V.value.find(o=>o.ConventionUUID===m.ConventionUUID&&o.Type===L(X).FORM_TYPE_REGISTRATION&&o.State&&o.State.New),onDelete:o=>E(u),onDuplicated:o=>p.value.push(o)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete","onDuplicated"])]}),_:2},1024))),128))]),_:1}),t(N,null,{default:e(()=>[l.value&&L(Ie)(L(n),l.value)?(d(),f(c,{key:0,class:"text-right"},{default:e(()=>[t(O,{color:"primary",onClick:x},{default:e(()=>s[0]||(s[0]=[k("New")])),_:1})]),_:1})):U("",!0)]),_:1})]),_:1}))}}),pt=q(Fe,[["__scopeId","data-v-8defc85d"]]);export{pt as default};
