import{p as ye,d as be,a7 as xe,t as v,c as R,s as J,a9 as Ve,f as l,L as q,m as E,U as Te,P as ae,i as De,r as C,C as ke,$ as we,q as z,v as n,R as Re,n as _,D as Ne,Q as Se,H as Ie,x as B,G as X,y as $,A as Ee}from"./index-BDITYHnh.js";import{V as Y,a as Ce}from"./VTable-CW3SZb3N.js";import{a as _e,V as Be}from"./VTabs-C9-pgqCx.js";import{V as Fe}from"./VToolbar-C7UoBysD.js";import{V as Ge,a as Z}from"./VRow-C36YyrK4.js";import{m as Pe,a as Ue,u as Ae,b as He,c as We,V as Le}from"./filter-NI2qwPJr.js";import{V as Oe}from"./scopeId-CXHzzhbo.js";import{u as qe,V as ze,e as $e}from"./VContainer-4z8B9GML.js";import{e as je}from"./VCard-IBjUpJH0.js";import{b as Ke,s as Me,d as Qe,e as Je,g as Xe,u as Ye,p as Ze,h as et,t as tt,j as at,k as ot,l as lt,n as st,q as ee,r as te,v as rt}from"./VDataTable-Bgf2AST2.js";import"./forwardRefs-BA9tzp4v.js";import"./VOverlay-Cd4JYXas.js";import"./VList-1OG_pYXh.js";import"./createSimpleFunctional-C2g1nGHd.js";import"./VDivider-BTRlyCvT.js";import"./VChip-BoazierS.js";import"./VTextField-BxHVZMPa.js";import"./form-DBoMn28v.js";import"./VCheckboxBtn-CoiPV6fd.js";const nt=ye({...Ke(),...Me(),...Pe(),...Ue()},"VDataTableVirtual"),it=be()({name:"VDataTableVirtual",props:nt(),emits:{"update:modelValue":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:groupBy":e=>!0,"update:expanded":e=>!0},setup(e,b){let{attrs:u,slots:a}=b;const{groupBy:x}=Qe(e),{sortBy:f,multiSort:F,mustSort:m}=Je(e),{disableSort:h}=xe(e),{columns:c,headers:N,filterFunctions:G,sortFunctions:V,sortRawFunctions:S}=Xe(e,{groupBy:x,showSelect:v(e,"showSelect"),showExpand:v(e,"showExpand")}),{items:P}=Ye(e,c),I=v(e,"search"),{filteredItems:U}=Ae(e,P,I,{transform:i=>i.columns,customKeyFilter:G}),{toggleSort:A}=Ze({sortBy:f,multiSort:F,mustSort:m}),{sortByWithGroups:H,opened:s,extractRows:o,isGroupOpen:t,toggleGroup:d}=et({groupBy:x,sortBy:f,disableSort:h}),{sortedItems:W}=tt(e,U,H,{transform:i=>({...i.raw,...i.columns}),sortFunctions:V,sortRawFunctions:S}),{flatItems:r}=at(W,x,s),g=R(()=>o(r.value)),{isSelected:T,select:D,selectAll:k,toggleSelect:L,someSelected:oe,allSelected:le}=ot(e,{allItems:g,currentPage:g}),{isExpanded:se,toggleExpand:re}=lt(e),{containerRef:ne,markerRef:ie,paddingTop:ue,paddingBottom:me,computedItems:ce,handleItemResize:de,handleScroll:pe,handleScrollend:fe}=He(e,r),ve=R(()=>ce.value.map(i=>i.raw));st({sortBy:f,page:J(1),itemsPerPage:J(-1),groupBy:x,search:I}),Ve({VDataTableRows:{hideNoData:v(e,"hideNoData"),noDataText:v(e,"noDataText"),loading:v(e,"loading"),loadingText:v(e,"loadingText")}});const w=R(()=>({sortBy:f.value,toggleSort:A,someSelected:oe.value,allSelected:le.value,isSelected:T,select:D,selectAll:k,toggleSelect:L,isExpanded:se,toggleExpand:re,isGroupOpen:t,toggleGroup:d,items:g.value.map(i=>i.raw),internalItems:g.value,groupedItems:r.value,columns:c.value,headers:N.value}));qe(()=>{const i=ee.filterProps(e),he=te.filterProps(e),ge=Y.filterProps(e);return l(Y,E({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},ge),{top:()=>{var p;return(p=a.top)==null?void 0:p.call(a,w.value)},wrapper:()=>{var p,j,K;return l("div",{ref:ne,onScrollPassive:pe,onScrollend:fe,class:"v-table__wrapper",style:{height:q(e.height)}},[l("table",null,[(p=a.colgroup)==null?void 0:p.call(a,w.value),!e.hideDefaultHeader&&l("thead",{key:"thead"},[l(ee,E(i,{sticky:e.fixedHeader}),a)]),!e.hideDefaultBody&&l("tbody",null,[l("tr",{ref:ie,style:{height:q(ue.value),border:0}},[l("td",{colspan:c.value.length,style:{height:0,border:0}},null)]),(j=a["body.prepend"])==null?void 0:j.call(a,w.value),l(te,E(u,he,{items:ve.value}),{...a,item:y=>l(We,{key:y.internalItem.index,renderless:!0,"onUpdate:height":O=>de(y.internalItem.index,O)},{default:O=>{var Q;let{itemRef:M}=O;return((Q=a.item)==null?void 0:Q.call(a,{...y,itemRef:M}))??l(rt,E(y.props,{ref:M,key:y.internalItem.index,index:y.internalItem.index}),a)}})}),(K=a["body.append"])==null?void 0:K.call(a,w.value),l("tr",{style:{height:q(me.value),border:0}},[l("td",{colspan:c.value.length,style:{height:0,border:0}},null)])])])])},bottom:()=>{var p;return(p=a.bottom)==null?void 0:p.call(a,w.value)}})})}});async function ut(){var a;const e=Te(),b=ae(),u=((a=e.params.convention)==null?void 0:a.toString())||"";if(u)return await b.getConvention(u)}const It=De({__name:"Reports",emits:["pageTitle"],async setup(e,{emit:b}){let u,a;b("pageTitle","Reports");const f=ae(),F=Re(),m=C(),h=C([{Name:"Hotel",Data:[]}]),c=C(),N=C([]);try{const s=([u,a]=ke(()=>ut()),u=await u,a(),u);if(s){const o=h.value.find(t=>t.Name=="Hotel");o&&(f.getHotelReport(s.ConventionUUID).then(t=>{o.Data=t}),f.getConventionVenues(s.ConventionUUID).then(t=>{N.value=t}))}}catch{F.push("/")}const G=R(()=>h.value.find(o=>o.Name===m.value)?m.value!=="Hotel"?[]:[{title:"First Name",align:"start",key:"FirstName"},{title:"Last Name",align:"start",key:"LastName"},{title:"Room Partners",align:"start",key:"Guests"},{title:"Venue",align:"start",key:"Venue"},{title:"Room Type",align:"start",key:"RoomType"},{title:"Arrival",align:"start",key:"ArrivalDay"},{title:"Departure",align:"start",key:"DepartureDay"}]:[]),V=R(()=>{const s=h.value.find(t=>t.Name===m.value);if(!s)return[];if(m.value!=="Hotel")return s.Data;const o=[];return s.Data.forEach(t=>{c.value&&t.Venue!=c.value||t.Guests.forEach((d,W)=>{const r={FirstName:"",LastName:"",Guests:"",Venue:"",Accommodation:"",RoomType:"",ArrivalDay:"",DepartureDay:""};r.FirstName=d.FirstName,r.LastName=d.LastName;const g=t.Guests.filter((k,L)=>L!==W);let T="";g.forEach(k=>{T+=k.FirstName+" "+k.LastName+","}),r.Guests=T.substring(0,T.length-1),r.Venue=t.Venue;const D=t.Accommodation.match(/\((.*?)\)/);D&&D.length>=1&&(r.Accommodation=D[1]),r.RoomType=t.RoomType,r.ArrivalDay=t.Days[0],r.DepartureDay=t.Days[t.Days.length-1],o.push(r)})}),o}),S=we("reportTable"),P="data:application/vnd.ms-excel;base64,",I='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><?xml version="1.0" encoding="UTF-8" standalone="yes"?><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table>{table}</table></body></html>',U=function(s){return btoa(unescape(encodeURIComponent(s)))},A=function(s,o){return s.replace(/{(\w+)}/g,function(t,d){return o[d]})},H=s=>{var t;const o=(t=S.value)==null?void 0:t.getElementsByTagName("table")[0];if(o){const d={worksheet:s||"Worksheet",table:o.innerHTML};window.location.href=P+U(A(I,d))}};return(s,o)=>(_(),z(Ce,null,{default:n(()=>[l(Fe,{color:"blue-darken-4"},{default:n(()=>[l(_e,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=t=>m.value=t),"show-arrows":""},{default:n(()=>[(_(!0),Ne(Ie,null,Se(h.value,t=>(_(),z(Be,{key:t.Name,value:t.Name},{default:n(()=>[B($(t.Name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l($e,{fluid:""},{default:n(()=>[l(Ge,null,{default:n(()=>[l(Z,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:n(()=>[l(Le,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=t=>c.value=t),label:"Venue",items:N.value,"item-value":"Name","item-title":"Name",clearable:"",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),l(Oe),l(Z,{cols:"12",sm:"5",md:"3",lg:"2",xl:"2",class:"text-right"},{default:n(()=>[l(ze,{onClick:o[2]||(o[2]=t=>H(m.value)),color:"primary","prepend-icon":"mdi:mdi-table",class:"w-100 w-sm-auto"},{default:n(()=>o[3]||(o[3]=[B(" Download Excel ")])),_:1})]),_:1})]),_:1})]),_:1}),V.value?(_(),z(je,{key:0,class:"pa-2"},{default:n(()=>[X("div",{ref_key:"reportTable",ref:S},[l(it,{headers:G.value,items:V.value,"items-length":V.value.length},{"item.RoomType":n(({item:t})=>[B($(t.RoomType)+" ",1),o[4]||(o[4]=X("br",null,null,-1)),B(" ("+$(t.Accommodation)+") ",1)]),_:2},1032,["headers","items","items-length"])],512)]),_:1})):Ee("",!0)]),_:1}))}});export{It as default};
