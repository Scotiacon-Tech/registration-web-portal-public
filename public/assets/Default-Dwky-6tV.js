import{p as R,r as f,s as I,c as p,a as me,w as E,o as ve,b as fe,d as B,u as ge,e as Q,t as A,f as l,m as $,h as X,i as F,j as Z,k as j,l as H,n as V,q as _,v as i,x as ee,y as z,z as pe,A as N,E as ae,B as te,C as he,D as ye,F as x,G as q,H as Ve,I as le,J as oe,K as ke,L as _e,T as be,S as Se}from"./index-DcKBb7fk.js";import{G as Ce,R as M,a as we}from"./userData-BHVT4jqe.js";import{u as Te}from"./useAvatar-C1ZTNScI.js";import{C as Ie}from"./canEditOrganisation-USQ--Eby.js";import{G as D}from"./group-Dg_peWef.js";import{C as O}from"./canDo-BAILdnh9.js";import{C as Pe}from"./canViewOperations-QPp8ay1E.js";import{m as Re,V as J,a as Le}from"./VToolbar-CV8uAiBn.js";import{V as Ne}from"./scopeId--7CXZsK-.js";import{V as Be}from"./VTextField-C1dFdLDj.js";import{u as U,m as Ue,V as Ee,a as Y,b as Ae,c as xe,d as ne,e as K,f as De,g as Oe,h as Me,i as He,j as ze,k as Ge,l as $e,n as Fe,o as Ye}from"./VContainer-DI-_rbra.js";import{m as se,u as re,a as ue,c as ie}from"./layout-CmKVOUcW.js";import{u as je,V as W,a as C,b as qe}from"./VList-Jqe8K4vK.js";import{V as G,a as Je}from"./forwardRefs-Dgxk6Fjf.js";import{V as Ke}from"./VDivider-3ZNQ8IOM.js";import{V as We,a as ce}from"./VNavigationDrawer-DbfLp0rf.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Qe}from"./index-fwfMqYug.js";import"./useStoreAPI-B861DK7c.js";import"./createSimpleFunctional-CM7T0et9.js";import"./form-hFQiDDpT.js";const Xe=(e,u=void 0)=>e===void 0?!1:u===void 0?O(e,D.GROUP_TYPE_CONVENTION).ManageUsers:O(e,D.GROUP_TYPE_CONVENTION,u.ConventionUUID,u).ManageUsers,Ze=(e,u=void 0)=>{let t;return e===void 0?!1:(u===void 0?t=O(e,D.GROUP_TYPE_CONVENTION):t=O(e,D.GROUP_TYPE_CONVENTION,u.ConventionUUID,u),t.EditConvention||t.ManageViews||t.ViewRegistration||t.EditRegistration)},ea=R({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");function aa(e){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{canScroll:t}=u;let c=0,o=0;const a=f(null),s=I(0),d=I(0),m=I(0),v=I(!1),r=I(!1),h=p(()=>Number(e.scrollThreshold)),w=p(()=>me((h.value-s.value)/h.value||0)),y=()=>{const g=a.value;if(!g||t&&!t.value)return;c=s.value,s.value="window"in g?g.pageYOffset:g.scrollTop;const b=g instanceof Window?document.documentElement.scrollHeight:g.scrollHeight;if(o!==b){o=b;return}r.value=s.value<c,m.value=Math.abs(s.value-h.value)};return E(r,()=>{d.value=d.value||s.value}),E(v,()=>{d.value=0}),ve(()=>{E(()=>e.scrollTarget,g=>{var T;const b=g?document.querySelector(g):window;b&&b!==a.value&&((T=a.value)==null||T.removeEventListener("scroll",y),a.value=b,a.value.addEventListener("scroll",y,{passive:!0}))},{immediate:!0})}),fe(()=>{var g;(g=a.value)==null||g.removeEventListener("scroll",y)}),t&&E(t,y,{immediate:!0}),{scrollThreshold:h,currentScroll:s,currentThreshold:m,isScrollActive:v,scrollRatio:w,isScrollingUp:r,savedScroll:d}}const ta=R({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...Re(),...se(),...ea(),height:{type:[Number,String],default:64}},"VAppBar"),la=B()({name:"VAppBar",props:ta(),emits:{"update:modelValue":e=>!0},setup(e,u){let{slots:t}=u;const c=f(),o=ge(e,"modelValue"),a=p(()=>{var k;const n=new Set(((k=e.scrollBehavior)==null?void 0:k.split(" "))??[]);return{hide:n.has("hide"),fullyHide:n.has("fully-hide"),inverted:n.has("inverted"),collapse:n.has("collapse"),elevate:n.has("elevate"),fadeImage:n.has("fade-image")}}),s=p(()=>{const n=a.value;return n.hide||n.fullyHide||n.inverted||n.collapse||n.elevate||n.fadeImage||!o.value}),{currentScroll:d,scrollThreshold:m,isScrollingUp:v,scrollRatio:r}=aa(e,{canScroll:s}),h=p(()=>a.value.hide||a.value.fullyHide),w=p(()=>e.collapse||a.value.collapse&&(a.value.inverted?r.value>0:r.value===0)),y=p(()=>e.flat||a.value.fullyHide&&!o.value||a.value.elevate&&(a.value.inverted?d.value>0:d.value===0)),g=p(()=>a.value.fadeImage?a.value.inverted?1-r.value:r.value:void 0),b=p(()=>{var L,S;if(a.value.hide&&a.value.inverted)return 0;const n=((L=c.value)==null?void 0:L.contentHeight)??0,k=((S=c.value)==null?void 0:S.extensionHeight)??0;return h.value?d.value<m.value||a.value.fullyHide?n+k:n:n+k});Q(p(()=>!!e.scrollBehavior),()=>{X(()=>{h.value?a.value.inverted?o.value=d.value>m.value:o.value=v.value||d.value<m.value:o.value=!0})});const{ssrBootStyles:T}=je(),{layoutItemStyles:P}=re({id:e.name,order:p(()=>parseInt(e.order,10)),position:A(e,"location"),layoutSize:b,elementSize:I(void 0),active:o,absolute:A(e,"absolute")});return U(()=>{const n=J.filterProps(e);return l(J,$({ref:c,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"},e.class],style:[{...P.value,"--v-toolbar-image-opacity":g.value,height:void 0,...T.value},e.style]},n,{collapse:w.value,flat:y.value}),t)}),{}}}),oa=R({...Ue({icon:"$menu",variant:"text"})},"VAppBarNavIcon"),na=B()({name:"VAppBarNavIcon",props:oa(),setup(e,u){let{slots:t}=u;return U(()=>l(Ee,$(e,{class:["v-app-bar-nav-icon"]}),t)),{}}}),sa=R({...Y(),...Ae(),...ue()},"VLayout"),ra=B()({name:"VLayout",props:sa(),setup(e,u){let{slots:t}=u;const{layoutClasses:c,layoutStyles:o,getLayoutItem:a,items:s,layoutRef:d}=ie(e),{dimensionStyles:m}=xe(e);return U(()=>{var v;return l("div",{ref:d,class:[c.value,e.class],style:[m.value,o.value,e.style]},[(v=t.default)==null?void 0:v.call(t)])}),{getLayoutItem:a,items:s}}}),ua=F({__name:"DashboardLayout",props:{user:{}},setup(e){const u=Te(),t=Z(),c=f(!1),o=f("Default Title"),a=f(""),s=f(j(e.user)),d=f(u(s.value.UserUUID));ae.getInstance().on("user.profile.saved",P=>{s.value=j(P)});const v=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",r=f(localStorage.getItem("theme")||v());t.global.name.value=r.value;const h=()=>{r.value=="light"?r.value="dark":r.value="light",t.global.name.value=r.value,localStorage.setItem("theme",r.value)},w=async P=>{o.value=P;const n=await te();document.title=`${n!=null&&n.Name?`${n.Name} - `:""} ${o.value}`},y=f(Ze(e.user)),g=f(Pe(e.user)),b=f(Ie(e.user)),T=f(Xe(e.user));return(P,n)=>{const k=H("RouterLink"),L=H("RouterView");return V(),_(ra,{class:"h-100"},{default:i(()=>[l(la,{color:"blue-darken-3"},{default:i(()=>[l(Le,null,{default:i(()=>[ee(z(o.value),1)]),_:1}),l(Ne),l(Be,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=S=>a.value=S),"prepend-inner-icon":"mdi:mdi-magnify",label:"Search",variant:"underlined","hide-details":"",clearable:!0,class:"d-none"},null,8,["modelValue"]),l(na,{variant:"text",onClick:n[1]||(n[1]=pe(S=>c.value=!c.value,["stop"]))})]),_:1}),l(We,{modelValue:c.value,"onUpdate:modelValue":n[2]||(n[2]=S=>c.value=S),location:"right",temporary:!0},{default:i(()=>[l(W,null,{default:i(()=>[l(k,{to:{name:"Profile"}},{default:i(()=>[l(C,{title:s.value.DisplayName},{prepend:i(()=>[d.value?(V(),_(G,{key:0,src:d.value,class:"rounded-circle mr-2",height:"32",width:"32"},null,8,["src"])):(V(),_(ne,{key:1,icon:"mdi:mdi-account-circle",size:"x-large"}))]),_:1},8,["title"])]),_:1})]),_:1}),l(Ke),l(L,{name:"navigation"},{default:i(()=>[l(W,null,{default:i(()=>[l(k,{to:"/"},{default:i(()=>[l(C,{"prepend-icon":"mdi:mdi-view-dashboard-outline",title:"Home",value:"home"})]),_:1}),y.value||b.value||T.value?(V(),_(qe,{key:0,value:"Admin"},{activator:i(({props:S})=>[l(C,$(S,{"prepend-icon":"mdi:mdi-security",title:"Admin"}),null,16)]),default:i(()=>[y.value||g.value?(V(),_(k,{key:0,to:"/admin/conventions"},{default:i(()=>[l(C,{"prepend-icon":"mdi:mdi-domain",title:"Conventions",value:"Conventions"})]),_:1})):N("",!0),b.value?(V(),_(k,{key:1,to:"/admin/organisations"},{default:i(()=>[l(C,{"prepend-icon":"mdi:mdi-store",title:"Organisations",value:"Organisations"})]),_:1})):N("",!0),T.value?(V(),_(k,{key:2,to:"/admin/groups"},{default:i(()=>[l(C,{"prepend-icon":"mdi:mdi-key-chain-variant",title:"Permissions",value:"Permissions"})]),_:1})):N("",!0)]),_:1})):N("",!0),l(k,{to:{name:"Profile"}},{default:i(()=>[l(C,{"prepend-icon":"mdi:mdi-account-circle",title:"Manage Account"})]),_:1}),l(C,{"prepend-icon":"mdi:mdi-theme-light-dark",onClick:h,title:`${r.value=="light"?"Dark":"Light"} Mode`},null,8,["title"]),l(k,{to:"/logout"},{default:i(()=>[l(C,{"prepend-icon":"mdi:mdi-logout",title:"Logout",value:"Logout"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ce,null,{default:i(()=>[l(L,{onPageTitle:w,"logged-in":!0})]),_:1})]),_:1})}}}),ia=de(ua,[["__scopeId","data-v-ffdbfdfd"]]),ca="/assets/graze-logo-R84bxePu.svg",da=F({__name:"LoginLayout",async setup(e){let u,t;const c=Z(),o=f();o.value=([u,t]=he(()=>te()),u=await u,t(),u),document.title=`${o.value?`${o.value.Name} - `:"Convention"} Registration System`;const a=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",s=f(localStorage.getItem("theme")||a());return c.global.name.value=s.value,(d,m)=>{const v=H("RouterView");return V(),ye(Ve,null,[l(K,{class:"logo-container text-center"},{default:i(()=>{var r;return[o.value&&o.value.Logo?(V(),_(G,{key:0,src:o.value.Logo,class:"graze-logo ma-auto"},null,8,["src"])):(V(),_(G,{key:1,src:x(ca),class:"graze-logo ma-auto"},null,8,["src"])),q("h1",null,z(((r=o.value)==null?void 0:r.Name)||"Graze")+" Registration System",1)]}),_:1}),l(K,{class:"login-container text-center mb-0 rounded rounded-lg mb-md-10"},{default:i(()=>[l(Je,null,{default:i(()=>[l(ne,{class:"ma-2 pa-5 bg-indigo rounded-circle",color:"white",icon:"mdi:mdi-lock-outline"})]),_:1}),q("h2",null,z(x(Qe).headingSignIn),1),l(v,{"logged-in":!1})]),_:1})],64)}}}),ma=de(da,[["__scopeId","data-v-7a044b9b"]]),va=R({...Y(),...ue({fullHeight:!0}),...le()},"VApp"),fa=B()({name:"VApp",props:va(),setup(e,u){let{slots:t}=u;const c=oe(e),{layoutClasses:o,getLayoutItem:a,items:s,layoutRef:d}=ie(e),{rtlClasses:m}=ke();return U(()=>{var v;return l("div",{ref:d,class:["v-application",c.themeClasses.value,o.value,m.value,e.class],style:[e.style]},[l("div",{class:"v-application__wrap"},[(v=t.default)==null?void 0:v.call(t)])])}),{getLayoutItem:a,items:s,theme:c}}}),ga=R({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...De(),...Y(),...Oe(),...se(),...Me(),...He({tag:"footer"}),...le()},"VFooter"),pa=B()({name:"VFooter",props:ga(),setup(e,u){let{slots:t}=u;const c=f(),{themeClasses:o}=oe(e),{backgroundColorClasses:a,backgroundColorStyles:s}=ze(A(e,"color")),{borderClasses:d}=Ge(e),{elevationClasses:m}=$e(e),{roundedClasses:v}=Fe(e),r=I(32),{resizeRef:h}=Ye(y=>{y.length&&(r.value=y[0].target.clientHeight)}),w=p(()=>e.height==="auto"?r.value:parseInt(e.height,10));return Q(()=>e.app,()=>{const y=re({id:e.name,order:p(()=>parseInt(e.order,10)),position:p(()=>"bottom"),layoutSize:w,elementSize:p(()=>e.height==="auto"?void 0:w.value),active:p(()=>e.app),absolute:A(e,"absolute")});X(()=>{c.value=y.layoutItemStyles.value})}),U(()=>l(e.tag,{ref:h,class:["v-footer",o.value,a.value,d.value,m.value,v.value,e.class],style:[s.value,e.app?c.value:{height:_e(e.height)},e.style]},t)),{}}}),Oa=F({__name:"Default",emits:["pageTitle"],setup(e,{emit:u}){let t=Ce();const c=be.getInstance(),o=c.getTokenByService("GrazeAPI"),a=f(!1),s=f(!1),d=u,m=ae.getInstance();m.on("login",r=>{t=r,a.value=!0}),m.on("logout",()=>{t=void 0,a.value=!1}),m.on("tokenManager.tokenUpdated",()=>{a.value=!0,s.value=!0}),m.on("tokenManager.sessionExpired",()=>{a.value=!1,s.value=!1,M(),location.reload()}),o?t?o.AccessExpires<=Date.now()&&o.RefreshExpires>Date.now()?c.refreshToken(o):o.AccessExpires>Date.now()?(M(),a.value=!1,s.value=!0):(a.value=!0,s.value=!0):we().then(r=>{t=r,a.value=!0,s.value=!0}).catch(()=>{a.value=!1,s.value=!0}):(M(),a.value=!1,s.value=!0);const v=r=>{d("pageTitle",r)};return(r,h)=>(V(),_(Se,null,{default:i(()=>[l(fa,{class:"bg-image"},{default:i(()=>[s.value?(V(),_(ce,{key:0},{default:i(()=>[a.value&&x(t)?(V(),_(ia,{key:0,user:x(t),onPageTitle:v},null,8,["user"])):(V(),_(ma,{key:1}))]),_:1})):N("",!0),l(pa,null,{default:i(()=>h[0]||(h[0]=[ee(" Powered by Graze ")])),_:1})]),_:1})]),_:1}))}});export{Oa as default};
