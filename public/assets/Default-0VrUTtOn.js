import{p as R,r as p,s as P,c as y,a as ve,w as E,o as me,b as ge,d as B,u as fe,e as W,t as A,f as o,m as z,h as X,i as F,j as pe,k as j,l as M,n as _,q as S,v as i,x as Z,y as G,z as he,A as L,E as ee,_ as ae,B as ye,C as Ve,D as _e,F as D,G as q,H as ke,I as te,J as oe,K as Se,L as Ce,T as be,S as Te}from"./index-DyuTd17Q.js";import{G as Ie,R as H,a as we}from"./userData-DU0OLex0.js";import{u as Pe}from"./useAvatar-DT1EFUFJ.js";import{C as Re}from"./canEditOrganisation-D-JNEuvB.js";import{G as x}from"./group-Dg_peWef.js";import{C as O}from"./canDo-CLaL2sJi.js";import{C as Le}from"./canViewOperations-DmlY_bqD.js";import{m as Be,V as J,a as Ue}from"./VToolbar-PGQlKJFw.js";import{V as Ee}from"./scopeId-c_87M7ul.js";import{V as Ne}from"./VTextField-DWwGmtti.js";import{u as U,m as Ae,V as le,a as Y,b as De,c as xe,d as Oe,e as K,f as He,g as Me,h as Ge,i as ze,j as Fe,k as Ye,l as $e,n as je,o as qe}from"./VContainer-EOJ7yJE4.js";import{m as se,u as ne,a as re,c as ue}from"./layout-DmGEuXem.js";import{u as Je,V as Q,a as T,b as Ke}from"./VList-Bkp14CHy.js";import{V as ie,a as Qe}from"./forwardRefs-C3va6BVS.js";import{V as We}from"./VDivider-CvD44sva.js";import{V as Xe,a as ce}from"./VNavigationDrawer-BYoJqWsr.js";import{s as Ze}from"./index-BYlZ_NAX.js";import"./useStoreAPI-C1zZe-vW.js";import"./createSimpleFunctional-DmFmpwyk.js";import"./form-CAY2E1cI.js";const ea=(e,s=void 0)=>e===void 0?!1:s===void 0?O(e,x.GROUP_TYPE_CONVENTION).ManageUsers:O(e,x.GROUP_TYPE_CONVENTION,s.ConventionUUID,s).ManageUsers,aa=(e,s=void 0)=>{let t;return e===void 0?!1:(s===void 0?t=O(e,x.GROUP_TYPE_CONVENTION):t=O(e,x.GROUP_TYPE_CONVENTION,s.ConventionUUID,s),t.EditConvention||t.ManageViews||t.ViewRegistration||t.EditRegistration)},ta=R({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");function oa(e){let s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{canScroll:t}=s;let r=0,u=0;const a=p(null),c=P(0),l=P(0),m=P(0),d=P(!1),g=P(!1),V=y(()=>Number(e.scrollThreshold)),f=y(()=>ve((V.value-c.value)/V.value||0)),v=()=>{const h=a.value;if(!h||t&&!t.value)return;r=c.value,c.value="window"in h?h.pageYOffset:h.scrollTop;const k=h instanceof Window?document.documentElement.scrollHeight:h.scrollHeight;if(u!==k){u=k;return}g.value=c.value<r,m.value=Math.abs(c.value-V.value)};return E(g,()=>{l.value=l.value||c.value}),E(d,()=>{l.value=0}),me(()=>{E(()=>e.scrollTarget,h=>{var C;const k=h?document.querySelector(h):window;k&&k!==a.value&&((C=a.value)==null||C.removeEventListener("scroll",v),a.value=k,a.value.addEventListener("scroll",v,{passive:!0}))},{immediate:!0})}),ge(()=>{var h;(h=a.value)==null||h.removeEventListener("scroll",v)}),t&&E(t,v,{immediate:!0}),{scrollThreshold:V,currentScroll:c,currentThreshold:m,isScrollActive:d,scrollRatio:f,isScrollingUp:g,savedScroll:l}}const la=R({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...Be(),...se(),...ta(),height:{type:[Number,String],default:64}},"VAppBar"),sa=B()({name:"VAppBar",props:la(),emits:{"update:modelValue":e=>!0},setup(e,s){let{slots:t}=s;const r=p(),u=fe(e,"modelValue"),a=y(()=>{var w;const n=new Set(((w=e.scrollBehavior)==null?void 0:w.split(" "))??[]);return{hide:n.has("hide"),fullyHide:n.has("fully-hide"),inverted:n.has("inverted"),collapse:n.has("collapse"),elevate:n.has("elevate"),fadeImage:n.has("fade-image")}}),c=y(()=>{const n=a.value;return n.hide||n.fullyHide||n.inverted||n.collapse||n.elevate||n.fadeImage||!u.value}),{currentScroll:l,scrollThreshold:m,isScrollingUp:d,scrollRatio:g}=oa(e,{canScroll:c}),V=y(()=>a.value.hide||a.value.fullyHide),f=y(()=>e.collapse||a.value.collapse&&(a.value.inverted?g.value>0:g.value===0)),v=y(()=>e.flat||a.value.fullyHide&&!u.value||a.value.elevate&&(a.value.inverted?l.value>0:l.value===0)),h=y(()=>a.value.fadeImage?a.value.inverted?1-g.value:g.value:void 0),k=y(()=>{var b,$;if(a.value.hide&&a.value.inverted)return 0;const n=((b=r.value)==null?void 0:b.contentHeight)??0,w=(($=r.value)==null?void 0:$.extensionHeight)??0;return V.value?l.value<m.value||a.value.fullyHide?n+w:n:n+w});W(y(()=>!!e.scrollBehavior),()=>{X(()=>{V.value?a.value.inverted?u.value=l.value>m.value:u.value=d.value||l.value<m.value:u.value=!0})});const{ssrBootStyles:C}=Je(),{layoutItemStyles:I}=ne({id:e.name,order:y(()=>parseInt(e.order,10)),position:A(e,"location"),layoutSize:k,elementSize:P(void 0),active:u,absolute:A(e,"absolute")});return U(()=>{const n=J.filterProps(e);return o(J,z({ref:r,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"},e.class],style:[{...I.value,"--v-toolbar-image-opacity":h.value,height:void 0,...C.value},e.style]},n,{collapse:f.value,flat:v.value}),t)}),{}}}),na=R({...Ae({icon:"$menu",variant:"text"})},"VAppBarNavIcon"),ra=B()({name:"VAppBarNavIcon",props:na(),setup(e,s){let{slots:t}=s;return U(()=>o(le,z(e,{class:["v-app-bar-nav-icon"]}),t)),{}}}),ua=R({...Y(),...De(),...re()},"VLayout"),ia=B()({name:"VLayout",props:ua(),setup(e,s){let{slots:t}=s;const{layoutClasses:r,layoutStyles:u,getLayoutItem:a,items:c,layoutRef:l}=ue(e),{dimensionStyles:m}=xe(e);return U(()=>{var d;return o("div",{ref:l,class:[r.value,e.class],style:[m.value,u.value,e.style]},[(d=t.default)==null?void 0:d.call(t)])}),{getLayoutItem:a,items:c}}}),ca=F({__name:"DashboardLayout",props:{user:{}},setup(e){const s=Pe(),t=pe(),r=p(!1),u=p("Default Title"),a=p(""),c=p(j(e.user)),l=p(s(c.value.UserUUID));ee.getInstance().on("user.profile.saved",C=>{c.value=j(C)});const d=p(localStorage.getItem("theme")||"light");t.global.name.value=d.value;const g=()=>{d.value=="light"?d.value="dark":d.value="light",t.global.name.value=d.value,localStorage.setItem("theme",d.value)},V=C=>{u.value=C},f=p(aa(e.user)),v=p(Le(e.user)),h=p(Re(e.user)),k=p(ea(e.user));return(C,I)=>{const n=M("RouterLink"),w=M("RouterView");return _(),S(ia,{class:"h-100"},{default:i(()=>[o(sa,{color:"blue-darken-3"},{default:i(()=>[o(Ue,null,{default:i(()=>[Z(G(u.value),1)]),_:1}),o(Ee),o(Ne,{modelValue:a.value,"onUpdate:modelValue":I[0]||(I[0]=b=>a.value=b),"prepend-inner-icon":"mdi:mdi-magnify",label:"Search",variant:"underlined","hide-details":"",clearable:!0,class:"d-none"},null,8,["modelValue"]),o(ra,{variant:"text",onClick:I[1]||(I[1]=he(b=>r.value=!r.value,["stop"]))})]),_:1}),o(Xe,{modelValue:r.value,"onUpdate:modelValue":I[2]||(I[2]=b=>r.value=b),location:"right",temporary:!0},{default:i(()=>[o(Q,null,{default:i(()=>[o(n,{to:{name:"Profile"}},{default:i(()=>[o(T,{title:c.value.DisplayName},{prepend:i(()=>[l.value?(_(),S(ie,{key:0,src:l.value,class:"rounded-circle mr-2",height:"32",width:"32"},null,8,["src"])):(_(),S(Oe,{key:1,icon:"mdi:mdi-account-circle",size:"x-large"}))]),_:1},8,["title"])]),_:1})]),_:1}),o(We),o(w,{name:"navigation"},{default:i(()=>[o(Q,null,{default:i(()=>[o(n,{to:"/"},{default:i(()=>[o(T,{"prepend-icon":"mdi:mdi-view-dashboard-outline",title:"Home",value:"home"})]),_:1}),f.value||h.value||k.value?(_(),S(Ke,{key:0,value:"Admin"},{activator:i(({props:b})=>[o(T,z(b,{"prepend-icon":"mdi:mdi-security",title:"Admin"}),null,16)]),default:i(()=>[f.value||v.value?(_(),S(n,{key:0,to:"/admin/conventions"},{default:i(()=>[o(T,{"prepend-icon":"mdi:mdi-domain",title:"Conventions",value:"Conventions"})]),_:1})):L("",!0),h.value?(_(),S(n,{key:1,to:"/admin/organisations"},{default:i(()=>[o(T,{"prepend-icon":"mdi:mdi-store",title:"Organisations",value:"Organisations"})]),_:1})):L("",!0),k.value?(_(),S(n,{key:2,to:"/admin/groups"},{default:i(()=>[o(T,{"prepend-icon":"mdi:mdi-key-chain-variant",title:"Permissions",value:"Permissions"})]),_:1})):L("",!0)]),_:1})):L("",!0),o(n,{to:{name:"Profile"}},{default:i(()=>[o(T,{"prepend-icon":"mdi:mdi-account-circle",title:"Manage Account"})]),_:1}),o(T,{"prepend-icon":"mdi:mdi-theme-light-dark",onClick:g,title:`${d.value=="light"?"Dark":"Light"} Mode`},null,8,["title"]),o(n,{to:"/logout"},{default:i(()=>[o(T,{"prepend-icon":"mdi:mdi-logout",title:"Logout",value:"Logout"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ce,null,{default:i(()=>[o(w,{onPageTitle:V,"logged-in":!0})]),_:1})]),_:1})}}}),da=ae(ca,[["__scopeId","data-v-3dd3a779"]]),va="/assets/scotiacon-logo-DsrTQlsL.svg";let N;async function de(){const e=ye(),s=new URL(window.location.href);if(N)return N;try{return N=await e.getOrganisation(s.host),N}catch{return}}const ma=F({__name:"LoginLayout",async setup(e){let s,t;const r=p();return r.value=([s,t]=Ve(()=>de()),s=await s,t(),s),(u,a)=>{const c=M("RouterView");return _(),_e(ke,null,[o(K,{class:"logo-container text-center"},{default:i(()=>{var l;return[o(ie,{src:D(va),class:"scotiacon-logo ma-auto"},null,8,["src"]),q("h1",null,G(((l=r.value)==null?void 0:l.Name)||"Graze")+" Registration System",1)]}),_:1}),o(K,{class:"login-container text-center mb-0 rounded rounded-lg mb-md-10"},{default:i(()=>[o(Qe,null,{default:i(()=>[o(le,{class:"ma-2",color:"indigo",icon:"mdi:mdi-lock-outline"})]),_:1}),q("h2",null,G(D(Ze).headingSignIn),1),o(c,{"logged-in":!1})]),_:1})],64)}}}),ga=ae(ma,[["__scopeId","data-v-a5c32ee2"]]),fa=R({...Y(),...re({fullHeight:!0}),...te()},"VApp"),pa=B()({name:"VApp",props:fa(),setup(e,s){let{slots:t}=s;const r=oe(e),{layoutClasses:u,getLayoutItem:a,items:c,layoutRef:l}=ue(e),{rtlClasses:m}=Se();return U(()=>{var d;return o("div",{ref:l,class:["v-application",r.themeClasses.value,u.value,m.value,e.class],style:[e.style]},[o("div",{class:"v-application__wrap"},[(d=t.default)==null?void 0:d.call(t)])])}),{getLayoutItem:a,items:c,theme:r}}}),ha=R({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...He(),...Y(),...Me(),...se(),...Ge(),...ze({tag:"footer"}),...te()},"VFooter"),ya=B()({name:"VFooter",props:ha(),setup(e,s){let{slots:t}=s;const r=p(),{themeClasses:u}=oe(e),{backgroundColorClasses:a,backgroundColorStyles:c}=Fe(A(e,"color")),{borderClasses:l}=Ye(e),{elevationClasses:m}=$e(e),{roundedClasses:d}=je(e),g=P(32),{resizeRef:V}=qe(v=>{v.length&&(g.value=v[0].target.clientHeight)}),f=y(()=>e.height==="auto"?g.value:parseInt(e.height,10));return W(()=>e.app,()=>{const v=ne({id:e.name,order:y(()=>parseInt(e.order,10)),position:y(()=>"bottom"),layoutSize:f,elementSize:y(()=>e.height==="auto"?void 0:f.value),active:y(()=>e.app),absolute:A(e,"absolute")});X(()=>{r.value=v.layoutItemStyles.value})}),U(()=>o(e.tag,{ref:V,class:["v-footer",u.value,a.value,l.value,m.value,d.value,e.class],style:[c.value,e.app?r.value:{height:Ce(e.height)},e.style]},t)),{}}}),Ha=F({__name:"Default",emits:["pageTitle"],setup(e,{emit:s}){let t=Ie();const r=be.getInstance(),u=r.getTokenByService("GrazeAPI"),a=p(!1),c=p(!1),l=p(!1),m=p();de().then(f=>{if(m.value=f,m.value&&m.value.CSS){const v=document.createElement("style");v.textContent=m.value.CSS,document.head.appendChild(v)}c.value=!0});const d=s,g=ee.getInstance();g.on("login",f=>{t=f,a.value=!0}),g.on("logout",()=>{t=void 0,a.value=!1}),g.on("tokenManager.tokenUpdated",()=>{a.value=!0,l.value=!0}),g.on("tokenManager.sessionExpired",()=>{a.value=!1,l.value=!1,H(),location.reload()}),u?t?u.AccessExpires<=Date.now()&&u.RefreshExpires>Date.now()?r.refreshToken(u):u.AccessExpires>Date.now()?(H(),a.value=!1,l.value=!0):(a.value=!0,l.value=!0):we().then(f=>{t=f,a.value=!0,l.value=!0}).catch(()=>{a.value=!1,l.value=!0}):(H(),a.value=!1,l.value=!0);const V=f=>{d("pageTitle",f)};return(f,v)=>(_(),S(Te,null,{default:i(()=>[o(pa,{class:"bg-image"},{default:i(()=>[c.value&&l.value?(_(),S(ce,{key:0},{default:i(()=>[a.value&&D(t)?(_(),S(da,{key:0,user:D(t),onPageTitle:V},null,8,["user"])):(_(),S(ga,{key:1}))]),_:1})):L("",!0),o(ya,null,{default:i(()=>v[0]||(v[0]=[Z(" Powered by Graze ")])),_:1})]),_:1})]),_:1}))}});export{Ha as default};
