import{F as W}from"./form-Cqw16b_M.js";import{P as X}from"./permission-Ba-8wP-4.js";import{i as B,K as $,L as j,r as v,k as h,w as z,n as r,q as m,v as e,f as o,C as w,N as M,_ as Y,l as Z,A as g,x as S,y as ee,D as te,B as F,Q as oe,O as ne,F as ae,R as le}from"./index-Cfjh1arS.js";import{u as H}from"./useStoreAPI-tMsBQFMi.js";import{_ as ie}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-8MBzgVPC.js";import{u as se}from"./useModel-BzQLkI1u.js";import{_ as ue}from"./ModelDialog.vue_vue_type_script_setup_true_lang-xLZLDkcF.js";import{s as O}from"./index-DFZh32pl.js";import{e as K,V as R}from"./VContainer-BsHTJ5LH.js";import{V as N,a as c}from"./VRow-DAVRc4gY.js";import{V as Q}from"./forwardRefs-Ova6Q0r0.js";import{V as P}from"./VTextField-Bo9qGKyQ.js";import{V as re}from"./VTextarea-CO9XGMDt.js";import{V as de}from"./VCheckbox-DiuHKW5C.js";import{V as me}from"./VForm-Dr-v2d--.js";import{V as ve}from"./VFileInput-Ba3BDvu-.js";import{G as A}from"./group-Dg_peWef.js";import{C as G}from"./canDo-Cc9JnVoK.js";import{C as fe}from"./canEditRegistrations-D_M-vbNn.js";import{C as pe}from"./canViewOperations-DBL-mGTx.js";import{G as J}from"./userData-Tg3rc3nM.js";import{u as ce}from"./useAdvancedMode-DgbASV9S.js";import{V as ge,a as Ce,b as Ve,c as q,d as De,e as _e}from"./VCard-B4SgjzgT.js";import{C as Ue}from"./canEditOrganisation-B0C-SHOb.js";import{v as Ie}from"./v4-CQkTLCs1.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-BmMAbFcD.js";import"./VOverlay-CvqTvm0h.js";import"./scopeId-C0Ey8hzl.js";import"./createSimpleFunctional-CNzVSQr5.js";import"./layout-D1wUyexF.js";import"./VDialog-Dlyt6XKD.js";import"./VToolbar-CXSOYJAO.js";import"./form-DCb_K9u2.js";import"./VCheckboxBtn-DUWzbAw4.js";import"./VChip-DRtqQ_fV.js";const ye=(C=void 0,V=void 0)=>C===void 0?!1:V===void 0?G(C,A.GROUP_TYPE_CONVENTION).EditConvention:G(C,A.GROUP_TYPE_CONVENTION,V.ConventionUUID,V).EditConvention,we=(C,V)=>C===void 0?!1:G(C,A.GROUP_TYPE_CONVENTION,V.ConventionUUID,V).ViewRegistration,Le=B({__name:"EditConventionDialog",props:$({convention:{},title:{}},{modelValue:{type:Boolean,required:!0},modelModifiers:{}}),emits:$(["update:convention","delete","save"],["update:modelValue"]),setup(C,{emit:V}){const T=C,L=M(),n=H(),{title:f=""}=T,D=V,I=j(C,"modelValue"),_=se(T,D,void 0,void 0,"convention"),l=v(h(_.value));z(_,()=>{l.value=h(_.value)});const U=v(`${n.GetConventionLogoURL(l.value.ConventionUUID)}?${new Date().getTime()}`),y=v(),x=v(),E=()=>{U.value=URL.createObjectURL(y.value.files[0])},b=()=>{D("delete")},u=()=>{l.value=h(_.value)},i=async()=>{var a;const s=new FormData((a=x.value)==null?void 0:a.$el);if(s.get("Image")&&s.get("Image").size>0)return s.set("ConventionUUID",l.value.ConventionUUID),await n.SaveConventionLogo(s)},d=s=>{i(),L.saveConvention(l.value).then(a=>{a?s&&s("Convention Data Saved").then(()=>{_.value=a,D("save",a)}):s&&s("Failed to save")}).catch(()=>{s("Failed to save")})};return(s,a)=>(r(),m(ue,{modelValue:I.value,"onUpdate:modelValue":a[5]||(a[5]=t=>I.value=t),onDelete:b,onReset:u,onSave:d,title:w(f),color:"primary","show-close-action":!0,"show-delete-action":!0,"show-reset-action":!0,"show-save-action":!0,fullscreen:!0,persistent:!0},{default:e(()=>[o(K,{class:"pa-0",fluid:!0},{default:e(()=>[o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(Q,{class:"imgLogo mx-auto",src:U.value||""},null,8,["src"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(P,{label:w(O).formLabelName,name:"Name",variant:"outlined",modelValue:l.value.Name,"onUpdate:modelValue":a[0]||(a[0]=t=>l.value.Name=t)},null,8,["label","modelValue"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(re,{label:w(O).formLabelDescription,name:"Description",variant:"outlined",multiline:"true",modelValue:l.value.Description,"onUpdate:modelValue":a[1]||(a[1]=t=>l.value.Description=t)},null,8,["label","modelValue"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(P,{label:w(O).formLabelDetailLink,name:"DetailLink",variant:"outlined",multiline:"true",modelValue:l.value.DetailLink,"onUpdate:modelValue":a[2]||(a[2]=t=>l.value.DetailLink=t)},null,8,["label","modelValue"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(P,{label:w(O).formLabelSlug,name:"Slug",variant:"outlined",multiline:"true",modelValue:l.value.Slug,"onUpdate:modelValue":a[3]||(a[3]=t=>l.value.Slug=t)},null,8,["label","modelValue"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(de,{label:w(O).formConventionVisible,name:"Visible",modelValue:l.value.Visible,"onUpdate:modelValue":a[4]||(a[4]=t=>l.value.Visible=t)},null,8,["label","modelValue"])]),_:1})]),_:1}),o(N,null,{default:e(()=>[o(c,null,{default:e(()=>[o(me,{ref_key:"conventionImageForm",ref:x,enctype:"multipart/form-data"},{default:e(()=>[o(ve,{label:w(O).formLabelLogo,name:"Image",variant:"outlined",ref_key:"imageFileInput",ref:y,accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:E},null,8,["label"])]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue","title"]))}}),Ne=Y(Le,[["__scopeId","data-v-319537e0"]]),xe=["innerHTML"],Se={key:0,class:"text-green"},ke={key:1,class:"text-red"},Re={key:0,class:"text-green"},Te={key:1,class:"text-red"},be=B({__name:"ConventionCard",props:$({open:{type:Boolean,default:!1}},{modelValue:{required:!0},modelModifiers:{}}),emits:$(["delete","duplicated"],["update:modelValue"]),setup(C,{emit:V}){const T=M(),L=V,n=j(C,"modelValue"),f=H(),D=J(),I=v(f.GetConventionLogoURL(n.value.ConventionUUID)),_=v(`
Are you sure you wish to delete this convention? All data relating to it will be
removed including all registrations and payment information. This action can
not be undone. To confirm type "I UNDERSTAND" in the box below.
`),l=ce(),U=v(!1),y=v(!1),x=v(ye(D,n.value)),E=v(fe(D,n.value)),b=v(we(D,n.value)),u=v(pe(D,n.value)),i=()=>{y.value=!1,I.value=`${f.GetConventionLogoURL(n.value.ConventionUUID)}?ts=${Date.now()}`},d=a=>{T.deleteConvention(n.value.ConventionUUID).then(t=>{t?a&&(a("Convention Deleted"),L("delete")):a&&a("Failed to Delete Convention"),setTimeout(()=>{U.value=!1},2e3)}).catch(()=>{a&&(a("Failed to Delete Organisation"),U.value=!1)})},s=()=>{T.duplicateConvention(n.value.ConventionUUID).then(a=>{a&&L("duplicated",a)})};return(a,t)=>{const p=Z("RouterLink");return r(),m(_e,null,{default:e(()=>[o(ge,{class:"flex-1-1 align-content-start"},{default:e(()=>[I.value?(r(),m(Q,{key:0,src:I.value,title:n.value.Name,class:"logo text-center"},null,8,["src","title"])):g("",!0),n.value.Name?(r(),m(Ce,{key:1},{default:e(()=>[S(ee(n.value.Name)+" ",1),x.value&&w(l)?(r(),m(R,{key:0,class:"float-right",icon:"mdi:mdi-content-duplicate",size:"small",title:"Duplicate Convention Structure",variant:"flat",onClick:s})):g("",!0)]),_:1})):g("",!0),n.value.Description?(r(),m(Ve,{key:2,class:"text-wrap subtitle"},{default:e(()=>[te("div",{innerHTML:n.value.Description},null,8,xe)]),_:1})):g("",!0),o(q,{class:"px-0 pb-0"},{default:e(()=>[t[5]||(t[5]=S(" Visibility:  ")),n.value.Visible?(r(),F("span",Se,"Visible")):(r(),F("span",ke,"Hidden"))]),_:1}),o(q,{class:"px-0 pb-0"},{default:e(()=>[t[6]||(t[6]=S(" Registration:  ")),a.open?(r(),F("span",Re,"Open")):(r(),F("span",Te,"Closed"))]),_:1})]),_:1}),o(De,null,{default:e(()=>[o(N,{"no-gutters":""},{default:e(()=>[x.value?(r(),m(c,{key:0,class:"ma-1"},{default:e(()=>[o(R,{variant:"tonal",color:"primary",onClick:t[0]||(t[0]=k=>y.value=!0),width:"100%"},{default:e(()=>t[7]||(t[7]=[S("Edit")])),_:1})]),_:1})):g("",!0),g("",!0),x.value?(r(),m(c,{key:2,class:"ma-1"},{default:e(()=>[o(p,{to:`/admin/conventions/${n.value.Slug?n.value.Slug:n.value.ConventionUUID}`},{default:e(()=>[o(R,{variant:"tonal",color:"red",width:"100%"},{default:e(()=>t[9]||(t[9]=[S("Configuration")])),_:1})]),_:1},8,["to"])]),_:1})):g("",!0),b.value||E.value?(r(),m(c,{key:3,class:"ma-1"},{default:e(()=>[o(p,{to:`/admin/conventions/${n.value.Slug?n.value.Slug:n.value.ConventionUUID}/registrations`},{default:e(()=>[o(R,{variant:"tonal",color:"green",width:"100%"},{default:e(()=>t[10]||(t[10]=[S("Registrations")])),_:1})]),_:1},8,["to"])]),_:1})):g("",!0),u.value?(r(),m(c,{key:4,class:"ma-1"},{default:e(()=>[o(p,{to:`/admin/conventions/${n.value.Slug?n.value.Slug:n.value.ConventionUUID}/operations`},{default:e(()=>[o(R,{variant:"tonal",color:"black",width:"100%"},{default:e(()=>t[11]||(t[11]=[S("Operations")])),_:1})]),_:1},8,["to"])]),_:1})):g("",!0),x.value?(r(),m(c,{key:5,class:"ma-1"},{default:e(()=>[o(p,{to:`/admin/conventions/${n.value.Slug?n.value.Slug:n.value.ConventionUUID}/reports`},{default:e(()=>[o(R,{variant:"tonal",color:"purple",width:"100%"},{default:e(()=>t[12]||(t[12]=[S("Reports")])),_:1})]),_:1},8,["to"])]),_:1})):g("",!0)]),_:1})]),_:1}),y.value?(r(),m(Ne,{key:0,modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=k=>y.value=k),convention:n.value,"onUpdate:convention":t[2]||(t[2]=k=>n.value=k),onDelete:t[3]||(t[3]=k=>U.value=!0),onSave:i,title:`${n.value.Name} General Settings`},null,8,["modelValue","convention","title"])):g("",!0),U.value?(r(),m(ie,{key:1,modelValue:U.value,"onUpdate:modelValue":t[4]||(t[4]=k=>U.value=k),"confirmation-text":"I UNDERSTAND",message:_.value,title:"Delete Convention",subtitle:"A quick way to make enemies",onDelete:d},null,8,["modelValue","message"])):g("",!0)]),_:1})}}}),Oe=Y(be,[["__scopeId","data-v-71843f16"]]),Ee=B({__name:"ConventionsView",emits:["pageTitle"],setup(C,{emit:V}){var b;V("pageTitle","Conventions");const L=M(),n=J(),f=v([]),D=v([]),I=oe();let _=((b=I.params.organisation)==null?void 0:b.toString())||"";const l=v();z(I,()=>{var u,i;_!==((u=I.params.organisation)==null?void 0:u.toString())&&(_=((i=I.params.organisation)==null?void 0:i.toString())||"",U())});const U=()=>{_?L.getOrganisation(_).then(u=>{u&&(l.value=u,L.getConventionList(u.OrganisationUUID).then(i=>{i&&(f.value=i.sort((d,s)=>d.ID>s.ID?-1:d.ID<s.ID?1:0),y())}))}).catch(()=>{}):L.getPermissionAccessList(X.PERMISSION_TYPE_NULL).then(u=>{u&&(f.value=u.Conventions.sort((i,d)=>i.ID>d.ID?-1:i.ID<d.ID?1:0),y())})},y=()=>{f.value.forEach(u=>{L.getConventionForms(u.ConventionUUID).then(i=>{i&&(D.value=[...D.value,...i])}).catch(i=>{console.error(i)})})},x=()=>{var u,i;if(l.value){const d={ID:0,ConventionUUID:Ie(),OrganisationID:((u=l.value)==null?void 0:u.ID)||0,OrganisationUUID:((i=l.value)==null?void 0:i.OrganisationUUID)||le,Name:"New Convention",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1};L.saveConvention(d).then(s=>{s&&f.value.push(s)})}},E=u=>{f.value.splice(u,1)};return U(),(u,i)=>(r(),m(K,null,{default:e(()=>[o(N,{class:"justify-center"},{default:e(()=>[(r(!0),F(ae,null,ne(f.value,(d,s)=>(r(),m(c,{key:d.ID,cols:"12",sm:"11",md:"11",lg:"8",xl:"6",class:"d-flex flex-column"},{default:e(()=>{var a,t;return[o(Oe,{modelValue:f.value[s],"onUpdate:modelValue":p=>f.value[s]=p,class:"elevation-5 flex-1-0 d-flex flex-column","organisation-slug":((a=d.Organisation)==null?void 0:a.Slug)||((t=d.Organisation)==null?void 0:t.OrganisationUUID)||"",open:!!D.value.find(p=>p.ConventionUUID===d.ConventionUUID&&p.Type===w(W).FORM_TYPE_REGISTRATION&&p.State&&p.State.New),onDelete:p=>E(s),onDuplicated:p=>f.value.push(p)},null,8,["modelValue","onUpdate:modelValue","organisation-slug","open","onDelete","onDuplicated"])]}),_:2},1024))),128))]),_:1}),o(N,null,{default:e(()=>[l.value&&w(Ue)(w(n),l.value)?(r(),m(c,{key:0,class:"text-right"},{default:e(()=>[o(R,{color:"primary",onClick:x},{default:e(()=>i[0]||(i[0]=[S("New")])),_:1})]),_:1})):g("",!0)]),_:1})]),_:1}))}}),gt=Y(Ee,[["__scopeId","data-v-8defc85d"]]);export{gt as default};
