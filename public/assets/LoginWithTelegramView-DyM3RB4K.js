import{i as L,r as g,o as U,D as m,n as c,W as x,q as B,v as n,H as T,G as s,f as l,A as E,R as I,l as G,x as M,y as C,F as h}from"./index-C0Gb3qEX.js";import{G as N}from"./userData-DnHV_SoW.js";import{S as O}from"./setupLogin-DgcO9h1Y.js";import{E as q}from"./emailFormVariant-DbFKH7n9.js";import{_ as z}from"./ModelDialog.vue_vue_type_script_setup_true_lang-Bj-F03gg.js";import{s as _}from"./index-fwfMqYug.js";import{e as H}from"./VContainer-CKDRlvON.js";import{V as F,a as S,c as j,e as W}from"./VCard-BYUppvMY.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-B_NvnnU3.js";import"./VOverlay-BtewPaeq.js";import"./forwardRefs-CC4TMhvU.js";import"./scopeId-CJv-zJPa.js";import"./createSimpleFunctional-ztedazSN.js";import"./layout-B5IiA2Sa.js";import"./VToolbar-CkR8pYZ6.js";import"./VDialog-DxGzgBPB.js";const k=L({__name:"TelegramLoginForm",props:{mode:{},telegramLogin:{},redirectUrl:{default:""},requestAccess:{default:""},size:{default:""},userpic:{type:Boolean,default:!1},radius:{default:""}},emits:["callback"],setup(r,{emit:f}){const b=f,i=g(),o=e=>{b("callback",e)};return U(()=>{const e=document.createElement("script");e.async=!0,e.src="https://telegram.org/js/telegram-widget.js?22",e.setAttribute("data-size",r.size||""),e.setAttribute("data-userpic",r.userpic?"true":"false"),e.setAttribute("data-telegram-login",r.telegramLogin),e.setAttribute("data-request-access",r.requestAccess||""),r.radius&&e.setAttribute("data-radius",r.radius||""),r.mode==="callback"?(window.onTelegramAuth=o,e.setAttribute("data-onauth","window.onTelegramAuth(user)")):e.setAttribute("data-auth-url",r.redirectUrl||""),i.value.appendChild(e)}),(e,p)=>(c(),m("div",{ref_key:"telegram",ref:i},null,512))}}),$={class:"form-group row"},P={class:"col"},J={class:"form-group row"},K={class:"col"},Q={class:"my-2"},X={class:"my-2"},Y={class:"my-2"},pe=L({__name:"LoginWithTelegramView",props:{variant:{default:()=>q.COMBINED}},emits:["pageTitle"],setup(r,{emit:f}){f("pageTitle","Telegram Login");const i=I(),o=g(new Map),e=N(),p=g(),w=x.getInstance();w.getLoginURLs(location.href.substring(0,location.href.length-9)).then(a=>{o.value=a});const d=g(!1);e&&r.variant!=="ADD_CREDENTIAL"&&(Date.now()-new Date(e.CreatedAt||"").getTime()>2e4?i.push("/"):i.push("/profile"));const A=(a,t=!1)=>{p.value=a,w.oAuthLogin("telegram","","","",t,a).then(u=>{const{created:v,tokens:y,user:D}=u;O(y,D,i,v)}).catch(u=>{u.ResponseCode==404?d.value=!0:console.error(u)})},V=a=>{A(p.value,!0),a&&(a("Account Created"),setTimeout(()=>{d.value=!1},1e3))},R=()=>{i.back()};return(a,t)=>{const u=G("router-link");return c(),m("div",null,[a.variant=="ADD_CREDENTIAL"?(c(),B(H,{key:0,style:{"max-width":"550px"}},{default:n(()=>[l(W,null,{default:n(()=>[l(F,{class:"text-center"},{default:n(()=>[l(S,null,{default:n(()=>t[1]||(t[1]=[M("Add a Telegram Account")])),_:1})]),_:1}),l(j,{class:"text-center"},{default:n(()=>[o.value.size>0?(c(),m(T,{key:0},[l(k,{mode:"callback","telegram-login":o.value.get("OAUTH_TELEGRAM_BOT")||"","redirect-url":o.value.get("OAUTH_TELEGRAM_REDIRECT"),"request-access":"write",userpic:!0,onCallback:A,variant:a.variant},null,8,["telegram-login","redirect-url","variant"]),s("div",$,[s("div",P,[l(u,{to:"/"},{default:n(()=>t[2]||(t[2]=[s("button",{class:"btn btn-danger form-control"}," Cancel ",-1)])),_:1})])])],64)):E("",!0)]),_:1})]),_:1})]),_:1})):(c(),m(T,{key:1},[t[4]||(t[4]=s("h2",null,"Telegram",-1)),o.value.size>0?(c(),m(T,{key:0},[l(k,{mode:"callback","telegram-login":o.value.get("OAUTH_TELEGRAM_BOT")||"","redirect-url":o.value.get("OAUTH_TELEGRAM_REDIRECT"),"request-access":"write",userpic:!0,onCallback:A,variant:a.variant},null,8,["telegram-login","redirect-url","variant"]),s("div",J,[s("div",K,[l(u,{to:"/"},{default:n(()=>t[3]||(t[3]=[s("button",{class:"btn btn-danger form-control"}," Cancel ",-1)])),_:1})])])],64)):E("",!0)],64)),l(z,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=v=>d.value=v),"show-save-action":!0,"show-reset-action":!1,"show-close-action":!0,"show-delete-action":!1,title:"Create new account","hide-extension":!0,"save-button-label":"Create Account",onSave:V,onClose:R},{default:n(()=>[s("p",Q,C(h(_).messageCreateTelegramAccount1),1),s("p",X,C(h(_).messageCreateTelegramAccount2),1),s("p",Y,C(h(_).messageCreateTelegramAccount3),1)]),_:1},8,["modelValue"])])}}});export{pe as default};
