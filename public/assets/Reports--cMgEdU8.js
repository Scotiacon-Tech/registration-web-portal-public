import{p as fe,d as he,a5 as ge,t as v,c as w,s as Q,a7 as ye,f as o,J as O,m as B,i as be,r as x,R as xe,q,v as u,N as Ve,Q as De,P as ke,n as F,B as Te,O as Ne,F as we,x as $,D as Re,A as Ie,y as Se}from"./index-CtJiBEcj.js";import{v as Ee}from"./v4-CQkTLCs1.js";import{V as X,a as Be}from"./VTable-BD6eJSup.js";import{a as Fe,b as Ue}from"./VTabs-DHBcT_7W.js";import{V as Ce}from"./VToolbar-Bt-HGb-Z.js";import{V as Pe,a as Y}from"./VRow-Bw21XZ4O.js";import{m as Ge,a as _e,u as He,b as Le,c as We,V as Ae}from"./filter-CANAzvAI.js";import{V as Oe}from"./scopeId-MRHufIiF.js";import{u as qe,V as ze,e as je}from"./VContainer-CksERWUh.js";import{e as Je}from"./VCard-Bk2P6cT7.js";import{b as Ke,s as Me,d as Qe,e as $e,g as Xe,u as Ye,p as Ze,h as et,t as tt,j as at,k as ot,l as lt,n as st,q as Z,r as ee,v as rt}from"./VDataTable-BXeJDjEO.js";import"./forwardRefs-BVcY16Oj.js";import"./VOverlay-b-A9_DTr.js";import"./VList-D4E1xP3C.js";import"./createSimpleFunctional-CBP32ssf.js";import"./VDivider-Bk5MarIc.js";import"./VChip-BzsHBfd9.js";import"./VTextField-CngCNHbP.js";import"./form-TY_kDQn9.js";import"./VCheckboxBtn-BVywYl8I.js";const nt=fe({...Ke(),...Me(),...Ge(),..._e()},"VDataTableVirtual"),it=he()({name:"VDataTableVirtual",props:nt(),emits:{"update:modelValue":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:groupBy":e=>!0,"update:expanded":e=>!0},setup(e,U){let{attrs:z,slots:a}=U;const{groupBy:f}=Qe(e),{sortBy:c,multiSort:m,mustSort:h}=$e(e),{disableSort:V}=ge(e),{columns:p,headers:g,filterFunctions:R,sortFunctions:C,sortRawFunctions:D}=Xe(e,{groupBy:f,showSelect:v(e,"showSelect"),showExpand:v(e,"showExpand")}),{items:I}=Ye(e,p),S=v(e,"search"),{filteredItems:P}=He(e,I,S,{transform:i=>i.columns,customKeyFilter:R}),{toggleSort:G}=Ze({sortBy:c,multiSort:m,mustSort:h}),{sortByWithGroups:_,opened:H,extractRows:E,isGroupOpen:s,toggleGroup:l}=et({groupBy:f,sortBy:c,disableSort:V}),{sortedItems:t}=tt(e,P,_,{transform:i=>({...i.raw,...i.columns}),sortFunctions:C,sortRawFunctions:D}),{flatItems:r}=at(t,f,H),y=w(()=>E(r.value)),{isSelected:n,select:L,selectAll:k,toggleSelect:T,someSelected:W,allSelected:te}=ot(e,{allItems:y,currentPage:y}),{isExpanded:ae,toggleExpand:oe}=lt(e),{containerRef:le,markerRef:se,paddingTop:re,paddingBottom:ne,computedItems:ie,handleItemResize:ue,handleScroll:me,handleScrollend:de}=Le(e,r),ce=w(()=>ie.value.map(i=>i.raw));st({sortBy:c,page:Q(1),itemsPerPage:Q(-1),groupBy:f,search:S}),ye({VDataTableRows:{hideNoData:v(e,"hideNoData"),noDataText:v(e,"noDataText"),loading:v(e,"loading"),loadingText:v(e,"loadingText")}});const N=w(()=>({sortBy:c.value,toggleSort:G,someSelected:W.value,allSelected:te.value,isSelected:n,select:L,selectAll:k,toggleSelect:T,isExpanded:ae,toggleExpand:oe,isGroupOpen:s,toggleGroup:l,items:y.value.map(i=>i.raw),internalItems:y.value,groupedItems:r.value,columns:p.value,headers:g.value}));qe(()=>{const i=Z.filterProps(e),pe=ee.filterProps(e),ve=X.filterProps(e);return o(X,B({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},ve),{top:()=>{var d;return(d=a.top)==null?void 0:d.call(a,N.value)},wrapper:()=>{var d,j,J;return o("div",{ref:le,onScrollPassive:me,onScrollend:de,class:"v-table__wrapper",style:{height:O(e.height)}},[o("table",null,[(d=a.colgroup)==null?void 0:d.call(a,N.value),!e.hideDefaultHeader&&o("thead",{key:"thead"},[o(Z,B(i,{sticky:e.fixedHeader}),a)]),!e.hideDefaultBody&&o("tbody",null,[o("tr",{ref:se,style:{height:O(re.value),border:0}},[o("td",{colspan:p.value.length,style:{height:0,border:0}},null)]),(j=a["body.prepend"])==null?void 0:j.call(a,N.value),o(ee,B(z,pe,{items:ce.value}),{...a,item:b=>o(We,{key:b.internalItem.index,renderless:!0,"onUpdate:height":A=>ue(b.internalItem.index,A)},{default:A=>{var M;let{itemRef:K}=A;return((M=a.item)==null?void 0:M.call(a,{...b,itemRef:K}))??o(rt,B(b.props,{ref:K,key:b.internalItem.index,index:b.internalItem.index}),a)}})}),(J=a["body.append"])==null?void 0:J.call(a,N.value),o("tr",{style:{height:O(ne.value),border:0}},[o("td",{colspan:p.value.length,style:{height:0,border:0}},null)])])])])},bottom:()=>{var d;return(d=a.bottom)==null?void 0:d.call(a,N.value)}})})}}),St=be({__name:"Reports",emits:["pageTitle"],setup(e,{emit:U}){var E;U("pageTitle","Reports");const a=Ve(),f=De(),c=ke(),m=x(),h=x([{Name:"Hotel",Data:[]}]),V=x({ID:0,ConventionUUID:Ee(),OrganisationID:0,OrganisationUUID:xe,Name:"",Description:"",DetailLink:"",Logo:"",Slug:"",Accommodation:[],Tickets:[],Extras:[],Interests:[],Visible:!1}),p=((E=f.params.convention)==null?void 0:E.toString())||"",g=x(),R=x([]);p?a.getConvention(p).then(s=>{if(s){V.value=s;const l=h.value.find(t=>t.Name=="Hotel");l&&(a.getHotelReport(V.value.ConventionUUID).then(t=>{l.Data=t}),a.getConventionVenues(V.value.ConventionUUID).then(t=>{R.value=t}))}}).catch(()=>{c.push("/")}):c.push("/");const C=w(()=>h.value.find(l=>l.Name===m.value)?m.value!=="Hotel"?[]:[{title:"First Name",align:"start",key:"FirstName"},{title:"Last Name",align:"start",key:"LastName"},{title:"Room Partners",align:"start",key:"Guests"},{title:"Venue",align:"start",key:"Venue"},{title:"Room Type",align:"start",key:"RoomType"},{title:"Arrival",align:"start",key:"ArrivalDay"},{title:"Departure",align:"start",key:"DepartureDay"}]:[]),D=w(()=>{const s=h.value.find(t=>t.Name===m.value);if(!s)return[];if(m.value!=="Hotel")return s.Data;const l=[];return s.Data.forEach(t=>{g.value&&t.Venue!=g.value||t.Guests.forEach((r,y)=>{const n={FirstName:"",LastName:"",Guests:"",Venue:"",RoomType:"",ArrivalDay:"",DepartureDay:""};n.FirstName=r.FirstName,n.LastName=r.LastName;const L=t.Guests.filter((T,W)=>W!==y);let k="";L.forEach(T=>{k+=T.FirstName+" "+T.LastName+","}),n.Guests=k.substring(0,k.length-1),n.Venue=t.Venue,n.RoomType=t.RoomType,n.ArrivalDay=t.Days[0],n.DepartureDay=t.Days[t.Days.length-1],l.push(n)})}),l}),I=x(),S="data:application/vnd.ms-excel;base64,",P='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><?xml version="1.0" encoding="UTF-8" standalone="yes"?><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table>{table}</table></body></html>',G=function(s){return btoa(unescape(encodeURIComponent(s)))},_=function(s,l){return s.replace(/{(\w+)}/g,function(t,r){return l[r]})},H=s=>{var r;const l=(r=I.value)==null?void 0:r.getElementsByTagName("table")[0],t={worksheet:s||"Worksheet",table:l.innerHTML};window.location.href=S+G(_(P,t))};return(s,l)=>(F(),q(Be,null,{default:u(()=>[o(Ce,{color:"blue-darken-4"},{default:u(()=>[o(Fe,{modelValue:m.value,"onUpdate:modelValue":l[0]||(l[0]=t=>m.value=t),"show-arrows":""},{default:u(()=>[(F(!0),Te(we,null,Ne(h.value,t=>(F(),q(Ue,{key:t.Name,value:t.Name},{default:u(()=>[$(Se(t.Name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(je,{fluid:""},{default:u(()=>[o(Pe,null,{default:u(()=>[o(Y,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:u(()=>[o(Ae,{modelValue:g.value,"onUpdate:modelValue":l[1]||(l[1]=t=>g.value=t),label:"Venue",items:R.value,"item-value":"Name","item-title":"Name",clearable:"",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),o(Oe),o(Y,{cols:"12",sm:"5",md:"3",lg:"2",xl:"2",class:"text-right"},{default:u(()=>[o(ze,{onClick:l[2]||(l[2]=t=>H(m.value)),color:"primary","prepend-icon":"mdi:mdi-table",class:"w-100 w-sm-auto"},{default:u(()=>l[3]||(l[3]=[$(" Download Excel ")])),_:1})]),_:1})]),_:1})]),_:1}),D.value?(F(),q(Je,{key:0,class:"pa-2"},{default:u(()=>[Re("div",{ref_key:"reportTable",ref:I},[o(it,{headers:C.value,items:D.value,"items-length":D.value.length},null,8,["headers","items","items-length"])],512)]),_:1})):Ie("",!0)]),_:1}))}});export{St as default};
