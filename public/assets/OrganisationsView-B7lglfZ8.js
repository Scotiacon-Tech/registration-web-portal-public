import{i as k,M as P,N as A,r as p,k as J,$ as S,n as c,q as b,v as a,f as e,x as v,y as N,F as g,A as T,P as X,R as ee,l as ae,W as te,D as F,Q as le,H as G}from"./index-BYUcw9ci.js";import{s as U}from"./index-fwfMqYug.js";import{u as h}from"./useStoreAPI-a2ygpJ6h.js";import{_ as oe}from"./DeleteDialog.vue_vue_type_script_setup_true_lang-DwtGHew8.js";import{e as B,c as ne,V as ie,a as se,b as re,d as ue}from"./VCard-CMRRsx1d.js";import{V as me,a as de}from"./VToolbar-DG40lq_x.js";import{V as fe}from"./scopeId-C-Yrn4ko.js";import{V as ge}from"./VToolbarItems-DNMVIUAu.js";import{V as w,d as pe,e as q}from"./VContainer-xaul2nd_.js";import{V as f,a as d}from"./VRow-YrLVLmgN.js";import{V as H}from"./forwardRefs-D5KRm88S.js";import{V as R}from"./VTextField-BygSyDr1.js";import{V as $}from"./VForm-afX2XJRK.js";import{V as ve}from"./VFileInput-2-lMFxCZ.js";import{V as E}from"./VTextarea-cEgsTDu0.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{G as Y}from"./userData-9t2oRYkd.js";import{V as Ve}from"./VDialog-CmZTbaxa.js";import{C as ce}from"./canEditOrganisation-B66KAn-E.js";import{G as _e}from"./group-Dg_peWef.js";import{C as Ce}from"./canDo-OE0QrT6s.js";import{v as Ie}from"./v4-CtRu48qb.js";import"./SaveButton.vue_vue_type_script_setup_true_lang-DUSCRHYx.js";import"./VOverlay-C6H669M5.js";import"./layout-D4mRpUpm.js";import"./createSimpleFunctional-BBuDDncE.js";import"./form-BUY7ClJX.js";import"./VChip-BbkYRCEa.js";const De=(_,C)=>{if(_===void 0)return!1;const i=Ce(_,_e.GROUP_TYPE_ORGANISATION,C.OrganisationUUID);return i.EditOrganisation||i.EditConvention||i.ManageViews||i.ViewRegistration||i.EditRegistration||i.ManageUsers},Oe=k({__name:"EditOrganisation",props:{modelValue:{required:!0},modelModifiers:{}},emits:P(["change","close","delete"],["update:modelValue"]),setup(_,{emit:C}){const i=C,r=X(),x=h(),I=A(_,"modelValue"),o=p(J(I.value)),D=p(`${x.GetOrganisationLogoURL(o.value.OrganisationUUID)}?${new Date().getTime()}`),V=S("imageFileInput"),s=S("organisationImageForm"),l=p(!1),O=p(""),m=S("form"),y=async()=>{var t;const n=new FormData((t=s.value)==null?void 0:t.$el);if(n.get("Image")&&n.get("Image").size>0)return n.set("OrganisationUUID",o.value.OrganisationUUID),await x.SaveOrganisationLogo(n)},j=()=>{var n;y(),(n=m.value)==null||n.validate().then(t=>{t&&r.saveOrganisation(o.value).then(u=>{u&&(I.value=u,i("change"),i("close"))})})},L=p({available:n=>!0,min:n=>n.length>=4||"Minimum 4 characters",required:n=>!!n||"Required.",valid:n=>!/[^0-9a-z_-]/.test(n)||"Only lower-case letters, numbers, hyphens and underscores permitted"}),M=()=>{l.value=!1},K=()=>{l.value=!0},W=p(`
<p class="mb-2">
  Are you sure you wish to delete this organisation? All data relating to it will be
  removed including all conventions their respective registrations and payment information.
  This action can not be undone.
</p>
<p class="mb-2">
  We are talking some Thanos level shit right here, if you proceed a team of super-powered
  beings with Daddy issues will hunt you down through time, space and a social media
  platform formerly known as twitter.
</p>
<p>
  To confirm type "I CLICK MY FINGERS" in the box below.
</p>
`),Q=n=>{O.value="",r.deleteOrganisation(o.value.OrganisationUUID).then(t=>{t?n&&n("Organisation Deleted"):n&&n("Failed to Delete Organisation"),setTimeout(()=>{M(),i("delete")},2e3)}).catch(()=>{n&&(n("Failed to Delete Organisation"),setTimeout(M,2e3))})},Z=()=>{try{V.value&&V.value.files&&V.value.files[0]&&(D.value=URL.createObjectURL(V.value.files[0]))}catch{}};return(n,t)=>(c(),b($,{"fast-fail":"",ref:"form"},{default:a(()=>[e(B,null,{default:a(()=>[e(me,{dark:"",color:"primary"},{default:a(()=>[e(de,null,{default:a(()=>[v(N(o.value.Name),1)]),_:1}),e(fe),e(ge,null,{default:a(()=>[e(w,{variant:"text",onClick:K},{default:a(()=>t[7]||(t[7]=[v(" Delete ")])),_:1}),e(w,{variant:"text",onClick:j},{default:a(()=>t[8]||(t[8]=[v(" Save ")])),_:1}),e(w,{icon:"",dark:"",onClick:t[0]||(t[0]=u=>i("close"))},{default:a(()=>[e(pe,null,{default:a(()=>t[9]||(t[9]=[v("mdi:mdi-close")])),_:1})]),_:1})]),_:1})]),_:1}),e(ne,null,{default:a(()=>[e(q,{fluid:!0},{default:a(()=>[e(f,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(H,{class:"imgLogo mx-auto",src:D.value||""},null,8,["src"])]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(R,{label:g(U).formLabelName,type:"text",variant:"outlined",modelValue:o.value.Name,"onUpdate:modelValue":t[1]||(t[1]=u=>o.value.Name=u)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(R,{label:g(U).formLabelSlug,pattern:"[a-zA-Z0-9_\\-]{6,25}",rules:[L.value.available,L.value.min,L.value.required,L.value.valid],type:"text",variant:"outlined",modelValue:o.value.Slug,"onUpdate:modelValue":t[2]||(t[2]=u=>o.value.Slug=u)},null,8,["label","rules","modelValue"])]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(R,{label:g(U).formLabelDomain,type:"text",variant:"outlined",modelValue:o.value.Domain,"onUpdate:modelValue":t[3]||(t[3]=u=>o.value.Domain=u)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(d,null,{default:a(()=>[e($,{ref:"organisationImageForm",enctype:"multipart/form-data"},{default:a(()=>[e(ve,{label:g(U).formLabelLogo,name:"Image",variant:"outlined",ref:"imageFileInput",accept:"image/avif, image/bmp, image/gif, image/jpeg, image/png, image/webp","hide-details":"",onChange:Z},null,8,["label"])]),_:1})]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(E,{label:g(U).formLabelCSS,type:"text",variant:"outlined",modelValue:o.value.CSS,"onUpdate:modelValue":t[4]||(t[4]=u=>o.value.CSS=u)},null,8,["label","modelValue"])]),_:1})]),_:1}),e(f,null,{default:a(()=>[e(d,{cols:"12"},{default:a(()=>[e(E,{label:g(U).formLabelHTML,type:"text",variant:"outlined",modelValue:o.value.HTML,"onUpdate:modelValue":t[5]||(t[5]=u=>o.value.HTML=u)},null,8,["label","modelValue"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l.value?(c(),b(oe,{key:0,modelValue:l.value,"onUpdate:modelValue":t[6]||(t[6]=u=>l.value=u),title:`Delete ${o.value.Name}`,subtitle:"Your will be done",message:W.value,"confirmation-text":"I CLICK MY FINGERS",onDelete:Q},null,8,["modelValue","title","message"])):T("",!0)]),_:1}))}}),Ue=z(Oe,[["__scopeId","data-v-30fb6098"]]),be=k({__name:"OrganisationCard",props:{modelValue:{required:!0},modelModifiers:{}},emits:P(["delete"],["update:modelValue"]),setup(_,{emit:C}){const i=Y();(!i||!i.Groups.find(s=>s.Permission.EditConvention)&&!i.Groups.find(s=>s.Permission.EditOrganisation)&&!i.Groups.find(s=>s.Permission.EditRegistration)&&!i.Groups.find(s=>s.Permission.ManageViews)&&!i.Groups.find(s=>s.Permission.ViewRegistration))&&ee().push("/");const r=A(_,"modelValue"),x=C,I=h(),o=p(!1),D=p(""),V=()=>{D.value=`${I.GetOrganisationLogoURL(r.value.OrganisationUUID)}?${new Date().getTime()}`};return V(),(s,l)=>{const O=ae("RouterLink");return c(),b(B,null,{default:a(()=>[e(ie,{class:"flex-1-1 align-content-start"},{default:a(()=>[e(H,{class:"imgLogo mx-auto",src:D.value||""},null,8,["src"]),e(se,null,{default:a(()=>[v(N(r.value.Name),1)]),_:1}),e(re,null,{default:a(()=>[v(N(r.value.Slug),1)]),_:1})]),_:1}),e(ue,null,{default:a(()=>[e(f,{"no-gutters":""},{default:a(()=>[e(d,{class:"ma-1"},{default:a(()=>[e(w,{variant:"tonal",color:"primary",onClick:l[0]||(l[0]=m=>o.value=!0),width:"100%"},{default:a(()=>l[5]||(l[5]=[v("Edit")])),_:1})]),_:1}),T("",!0),e(d,{class:"ma-1"},{default:a(()=>[e(O,{to:`/admin/organisations/${r.value.Slug?r.value.Slug:r.value.OrganisationUUID}`},{default:a(()=>[e(w,{variant:"tonal",color:"green",width:"100%"},{default:a(()=>l[7]||(l[7]=[v("Convention Manager")])),_:1})]),_:1},8,["to"])]),_:1})]),_:1})]),_:1}),e(Ve,{modelValue:o.value,"onUpdate:modelValue":l[4]||(l[4]=m=>o.value=m),scrollable:!0,fullscreen:!0,persistent:!0},{default:a(()=>[e(Ue,{onClose:l[1]||(l[1]=m=>o.value=!1),modelValue:r.value,"onUpdate:modelValue":l[2]||(l[2]=m=>r.value=m),onDelete:l[3]||(l[3]=m=>{o.value=!1,x("delete")}),onChange:V},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1})}}}),we=z(be,[["__scopeId","data-v-13dc9387"]]),ea=k({__name:"OrganisationsView",emits:["pageTitle"],setup(_,{emit:C}){const i=te.getInstance(),r=p([]);C("pageTitle","Organisations");const I=Y(),o=()=>{const s={ID:0,OrganisationUUID:Ie(),Name:"New Organisation",Slug:"",Logo:"",Domain:"",CSS:"",HTML:""};i.saveOrganisation(s).then(l=>{l&&r.value.push(l)})},D=s=>{r.value.splice(s,1)};return(()=>{i.getOrganisations().then(s=>{r.value=s})})(),(s,l)=>(c(),b(q,null,{default:a(()=>[e(f,null,{default:a(()=>[(c(!0),F(G,null,le(r.value,(O,m)=>(c(),F(G,{key:O.ID},[g(De)(g(I),O)?(c(),b(d,{key:0,cols:"12",sm:"6",md:"4",lg:"3",class:"d-flex flex-column"},{default:a(()=>[e(we,{modelValue:r.value[m],"onUpdate:modelValue":y=>r.value[m]=y,class:"elevation-5 flex-1-0 d-flex flex-column",onDelete:y=>D(m)},null,8,["modelValue","onUpdate:modelValue","onDelete"])]),_:2},1024)):T("",!0)],64))),128))]),_:1}),e(f,null,{default:a(()=>[g(ce)(g(I))?(c(),b(d,{key:0,class:"text-right"},{default:a(()=>[e(w,{color:"primary",onClick:o},{default:a(()=>l[0]||(l[0]=[v("New")])),_:1})]),_:1})):T("",!0)]),_:1})]),_:1}))}});export{ea as default};
