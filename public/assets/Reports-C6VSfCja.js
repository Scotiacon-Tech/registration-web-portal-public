import{p as ge,d as ye,a7 as be,t as f,c as w,s as J,a9 as xe,f as l,L as q,m as S,i as Ve,r as E,C as Te,$ as De,q as z,v as n,P as ke,R as we,n as _,D as Re,Q as Ne,H as Ie,x as B,G as X,y as $,A as Se}from"./index-DcKBb7fk.js";import{u as Ee}from"./useConventionSlug-C18qjQhp.js";import{V as Y,a as _e}from"./VTable-CUTzrQ0e.js";import{a as Be,V as Ce}from"./VTabs-lfUuNTe3.js";import{V as Fe}from"./VToolbar-CV8uAiBn.js";import{V as Ge,a as Z}from"./VRow-CcmXANCC.js";import{m as Pe,a as Ae,u as He,b as Ue,c as We,V as Le}from"./filter-CoQC0Gw-.js";import{V as Oe}from"./scopeId--7CXZsK-.js";import{u as qe,V as ze,e as $e}from"./VContainer-DI-_rbra.js";import{e as je}from"./VCard-Cgz4kbGF.js";import{b as Ke,s as Me,d as Qe,e as Je,g as Xe,u as Ye,p as Ze,h as et,t as tt,j as at,k as ot,l as lt,n as st,q as ee,r as te,v as rt}from"./VDataTable-CX_VCx6u.js";import"./forwardRefs-Dgxk6Fjf.js";import"./VOverlay-Ci0XlS4n.js";import"./VList-Jqe8K4vK.js";import"./createSimpleFunctional-CM7T0et9.js";import"./VDivider-3ZNQ8IOM.js";import"./VChip-DLNbhnC4.js";import"./VTextField-C1dFdLDj.js";import"./form-hFQiDDpT.js";import"./VCheckboxBtn-DJ-tn93R.js";const nt=ge({...Ke(),...Me(),...Pe(),...Ae()},"VDataTableVirtual"),it=ye()({name:"VDataTableVirtual",props:nt(),emits:{"update:modelValue":t=>!0,"update:sortBy":t=>!0,"update:options":t=>!0,"update:groupBy":t=>!0,"update:expanded":t=>!0},setup(t,C){let{attrs:v,slots:o}=C;const{groupBy:b}=Qe(t),{sortBy:p,multiSort:F,mustSort:u}=Je(t),{disableSort:h}=be(t),{columns:m,headers:R,filterFunctions:G,sortFunctions:x,sortRawFunctions:N}=Xe(t,{groupBy:b,showSelect:f(t,"showSelect"),showExpand:f(t,"showExpand")}),{items:P}=Ye(t,m),I=f(t,"search"),{filteredItems:A}=He(t,P,I,{transform:i=>i.columns,customKeyFilter:G}),{toggleSort:H}=Ze({sortBy:p,multiSort:F,mustSort:u}),{sortByWithGroups:U,opened:s,extractRows:a,isGroupOpen:e,toggleGroup:d}=et({groupBy:b,sortBy:p,disableSort:h}),{sortedItems:W}=tt(t,A,U,{transform:i=>({...i.raw,...i.columns}),sortFunctions:x,sortRawFunctions:N}),{flatItems:r}=at(W,b,s),g=w(()=>a(r.value)),{isSelected:V,select:T,selectAll:D,toggleSelect:L,someSelected:ae,allSelected:oe}=ot(t,{allItems:g,currentPage:g}),{isExpanded:le,toggleExpand:se}=lt(t),{containerRef:re,markerRef:ne,paddingTop:ie,paddingBottom:ue,computedItems:me,handleItemResize:de,handleScroll:ce,handleScrollend:pe}=Ue(t,r),fe=w(()=>me.value.map(i=>i.raw));st({sortBy:p,page:J(1),itemsPerPage:J(-1),groupBy:b,search:I}),xe({VDataTableRows:{hideNoData:f(t,"hideNoData"),noDataText:f(t,"noDataText"),loading:f(t,"loading"),loadingText:f(t,"loadingText")}});const k=w(()=>({sortBy:p.value,toggleSort:H,someSelected:ae.value,allSelected:oe.value,isSelected:V,select:T,selectAll:D,toggleSelect:L,isExpanded:le,toggleExpand:se,isGroupOpen:e,toggleGroup:d,items:g.value.map(i=>i.raw),internalItems:g.value,groupedItems:r.value,columns:m.value,headers:R.value}));qe(()=>{const i=ee.filterProps(t),ve=te.filterProps(t),he=Y.filterProps(t);return l(Y,S({class:["v-data-table",{"v-data-table--loading":t.loading},t.class],style:t.style},he),{top:()=>{var c;return(c=o.top)==null?void 0:c.call(o,k.value)},wrapper:()=>{var c,j,K;return l("div",{ref:re,onScrollPassive:ce,onScrollend:pe,class:"v-table__wrapper",style:{height:q(t.height)}},[l("table",null,[(c=o.colgroup)==null?void 0:c.call(o,k.value),!t.hideDefaultHeader&&l("thead",{key:"thead"},[l(ee,S(i,{sticky:t.fixedHeader}),o)]),!t.hideDefaultBody&&l("tbody",null,[l("tr",{ref:ne,style:{height:q(ie.value),border:0}},[l("td",{colspan:m.value.length,style:{height:0,border:0}},null)]),(j=o["body.prepend"])==null?void 0:j.call(o,k.value),l(te,S(v,ve,{items:fe.value}),{...o,item:y=>l(We,{key:y.internalItem.index,renderless:!0,"onUpdate:height":O=>de(y.internalItem.index,O)},{default:O=>{var Q;let{itemRef:M}=O;return((Q=o.item)==null?void 0:Q.call(o,{...y,itemRef:M}))??l(rt,S(y.props,{ref:M,key:y.internalItem.index,index:y.internalItem.index}),o)}})}),(K=o["body.append"])==null?void 0:K.call(o,k.value),l("tr",{style:{height:q(ue.value),border:0}},[l("td",{colspan:m.value.length,style:{height:0,border:0}},null)])])])])},bottom:()=>{var c;return(c=o.bottom)==null?void 0:c.call(o,k.value)}})})}}),St=Ve({__name:"Reports",emits:["pageTitle"],async setup(t,{emit:C}){let v,o;C("pageTitle","Reports");const p=ke(),F=we(),u=E(),h=E([{Name:"Hotel",Data:[]}]),m=E(),R=E([]);try{const s=([v,o]=Te(()=>Ee()),v=await v,o(),v);if(s){const a=h.value.find(e=>e.Name=="Hotel");a&&(p.getHotelReport(s.ConventionUUID).then(e=>{a.Data=e}),p.getConventionVenues(s.ConventionUUID).then(e=>{R.value=e}))}}catch{F.push("/")}const G=w(()=>h.value.find(a=>a.Name===u.value)?u.value!=="Hotel"?[]:[{title:"First Name",align:"start",key:"FirstName"},{title:"Last Name",align:"start",key:"LastName"},{title:"Room Partners",align:"start",key:"Guests"},{title:"Venue",align:"start",key:"Venue"},{title:"Room Type",align:"start",key:"RoomType"},{title:"Arrival",align:"start",key:"ArrivalDay"},{title:"Departure",align:"start",key:"DepartureDay"}]:[]),x=w(()=>{const s=h.value.find(e=>e.Name===u.value);if(!s)return[];if(u.value!=="Hotel")return s.Data;const a=[];return s.Data.forEach(e=>{m.value&&e.Venue!=m.value||e.Guests.forEach((d,W)=>{const r={FirstName:"",LastName:"",Guests:"",Venue:"",Accommodation:"",RoomType:"",ArrivalDay:"",DepartureDay:""};r.FirstName=d.FirstName,r.LastName=d.LastName;const g=e.Guests.filter((D,L)=>L!==W);let V="";g.forEach(D=>{V+=D.FirstName+" "+D.LastName+","}),r.Guests=V.substring(0,V.length-1),r.Venue=e.Venue;const T=e.Accommodation.match(/\((.*?)\)/);T&&T.length>=1&&(r.Accommodation=T[1]),r.RoomType=e.RoomType,r.ArrivalDay=e.Days[0],r.DepartureDay=e.Days[e.Days.length-1],a.push(r)})}),a}),N=De("reportTable"),P="data:application/vnd.ms-excel;base64,",I='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><?xml version="1.0" encoding="UTF-8" standalone="yes"?><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table>{table}</table></body></html>',A=function(s){return btoa(unescape(encodeURIComponent(s)))},H=function(s,a){return s.replace(/{(\w+)}/g,function(e,d){return a[d]})},U=s=>{var e;const a=(e=N.value)==null?void 0:e.getElementsByTagName("table")[0];if(a){const d={worksheet:s||"Worksheet",table:a.innerHTML};window.location.href=P+A(H(I,d))}};return(s,a)=>(_(),z(_e,null,{default:n(()=>[l(Fe,{color:"blue-darken-4"},{default:n(()=>[l(Be,{modelValue:u.value,"onUpdate:modelValue":a[0]||(a[0]=e=>u.value=e),"show-arrows":""},{default:n(()=>[(_(!0),Re(Ie,null,Ne(h.value,e=>(_(),z(Ce,{key:e.Name,value:e.Name},{default:n(()=>[B($(e.Name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l($e,{fluid:""},{default:n(()=>[l(Ge,null,{default:n(()=>[l(Z,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:n(()=>[l(Le,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),label:"Venue",items:R.value,"item-value":"Name","item-title":"Name",clearable:"",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),l(Oe),l(Z,{cols:"12",sm:"5",md:"3",lg:"2",xl:"2",class:"text-right"},{default:n(()=>[l(ze,{onClick:a[2]||(a[2]=e=>U(u.value)),color:"primary","prepend-icon":"mdi:mdi-table",class:"w-100 w-sm-auto"},{default:n(()=>a[3]||(a[3]=[B(" Download Excel ")])),_:1})]),_:1})]),_:1})]),_:1}),x.value?(_(),z(je,{key:0,class:"pa-2"},{default:n(()=>[X("div",{ref_key:"reportTable",ref:N},[l(it,{headers:G.value,items:x.value,"items-length":x.value.length},{"item.RoomType":n(({item:e})=>[B($(e.RoomType)+" ",1),a[4]||(a[4]=X("br",null,null,-1)),B(" ("+$(e.Accommodation)+") ",1)]),_:2},1032,["headers","items","items-length"])],512)]),_:1})):Se("",!0)]),_:1}))}});export{St as default};
