import{p as L,r as f,s as I,c as p,a as me,w as U,o as ve,b as fe,d as B,u as ge,e as Q,t as A,f as t,m as $,h as X,i as F,j as Z,k as j,l as H,n as y,q as _,v as i,x as ee,y as z,z as pe,A as R,E as ae,B as te,C as he,D as ye,F as x,G as q,H as Ve,I as le,J as oe,K as ke,L as _e,T as be,S as Se}from"./index-D8LE9DJo.js";import{G as Te,R as O,a as Ce}from"./userData-0-dNwNyC.js";import{u as we}from"./useAvatar-BJijxpRp.js";import{C as Ie}from"./canEditOrganisation-znJtQEw6.js";import{C as D,G as M}from"./canDo-Bme8vyMY.js";import{C as Pe}from"./canViewOperations-B-MVbBLZ.js";import{u as Re}from"./useAdvancedMode-MrLXPlz4.js";import{m as Le,V as J,a as Ne}from"./VToolbar-BbiYSpRe.js";import{m as ne,u as se,a as re,c as ue,V as Be}from"./scopeId-CiU1GPjW.js";import{V as Ee}from"./VTextField-CunGJpW7.js";import{u as E,m as Ue,V as Ae,a as Y,b as xe,c as De,d as ie,e as K,f as Me,g as Oe,h as He,i as ze,j as Ge,k as $e,l as Fe,n as Ye,o as je}from"./VContainer-DnAFk3gr.js";import{u as qe,V as W,a as S,b as Je}from"./VList-Bo9ID7DL.js";import{V as G,a as Ke}from"./forwardRefs-BM06_4Nr.js";import{V as We}from"./VDivider-CG7sj3Q6.js";import{V as Qe,a as ce}from"./VNavigationDrawer-C6VewufX.js";import{_ as de}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{s as Xe}from"./index-fwfMqYug.js";import"./useStoreAPI-CyFlzqhd.js";import"./createSimpleFunctional-BAqwuIKA.js";import"./form-D7oJdNAY.js";const Ze=(e,u=void 0)=>e===void 0?!1:u===void 0?D(e,M.GROUP_TYPE_CONVENTION).ManageUsers:D(e,M.GROUP_TYPE_CONVENTION,u.ConventionUUID,u).ManageUsers,ea=(e,u=void 0)=>{let l;return e===void 0?!1:(u===void 0?l=D(e,M.GROUP_TYPE_CONVENTION):l=D(e,M.GROUP_TYPE_CONVENTION,u.ConventionUUID,u),l.EditConvention||l.ManageViews||l.ViewRegistration||l.EditRegistration)},aa=L({scrollTarget:{type:String},scrollThreshold:{type:[String,Number],default:300}},"scroll");function ta(e){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{canScroll:l}=u;let c=0,o=0;const a=f(null),s=I(0),d=I(0),m=I(0),v=I(!1),r=I(!1),V=p(()=>Number(e.scrollThreshold)),C=p(()=>me((V.value-s.value)/V.value||0)),h=()=>{const g=a.value;if(!g||l&&!l.value)return;c=s.value,s.value="window"in g?g.pageYOffset:g.scrollTop;const b=g instanceof Window?document.documentElement.scrollHeight:g.scrollHeight;if(o!==b){o=b;return}r.value=s.value<c,m.value=Math.abs(s.value-V.value)};return U(r,()=>{d.value=d.value||s.value}),U(v,()=>{d.value=0}),ve(()=>{U(()=>e.scrollTarget,g=>{var w;const b=g?document.querySelector(g):window;b&&b!==a.value&&((w=a.value)==null||w.removeEventListener("scroll",h),a.value=b,a.value.addEventListener("scroll",h,{passive:!0}))},{immediate:!0})}),fe(()=>{var g;(g=a.value)==null||g.removeEventListener("scroll",h)}),l&&U(l,h,{immediate:!0}),{scrollThreshold:V,currentScroll:s,currentThreshold:m,isScrollActive:v,scrollRatio:C,isScrollingUp:r,savedScroll:d}}const la=L({scrollBehavior:String,modelValue:{type:Boolean,default:!0},location:{type:String,default:"top",validator:e=>["top","bottom"].includes(e)},...Le(),...ne(),...aa(),height:{type:[Number,String],default:64}},"VAppBar"),oa=B()({name:"VAppBar",props:la(),emits:{"update:modelValue":e=>!0},setup(e,u){let{slots:l}=u;const c=f(),o=ge(e,"modelValue"),a=p(()=>{var k;const n=new Set(((k=e.scrollBehavior)==null?void 0:k.split(" "))??[]);return{hide:n.has("hide"),fullyHide:n.has("fully-hide"),inverted:n.has("inverted"),collapse:n.has("collapse"),elevate:n.has("elevate"),fadeImage:n.has("fade-image")}}),s=p(()=>{const n=a.value;return n.hide||n.fullyHide||n.inverted||n.collapse||n.elevate||n.fadeImage||!o.value}),{currentScroll:d,scrollThreshold:m,isScrollingUp:v,scrollRatio:r}=ta(e,{canScroll:s}),V=p(()=>a.value.hide||a.value.fullyHide),C=p(()=>e.collapse||a.value.collapse&&(a.value.inverted?r.value>0:r.value===0)),h=p(()=>e.flat||a.value.fullyHide&&!o.value||a.value.elevate&&(a.value.inverted?d.value>0:d.value===0)),g=p(()=>a.value.fadeImage?a.value.inverted?1-r.value:r.value:void 0),b=p(()=>{var N,T;if(a.value.hide&&a.value.inverted)return 0;const n=((N=c.value)==null?void 0:N.contentHeight)??0,k=((T=c.value)==null?void 0:T.extensionHeight)??0;return V.value?d.value<m.value||a.value.fullyHide?n+k:n:n+k});Q(p(()=>!!e.scrollBehavior),()=>{X(()=>{V.value?a.value.inverted?o.value=d.value>m.value:o.value=v.value||d.value<m.value:o.value=!0})});const{ssrBootStyles:w}=qe(),{layoutItemStyles:P}=se({id:e.name,order:p(()=>parseInt(e.order,10)),position:A(e,"location"),layoutSize:b,elementSize:I(void 0),active:o,absolute:A(e,"absolute")});return E(()=>{const n=J.filterProps(e);return t(J,$({ref:c,class:["v-app-bar",{"v-app-bar--bottom":e.location==="bottom"},e.class],style:[{...P.value,"--v-toolbar-image-opacity":g.value,height:void 0,...w.value},e.style]},n,{collapse:C.value,flat:h.value}),l)}),{}}}),na=L({...Ue({icon:"$menu",variant:"text"})},"VAppBarNavIcon"),sa=B()({name:"VAppBarNavIcon",props:na(),setup(e,u){let{slots:l}=u;return E(()=>t(Ae,$(e,{class:["v-app-bar-nav-icon"]}),l)),{}}}),ra=L({...Y(),...xe(),...re()},"VLayout"),ua=B()({name:"VLayout",props:ra(),setup(e,u){let{slots:l}=u;const{layoutClasses:c,layoutStyles:o,getLayoutItem:a,items:s,layoutRef:d}=ue(e),{dimensionStyles:m}=De(e);return E(()=>{var v;return t("div",{ref:d,class:[c.value,e.class],style:[m.value,o.value,e.style]},[(v=l.default)==null?void 0:v.call(l)])}),{getLayoutItem:a,items:s}}}),ia=F({__name:"DashboardLayout",props:{user:{}},setup(e){const u=we(),l=Z(),c=f(!1),o=f("Default Title"),a=f(""),s=f(j(e.user)),d=f(u(s.value.UserUUID)),m=ae.getInstance();Re(),m.on("user.profile.saved",P=>{s.value=j(P)});const v=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",r=f(localStorage.getItem("theme")||v());l.global.name.value=r.value;const V=()=>{r.value=="light"?r.value="dark":r.value="light",l.global.name.value=r.value,localStorage.setItem("theme",r.value)},C=async P=>{o.value=P;const n=await te();document.title=`${n!=null&&n.Name?`${n.Name} - `:""} ${o.value}`},h=f(ea(e.user)),g=f(Pe(e.user)),b=f(Ie(e.user)),w=f(Ze(e.user));return(P,n)=>{const k=H("RouterLink"),N=H("RouterView");return y(),_(ua,{class:"h-100"},{default:i(()=>[t(oa,{color:"blue-darken-3"},{default:i(()=>[t(Ne,null,{default:i(()=>[ee(z(o.value),1)]),_:1}),t(Be),t(Ee,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=T=>a.value=T),"prepend-inner-icon":"mdi:mdi-magnify",label:"Search",variant:"underlined","hide-details":"",clearable:!0,class:"d-none"},null,8,["modelValue"]),t(sa,{variant:"text",onClick:n[1]||(n[1]=pe(T=>c.value=!c.value,["stop"]))})]),_:1}),t(Qe,{modelValue:c.value,"onUpdate:modelValue":n[2]||(n[2]=T=>c.value=T),location:"right",temporary:!0},{default:i(()=>[t(W,null,{default:i(()=>[t(k,{to:{name:"Profile"}},{default:i(()=>[t(S,{title:s.value.DisplayName},{prepend:i(()=>[d.value?(y(),_(G,{key:0,src:d.value,class:"rounded-circle mr-2",height:"32",width:"32"},null,8,["src"])):(y(),_(ie,{key:1,icon:"mdi:mdi-account-circle",size:"x-large"}))]),_:1},8,["title"])]),_:1})]),_:1}),t(We),t(N,{name:"navigation"},{default:i(()=>[t(W,null,{default:i(()=>[t(k,{to:"/"},{default:i(()=>[t(S,{"prepend-icon":"mdi:mdi-view-dashboard-outline",title:"Home",value:"home"})]),_:1}),h.value||b.value||w.value?(y(),_(Je,{key:0,value:"Admin"},{activator:i(({props:T})=>[t(S,$(T,{"prepend-icon":"mdi:mdi-security",title:"Admin"}),null,16)]),default:i(()=>[h.value||g.value?(y(),_(k,{key:0,to:"/admin/conventions"},{default:i(()=>[t(S,{"prepend-icon":"mdi:mdi-domain",title:"Conventions",value:"Conventions"})]),_:1})):R("",!0),b.value||h.value?(y(),_(k,{key:1,to:"/admin/email/templates"},{default:i(()=>[t(S,{"prepend-icon":"mdi:mdi-email-edit-outline",title:"Email Templates",value:"Email Templates"})]),_:1})):R("",!0),b.value?(y(),_(k,{key:2,to:"/admin/organisations"},{default:i(()=>[t(S,{"prepend-icon":"mdi:mdi-store",title:"Organisations",value:"Organisations"})]),_:1})):R("",!0),w.value?(y(),_(k,{key:3,to:"/admin/groups"},{default:i(()=>[t(S,{"prepend-icon":"mdi:mdi-key-chain-variant",title:"Permissions",value:"Permissions"})]),_:1})):R("",!0)]),_:1})):R("",!0),t(k,{to:{name:"Profile"}},{default:i(()=>[t(S,{"prepend-icon":"mdi:mdi-account-circle",title:"Manage Account"})]),_:1}),t(S,{"prepend-icon":"mdi:mdi-theme-light-dark",onClick:V,title:`${r.value=="light"?"Dark":"Light"} Mode`},null,8,["title"]),t(k,{to:"/logout"},{default:i(()=>[t(S,{"prepend-icon":"mdi:mdi-logout",title:"Logout",value:"Logout"})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ce,null,{default:i(()=>[t(N,{onPageTitle:C,"logged-in":!0})]),_:1})]),_:1})}}}),ca=de(ia,[["__scopeId","data-v-46a45b2e"]]),da="/assets/graze-logo-R84bxePu.svg",ma=F({__name:"LoginLayout",async setup(e){let u,l;const c=Z(),o=f();o.value=([u,l]=he(()=>te()),u=await u,l(),u),document.title=`${o.value?`${o.value.Name} - `:"Convention"} Registration System`;const a=()=>window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light",s=f(localStorage.getItem("theme")||a());return c.global.name.value=s.value,(d,m)=>{const v=H("RouterView");return y(),ye(Ve,null,[t(K,{class:"logo-container text-center"},{default:i(()=>{var r;return[o.value&&o.value.Logo?(y(),_(G,{key:0,src:o.value.Logo,class:"graze-logo ma-auto"},null,8,["src"])):(y(),_(G,{key:1,src:x(da),class:"graze-logo ma-auto"},null,8,["src"])),q("h1",null,z(((r=o.value)==null?void 0:r.Name)||"Graze")+" Registration System",1)]}),_:1}),t(K,{class:"login-container text-center mb-0 rounded rounded-lg mb-md-10"},{default:i(()=>[t(Ke,null,{default:i(()=>[t(ie,{class:"ma-2 pa-5 bg-indigo rounded-circle",color:"white",icon:"mdi:mdi-lock-outline"})]),_:1}),q("h2",null,z(x(Xe).headingSignIn),1),t(v,{"logged-in":!1})]),_:1})],64)}}}),va=de(ma,[["__scopeId","data-v-7a044b9b"]]),fa=L({...Y(),...re({fullHeight:!0}),...le()},"VApp"),ga=B()({name:"VApp",props:fa(),setup(e,u){let{slots:l}=u;const c=oe(e),{layoutClasses:o,getLayoutItem:a,items:s,layoutRef:d}=ue(e),{rtlClasses:m}=ke();return E(()=>{var v;return t("div",{ref:d,class:["v-application",c.themeClasses.value,o.value,m.value,e.class],style:[e.style]},[t("div",{class:"v-application__wrap"},[(v=l.default)==null?void 0:v.call(l)])])}),{getLayoutItem:a,items:s,theme:c}}}),pa=L({app:Boolean,color:String,height:{type:[Number,String],default:"auto"},...Me(),...Y(),...Oe(),...ne(),...He(),...ze({tag:"footer"}),...le()},"VFooter"),ha=B()({name:"VFooter",props:pa(),setup(e,u){let{slots:l}=u;const c=f(),{themeClasses:o}=oe(e),{backgroundColorClasses:a,backgroundColorStyles:s}=Ge(A(e,"color")),{borderClasses:d}=$e(e),{elevationClasses:m}=Fe(e),{roundedClasses:v}=Ye(e),r=I(32),{resizeRef:V}=je(h=>{h.length&&(r.value=h[0].target.clientHeight)}),C=p(()=>e.height==="auto"?r.value:parseInt(e.height,10));return Q(()=>e.app,()=>{const h=se({id:e.name,order:p(()=>parseInt(e.order,10)),position:p(()=>"bottom"),layoutSize:C,elementSize:p(()=>e.height==="auto"?void 0:C.value),active:p(()=>e.app),absolute:A(e,"absolute")});X(()=>{c.value=h.layoutItemStyles.value})}),E(()=>t(e.tag,{ref:V,class:["v-footer",o.value,a.value,d.value,m.value,v.value,e.class],style:[s.value,e.app?c.value:{height:_e(e.height)},e.style]},l)),{}}}),Ma=F({__name:"Default",emits:["pageTitle"],setup(e,{emit:u}){let l=Te();const c=be.getInstance(),o=c.getTokenByService("GrazeAPI"),a=f(!1),s=f(!1),d=u,m=ae.getInstance();m.on("login",r=>{l=r,a.value=!0}),m.on("logout",()=>{l=void 0,a.value=!1}),m.on("tokenManager.tokenUpdated",()=>{a.value=!0,s.value=!0}),m.on("tokenManager.sessionExpired",()=>{a.value=!1,s.value=!1,O(),location.reload()}),o?l?o.AccessExpires<=Date.now()&&o.RefreshExpires>Date.now()?c.refreshToken(o):o.AccessExpires>Date.now()?(O(),a.value=!1,s.value=!0):(a.value=!0,s.value=!0):Ce().then(r=>{l=r,a.value=!0,s.value=!0}).catch(()=>{a.value=!1,s.value=!0}):(O(),a.value=!1,s.value=!0);const v=r=>{d("pageTitle",r)};return(r,V)=>(y(),_(Se,null,{default:i(()=>[t(ga,{class:"bg-image"},{default:i(()=>[s.value?(y(),_(ce,{key:0},{default:i(()=>[a.value&&x(l)?(y(),_(ca,{key:0,user:x(l),onPageTitle:v},null,8,["user"])):(y(),_(va,{key:1}))]),_:1})):R("",!0),t(ha,null,{default:i(()=>V[0]||(V[0]=[ee(" Powered by Graze ")])),_:1})]),_:1})]),_:1}))}});export{Ma as default};
