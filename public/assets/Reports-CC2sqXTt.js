import{p as ye,d as be,a7 as xe,t as f,c as N,s as Y,a9 as Ve,f as l,J as q,m as B,Q as De,N as ae,i as Te,r as R,Y as ke,q as z,v as n,P as we,n as F,B as Re,O as Ne,F as Se,x as _,D as $,y as j,A as Ie}from"./index-BYb2vsVH.js";import{V as X,a as Ee}from"./VTable-BjfvLADu.js";import{a as Be,V as Fe}from"./VTabs-C8YaHzdu.js";import{V as _e}from"./VToolbar-BZuojw5F.js";import{V as Ce,a as Z}from"./VRow-BYNV-piz.js";import{m as Pe,a as Ge,u as Ae,b as Ue,c as He,V as We}from"./filter-DYnIChvA.js";import{V as Le}from"./scopeId-DjdO45Z-.js";import{u as Oe,V as qe,e as ze}from"./VContainer-0Fnp8Tdu.js";import{e as je}from"./VCard-DzQ82eB6.js";import{b as Je,s as Ke,d as Me,e as Qe,g as Ye,u as $e,p as Xe,h as Ze,t as et,j as tt,k as at,l as ot,n as lt,q as ee,r as te,v as st}from"./VDataTable-Dzqjxh_I.js";import"./forwardRefs-C3KU5BUj.js";import"./VOverlay-B7nHBq5Y.js";import"./VList-BBXNudgl.js";import"./createSimpleFunctional-DxvAP6u2.js";import"./VDivider-CocISVKf.js";import"./VChip-BkLfS5W5.js";import"./VTextField-BF1ijta1.js";import"./form-dBftMV8D.js";import"./VCheckboxBtn-gqo5COwE.js";const rt=ye({...Je(),...Ke(),...Pe(),...Ge()},"VDataTableVirtual"),nt=be()({name:"VDataTableVirtual",props:rt(),emits:{"update:modelValue":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:groupBy":e=>!0,"update:expanded":e=>!0},setup(e,b){let{attrs:u,slots:a}=b;const{groupBy:x}=Me(e),{sortBy:v,multiSort:C,mustSort:m}=Qe(e),{disableSort:h}=xe(e),{columns:c,headers:S,filterFunctions:P,sortFunctions:V,sortRawFunctions:I}=Ye(e,{groupBy:x,showSelect:f(e,"showSelect"),showExpand:f(e,"showExpand")}),{items:G}=$e(e,c),E=f(e,"search"),{filteredItems:A}=Ae(e,G,E,{transform:i=>i.columns,customKeyFilter:P}),{toggleSort:U}=Xe({sortBy:v,multiSort:C,mustSort:m}),{sortByWithGroups:H,opened:s,extractRows:o,isGroupOpen:t,toggleGroup:d}=Ze({groupBy:x,sortBy:v,disableSort:h}),{sortedItems:W}=et(e,A,H,{transform:i=>({...i.raw,...i.columns}),sortFunctions:V,sortRawFunctions:I}),{flatItems:r}=tt(W,x,s),g=N(()=>o(r.value)),{isSelected:D,select:T,selectAll:k,toggleSelect:L,someSelected:oe,allSelected:le}=at(e,{allItems:g,currentPage:g}),{isExpanded:se,toggleExpand:re}=ot(e),{containerRef:ne,markerRef:ie,paddingTop:ue,paddingBottom:me,computedItems:ce,handleItemResize:de,handleScroll:pe,handleScrollend:ve}=Ue(e,r),fe=N(()=>ce.value.map(i=>i.raw));lt({sortBy:v,page:Y(1),itemsPerPage:Y(-1),groupBy:x,search:E}),Ve({VDataTableRows:{hideNoData:f(e,"hideNoData"),noDataText:f(e,"noDataText"),loading:f(e,"loading"),loadingText:f(e,"loadingText")}});const w=N(()=>({sortBy:v.value,toggleSort:U,someSelected:oe.value,allSelected:le.value,isSelected:D,select:T,selectAll:k,toggleSelect:L,isExpanded:se,toggleExpand:re,isGroupOpen:t,toggleGroup:d,items:g.value.map(i=>i.raw),internalItems:g.value,groupedItems:r.value,columns:c.value,headers:S.value}));Oe(()=>{const i=ee.filterProps(e),he=te.filterProps(e),ge=X.filterProps(e);return l(X,B({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},ge),{top:()=>{var p;return(p=a.top)==null?void 0:p.call(a,w.value)},wrapper:()=>{var p,J,K;return l("div",{ref:ne,onScrollPassive:pe,onScrollend:ve,class:"v-table__wrapper",style:{height:q(e.height)}},[l("table",null,[(p=a.colgroup)==null?void 0:p.call(a,w.value),!e.hideDefaultHeader&&l("thead",{key:"thead"},[l(ee,B(i,{sticky:e.fixedHeader}),a)]),!e.hideDefaultBody&&l("tbody",null,[l("tr",{ref:ie,style:{height:q(ue.value),border:0}},[l("td",{colspan:c.value.length,style:{height:0,border:0}},null)]),(J=a["body.prepend"])==null?void 0:J.call(a,w.value),l(te,B(u,he,{items:fe.value}),{...a,item:y=>l(He,{key:y.internalItem.index,renderless:!0,"onUpdate:height":O=>de(y.internalItem.index,O)},{default:O=>{var Q;let{itemRef:M}=O;return((Q=a.item)==null?void 0:Q.call(a,{...y,itemRef:M}))??l(st,B(y.props,{ref:M,key:y.internalItem.index,index:y.internalItem.index}),a)}})}),(K=a["body.append"])==null?void 0:K.call(a,w.value),l("tr",{style:{height:q(me.value),border:0}},[l("td",{colspan:c.value.length,style:{height:0,border:0}},null)])])])])},bottom:()=>{var p;return(p=a.bottom)==null?void 0:p.call(a,w.value)}})})}});async function it(){var a;const e=De(),b=ae(),u=((a=e.params.convention)==null?void 0:a.toString())||"";if(u)return await b.getConvention(u)}const St=Te({__name:"Reports",emits:["pageTitle"],async setup(e,{emit:b}){let u,a;b("pageTitle","Reports");const v=ae(),C=we(),m=R(),h=R([{Name:"Hotel",Data:[]}]),c=R(),S=R([]);try{const s=([u,a]=ke(()=>it()),u=await u,a(),u);if(s){const o=h.value.find(t=>t.Name=="Hotel");o&&(v.getHotelReport(s.ConventionUUID).then(t=>{o.Data=t}),v.getConventionVenues(s.ConventionUUID).then(t=>{S.value=t}))}}catch{C.push("/")}const P=N(()=>h.value.find(o=>o.Name===m.value)?m.value!=="Hotel"?[]:[{title:"First Name",align:"start",key:"FirstName"},{title:"Last Name",align:"start",key:"LastName"},{title:"Room Partners",align:"start",key:"Guests"},{title:"Venue",align:"start",key:"Venue"},{title:"Room Type",align:"start",key:"RoomType"},{title:"Arrival",align:"start",key:"ArrivalDay"},{title:"Departure",align:"start",key:"DepartureDay"}]:[]),V=N(()=>{const s=h.value.find(t=>t.Name===m.value);if(!s)return[];if(m.value!=="Hotel")return s.Data;const o=[];return s.Data.forEach(t=>{c.value&&t.Venue!=c.value||t.Guests.forEach((d,W)=>{const r={FirstName:"",LastName:"",Guests:"",Venue:"",Accommodation:"",RoomType:"",ArrivalDay:"",DepartureDay:""};r.FirstName=d.FirstName,r.LastName=d.LastName;const g=t.Guests.filter((k,L)=>L!==W);let D="";g.forEach(k=>{D+=k.FirstName+" "+k.LastName+","}),r.Guests=D.substring(0,D.length-1),r.Venue=t.Venue;const T=t.Accommodation.match(/\((.*?)\)/);T&&T.length>=1&&(r.Accommodation=T[1]),r.RoomType=t.RoomType,r.ArrivalDay=t.Days[0],r.DepartureDay=t.Days[t.Days.length-1],o.push(r)})}),o}),I=R(),G="data:application/vnd.ms-excel;base64,",E='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><?xml version="1.0" encoding="UTF-8" standalone="yes"?><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table>{table}</table></body></html>',A=function(s){return btoa(unescape(encodeURIComponent(s)))},U=function(s,o){return s.replace(/{(\w+)}/g,function(t,d){return o[d]})},H=s=>{var d;const o=(d=I.value)==null?void 0:d.getElementsByTagName("table")[0],t={worksheet:s||"Worksheet",table:o.innerHTML};window.location.href=G+A(U(E,t))};return(s,o)=>(F(),z(Ee,null,{default:n(()=>[l(_e,{color:"blue-darken-4"},{default:n(()=>[l(Be,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=t=>m.value=t),"show-arrows":""},{default:n(()=>[(F(!0),Re(Se,null,Ne(h.value,t=>(F(),z(Fe,{key:t.Name,value:t.Name},{default:n(()=>[_(j(t.Name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ze,{fluid:""},{default:n(()=>[l(Ce,null,{default:n(()=>[l(Z,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:n(()=>[l(We,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=t=>c.value=t),label:"Venue",items:S.value,"item-value":"Name","item-title":"Name",clearable:"",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),l(Le),l(Z,{cols:"12",sm:"5",md:"3",lg:"2",xl:"2",class:"text-right"},{default:n(()=>[l(qe,{onClick:o[2]||(o[2]=t=>H(m.value)),color:"primary","prepend-icon":"mdi:mdi-table",class:"w-100 w-sm-auto"},{default:n(()=>o[3]||(o[3]=[_(" Download Excel ")])),_:1})]),_:1})]),_:1})]),_:1}),V.value?(F(),z(je,{key:0,class:"pa-2"},{default:n(()=>[$("div",{ref_key:"reportTable",ref:I},[l(nt,{headers:P.value,items:V.value,"items-length":V.value.length},{"item.RoomType":n(({item:t})=>[_(j(t.RoomType)+" ",1),o[4]||(o[4]=$("br",null,null,-1)),_(" ("+j(t.Accommodation)+") ",1)]),_:2},1032,["headers","items","items-length"])],512)]),_:1})):Ie("",!0)]),_:1}))}});export{St as default};
