import{p as Ae,d as Fe,ab as He,t as P,c as F,s as ie,ad as Le,f as t,L as Y,m as K,i as O,R as Z,r as g,C as Be,a0 as Ge,n as w,D as Q,v as l,x as k,q as _,G as N,y as J,A as G,H as ee,P as te,N as W,M as $e,w as Me,V as We,Q as Oe}from"./index-Bppjjkrv.js";import{u as ae}from"./useConventionSlug-ByrByPI8.js";import{V as q,a as S}from"./VRow-CJPq1zcR.js";import{m as qe,u as Qe,a as ze,V as fe}from"./VSelect-BXCI52Mh.js";import{V as ge}from"./scopeId-BK4AYiro.js";import{u as je,V as A,e as ue,p as Ve}from"./VContainer-igNADG4D.js";import{b as Ye,s as Ke,d as Je,e as Xe,g as Ze,u as et,p as tt,h as at,t as lt,j as st,k as ot,l as nt,n as rt,q as de,r as me,v as it,V as ut}from"./VDataTable-C667oRpm.js";import{m as dt,u as mt}from"./filter-BR-7ZZnE.js";import{V as ce}from"./VTable-Cjgg_wrb.js";import{e as le,V as ct,a as vt,c as pt}from"./VCard-qskZ1N5P.js";import{T as ft}from"./targetType-BYfQr9gB.js";import{u as gt}from"./useEmailTemplates-DHL0DfbI.js";import{_ as Vt}from"./ModelDialog.vue_vue_type_script_setup_true_lang-o770KKBp.js";import{_ as yt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{b as ve,V as Tt}from"./forwardRefs-C2gOWZzB.js";import{a as bt,V as xt}from"./VAlert-tGJQU9On.js";import{V as X}from"./VList-3_9BdDOC.js";import{b as Ut}from"./SaveButton.vue_vue_type_script_setup_true_lang-BwXE7AU9.js";import{V as kt}from"./VSheet-CwKwC51y.js";import{a as ht,b as pe,c as wt,V as Dt}from"./VTabs-y_v9ONsv.js";import{V as Rt}from"./VToolbar-DokKeQ5q.js";import"./VTextField-DsVNvInc.js";import"./form-BKG_vvnh.js";import"./VChip-Brw53Wd1.js";import"./createSimpleFunctional-C-_8UCn7.js";import"./VDivider-DbAuEggw.js";import"./permission-Ba-8wP-4.js";import"./VDialog-CKY0ygmG.js";const It=Ae({...Ye(),...Ke(),...qe(),...dt()},"VDataTableVirtual"),Et=Fe()({name:"VDataTableVirtual",props:It(),emits:{"update:modelValue":a=>!0,"update:sortBy":a=>!0,"update:options":a=>!0,"update:groupBy":a=>!0,"update:expanded":a=>!0},setup(a,h){let{attrs:D,slots:s}=h;const{groupBy:m}=Je(a),{sortBy:v,multiSort:V,mustSort:u}=Xe(a),{disableSort:x}=He(a),{columns:p,headers:U,filterFunctions:b,sortFunctions:c,sortRawFunctions:n}=Ze(a,{groupBy:m,showSelect:P(a,"showSelect"),showExpand:P(a,"showExpand")}),{items:r}=et(a,p),T=P(a,"search"),{filteredItems:H}=mt(a,r,T,{transform:E=>E.columns,customKeyFilter:b}),{toggleSort:L}=tt({sortBy:v,multiSort:V,mustSort:u}),{sortByWithGroups:f,opened:o,extractRows:y,isGroupOpen:d,toggleGroup:e}=at({groupBy:m,sortBy:v,disableSort:x}),{sortedItems:i}=lt(a,H,f,{transform:E=>({...E.raw,...E.columns}),sortFunctions:c,sortRawFunctions:n}),{flatItems:R}=st(i,m,o),I=F(()=>y(R.value)),{isSelected:$,select:z,selectAll:ye,toggleSelect:Te,someSelected:be,allSelected:xe}=ot(a,{allItems:I,currentPage:I}),{isExpanded:Ue,toggleExpand:ke}=nt(a),{containerRef:he,markerRef:we,paddingTop:De,paddingBottom:Re,computedItems:Ie,handleItemResize:Ee,handleScroll:Ce,handleScrollend:Ne}=Qe(a,R),_e=F(()=>Ie.value.map(E=>E.raw));rt({sortBy:v,page:ie(1),itemsPerPage:ie(-1),groupBy:m,search:T}),Le({VDataTableRows:{hideNoData:P(a,"hideNoData"),noDataText:P(a,"noDataText"),loading:P(a,"loading"),loadingText:P(a,"loadingText")}});const M=F(()=>({sortBy:v.value,toggleSort:L,someSelected:be.value,allSelected:xe.value,isSelected:$,select:z,selectAll:ye,toggleSelect:Te,isExpanded:Ue,toggleExpand:ke,isGroupOpen:d,toggleGroup:e,items:I.value.map(E=>E.raw),internalItems:I.value,groupedItems:R.value,columns:p.value,headers:U.value}));je(()=>{const E=de.filterProps(a),Pe=me.filterProps(a),Se=ce.filterProps(a);return t(ce,K({class:["v-data-table",{"v-data-table--loading":a.loading},a.class],style:a.style},Se,{fixedHeader:a.fixedHeader||a.sticky}),{top:()=>{var C;return(C=s.top)==null?void 0:C.call(s,M.value)},wrapper:()=>{var C,se,oe;return t("div",{ref:he,onScrollPassive:Ce,onScrollend:Ne,class:"v-table__wrapper",style:{height:Y(a.height)}},[t("table",null,[(C=s.colgroup)==null?void 0:C.call(s,M.value),!a.hideDefaultHeader&&t("thead",{key:"thead"},[t(de,E,s)]),!a.hideDefaultBody&&t("tbody",null,[t("tr",{ref:we,style:{height:Y(De.value),border:0}},[t("td",{colspan:p.value.length,style:{height:0,border:0}},null)]),(se=s["body.prepend"])==null?void 0:se.call(s,M.value),t(me,K(D,Pe,{items:_e.value}),{...s,item:B=>t(ze,{key:B.internalItem.index,renderless:!0,"onUpdate:height":j=>Ee(B.internalItem.index,j)},{default:j=>{var re;let{itemRef:ne}=j;return((re=s.item)==null?void 0:re.call(s,{...B,itemRef:ne}))??t(it,K(B.props,{ref:ne,key:B.internalItem.index,index:B.internalItem.index}),s)}})}),(oe=s["body.append"])==null?void 0:oe.call(s,M.value),t("tr",{style:{height:Y(Re.value),border:0}},[t("td",{colspan:p.value.length,style:{height:0,border:0}},null)])])])])},bottom:()=>{var C;return(C=s.bottom)==null?void 0:C.call(s,M.value)}})})}}),Ct=O({__name:"HotelReport",emits:["pageTitle"],async setup(a,{emit:h}){let D,s;h("pageTitle","Reports");const v=te(),V=Z(),u=g([]),x=g(),p=g([]);try{const f=([D,s]=Be(()=>ae()),D=await D,s(),D);f&&(v.getHotelReport(f.ConventionUUID).then(o=>{u.value=o}),v.getConventionVenues(f.ConventionUUID).then(o=>{p.value=o}))}catch{V.push("/")}const U=F(()=>[{title:"First Name",align:"start",key:"FirstName"},{title:"Last Name",align:"start",key:"LastName"},{title:"Address",align:"start",key:"Address"},{title:"Room Partners",align:"start",key:"Guests"},{title:"Venue",align:"start",key:"Venue"},{title:"Room Type",align:"start",key:"RoomType"},{title:"Arrival",align:"start",key:"ArrivalDay"},{title:"Departure",align:"start",key:"DepartureDay"}]),b=F(()=>{const f=[];return u.value.forEach(o=>{x.value&&o.Venue!=x.value||o.Guests.forEach((y,d)=>{const e={FirstName:"",LastName:"",Guests:"",Address:"",Venue:"",Accommodation:"",RoomType:"",ArrivalDay:"",DepartureDay:""};e.FirstName=y.FirstName,e.LastName=y.LastName,e.Address=y.Address;const i=o.Guests.filter(($,z)=>z!==d);let R="";i.forEach($=>{R+=$.FirstName+" "+$.LastName+","}),e.Guests=R.substring(0,R.length-1),e.Venue=o.Venue;const I=o.Accommodation.match(/\((.*?)\)/);I&&I.length>=1&&(e.Accommodation=I[1]),e.RoomType=o.RoomType,e.ArrivalDay=o.Days[0],e.DepartureDay=o.Days[o.Days.length-1],f.push(e)})}),f}),c=Ge("reportTable"),n="data:application/vnd.ms-excel;base64,",r='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><?xml version="1.0" encoding="UTF-8" standalone="yes"?><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table>{table}</table></body></html>',T=function(f){return btoa(unescape(encodeURIComponent(f)))},H=function(f,o){return f.replace(/{(\w+)}/g,function(y,d){return o[d]})},L=f=>{var y;const o=(y=c.value)==null?void 0:y.getElementsByTagName("table")[0];if(o){const d={worksheet:f,table:o.innerHTML};window.location.href=n+T(H(r,d))}};return(f,o)=>u.value.length>0&&p.value.length>0?(w(),Q(ee,{key:0},[t(ue,{fluid:""},{default:l(()=>[t(q,null,{default:l(()=>[t(S,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:l(()=>[t(fe,{modelValue:x.value,"onUpdate:modelValue":o[0]||(o[0]=y=>x.value=y),label:"Venue",items:p.value,"item-value":"Name","item-title":"Name",clearable:"",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),t(ge),t(S,{cols:"12",sm:"5",md:"3",lg:"2",xl:"2",class:"text-right"},{default:l(()=>[t(A,{onClick:o[1]||(o[1]=y=>L("Hotel Report")),color:"primary","prepend-icon":"mdi:mdi-table",class:"w-100 w-sm-auto"},{default:l(()=>o[2]||(o[2]=[k(" Download Excel ")])),_:1})]),_:1})]),_:1})]),_:1}),b.value?(w(),_(le,{key:0,class:"pa-2"},{default:l(()=>[N("div",{ref_key:"reportTable",ref:c},[t(Et,{headers:U.value,items:b.value,"items-length":b.value.length},{"item.RoomType":l(({item:y})=>[k(J(y.RoomType)+" ",1),o[3]||(o[3]=N("br",null,null,-1)),k(" ("+J(y.Accommodation)+") ",1)]),_:2},1032,["headers","items","items-length"])],512)]),_:1})):G("",!0)],64)):(w(),_(ue,{key:1},{default:l(()=>[t(q,null,{default:l(()=>[t(S,{class:"text-center"},{default:l(()=>[t(Ve,{indeterminate:"",color:"primary",size:"100",width:"10"},{default:l(()=>o[4]||(o[4]=[k(" Loading ")])),_:1})]),_:1})]),_:1})]),_:1}))}}),Nt=["innerHTML"],_t=O({__name:"EmailPreviewWindow",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(a){const h=W(a,"modelValue");return(D,s)=>(w(),Q("div",{innerHTML:h.value,class:"reset-styles"},null,8,Nt))}}),Pt=yt(_t,[["__scopeId","data-v-662b87a6"]]),St={class:"d-flex align-center justify-center",style:{width:"calc(100vw - 25px)",height:"100vh"}},At=O({__name:"EmailControl",props:$e({modelType:{default:"user"}},{modelValue:{default:[]},modelModifiers:{},details:{required:!1},detailsModifiers:{},convention:{required:!1,default:async()=>await ae()},conventionModifiers:{},organisation:{required:!1,default:void 0},organisationModifiers:{}}),emits:["update:modelValue","update:details","update:convention","update:organisation"],setup(a){const h=te(),{getEmailTemplateList:D}=gt(),s=g([]),m=g(),v=W(a,"modelValue"),V=W(a,"details"),u=W(a,"convention"),x=W(a,"organisation"),p=g(0),U=g([]),b=g(!1),c=g(!1),n=g(0),r=g(0),T=g([]),H=()=>{var d,e;D(ft.TARGET_TYPE_CONVENTION,((d=x.value)==null?void 0:d.OrganisationUUID)||null,((e=u.value)==null?void 0:e.ConventionUUID)||null).then(i=>{s.value=i})};Me(u,()=>{H()}),H();const L=d=>{var i;const e={};return a.modelType=="registration"?e.RegistrationUUID=d:a.modelType=="submission"?e.SubmissionUUID=d:e.UserUUID=d,u.value&&(e.ConventionUUID=u.value.ConventionUUID),x.value&&(e.OrganisationUUID=x.value.OrganisationUUID),m.value&&(m.value.IsDefault?e.TemplateName=m.value.Name:((i=m.value)==null?void 0:i.EmailTemplateUUID)!==We?e.TemplateUUID=m.value.EmailTemplateUUID:e.Template=m.value),e},f=()=>{U.value=[],v.value.forEach(d=>{const e=L(d);h.previewEmailTemplate(e).then(i=>{U.value.push(i)})}),b.value=!0};function o(d){return new Promise(e=>setTimeout(e,d))}const y=async()=>{c.value=!0,n.value=0,r.value=0,T.value=[];for(const d of v.value){const e=L(d);try{await h.sendEmailTemplate(e)}catch{if(e.RegistrationUUID&&V.value&&V.value.length>0){const R=V.value.find(I=>I.RegistrationUUID==e.RegistrationUUID);R?T.value.push(`Failed to send to: #${R.Reference} - ${R.Name}`):T.value.push(`Failed to send to: UUID ${e.RegistrationUUID}`)}else T.value.push(`Failed to send to: UUID ${e.RegistrationUUID}`)}await o(50),n.value+=1,r.value=n.value/v.value.length*100}c.value=!1};return(d,e)=>v.value.length>0?(w(),Q(ee,{key:0},[t(q,null,{default:l(()=>[t(S,null,{default:l(()=>e[7]||(e[7]=[N("h2",null,"E-Mail",-1),N("p",null," Select an e-mail template to send bulk e-mails to selected registrations. You may preview what is sent before queuing it. ",-1)])),_:1})]),_:1}),t(q,null,{default:l(()=>[t(S,{cols:"12",sm:"7"},{default:l(()=>[t(fe,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=i=>m.value=i),items:s.value,"item-value":i=>i,"item-title":"Title","hide-details":"",clearable:""},null,8,["modelValue","items","item-value"])]),_:1}),t(S,{cols:"6",sm:"3"},{default:l(()=>[t(A,{color:"primary",disabled:!m.value,onClick:f,class:"w-100"},{default:l(()=>e[8]||(e[8]=[k(" Preview ")])),_:1},8,["disabled"])]),_:1}),t(S,{cols:"6",sm:"2",class:"text-right text-sm-left"},{default:l(()=>[t(A,{color:"success",disabled:!m.value,onClick:y,class:"w-100"},{default:l(()=>e[9]||(e[9]=[k(" Send ")])),_:1},8,["disabled"])]),_:1})]),_:1}),T.value.length?(w(),_(xt,{key:0,color:"error",class:"mt-4"},{default:l(()=>[t(bt,null,{default:l(()=>e[10]||(e[10]=[k("Errors Encountered")])),_:1}),t(X,{items:T.value,class:"mt-4 rounded"},null,8,["items"])]),_:1})):G("",!0),t(Ut,{modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=i=>c.value=i),"scroll-strategy":"block","location-strategy":"static","close-on-content-click":!1},{default:l(()=>[N("div",St,[e[13]||(e[13]=k(" > ")),t(le,{class:"ma-0",bordered:""},{default:l(()=>[t(ct,null,{default:l(()=>[t(vt,{class:"text-center"},{default:l(()=>e[11]||(e[11]=[N("small",null,"Sending Emails",-1)])),_:1})]),_:1}),t(pt,{class:"text-center"},{default:l(()=>[t(Ve,{modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=i=>r.value=i),color:"error",size:"60",width:"8"},null,8,["modelValue"]),e[12]||(e[12]=N("p",{class:"my-4"}," Navigating away will prevent emails from sending. ",-1)),T.value.length?(w(),_(X,{key:0,items:T.value},null,8,["items"])):G("",!0)]),_:1})]),_:1})])]),_:1},8,["modelValue"]),t(Vt,{modelValue:b.value,"onUpdate:modelValue":e[6]||(e[6]=i=>b.value=i),fullscreen:!1,"hide-details":!0,title:"Email Preview",scrollable:!0},{actions:l(()=>[t(ve,null,{default:l(()=>[t(A,{color:"primary",disabled:p.value==0,onClick:e[3]||(e[3]=i=>p.value-=1)},{default:l(()=>e[14]||(e[14]=[k(" Previous ")])),_:1},8,["disabled"])]),_:1}),t(ge),t(ve,null,{default:l(()=>[t(A,{color:"primary",disabled:p.value==U.value.length-1,onClick:e[4]||(e[4]=i=>p.value+=1)},{default:l(()=>e[15]||(e[15]=[k(" Next ")])),_:1},8,["disabled"])]),_:1})]),default:l(()=>[U.value.length>0&&U.value[p.value]?(w(),_(Pt,{key:0,modelValue:U.value[p.value].HTML,"onUpdate:modelValue":e[5]||(e[5]=i=>U.value[p.value].HTML=i)},null,8,["modelValue"])):G("",!0)]),_:1},8,["modelValue"])],64)):G("",!0)}}),Ft={class:"flex-grow-1"},Ht=O({__name:"TicketReport",emits:["pageTitle"],setup(a,{emit:h}){h("pageTitle","Reports");const s=te(),m=Z(),v=g(),V=g([]),u=g([]),x=g(!0),p=()=>{try{ae().then(c=>{c&&(v.value=c,s.getTicketReport(v.value.ConventionUUID).then(n=>{V.value=n,x.value=!1}))})}catch{m.push("/")}},U=F(()=>[{title:"",align:"start",key:"checkbox"},{title:"Reference",align:"start",key:"Reference"},{title:"Name",align:"start",key:"Name"},{title:"Ticket",align:"start",key:"Ticket"},{title:"QR Code",align:"start",key:"QRCode"}]),b=F(()=>V.value?V.value.map(c=>({RegistrationUUID:c.RegistrationUUID,Reference:c.Reference,Name:c.Name,Ticket:c.Ticket.map(r=>r.Name),QRCode:c.QRCode})):[]);return p(),(c,n)=>v.value&&V.value?(w(),_(le,{key:0,class:"pa-2"},{default:l(()=>[t(ut,{modelValue:u.value,"onUpdate:modelValue":n[2]||(n[2]=r=>u.value=r),headers:U.value,items:b.value,"item-value":"RegistrationUUID","show-select":"",loading:x.value},{"item.Ticket":l(({item:r})=>[t(X,{items:r.Ticket},null,8,["items"])]),"item.QRCode":l(({item:r})=>[t(Tt,{src:r.QRCode,alt:r.Reference},null,8,["src","alt"])]),"footer.prepend":l(()=>[N("div",Ft,[t(A,{variant:"text",color:"primary",onClick:n[0]||(n[0]=r=>u.value=b.value.map(T=>T.RegistrationUUID))},{default:l(()=>n[6]||(n[6]=[k(" (Select all on every page) ")])),_:1}),t(A,{variant:"text",color:"primary",onClick:n[1]||(n[1]=r=>u.value=[])},{default:l(()=>n[7]||(n[7]=[k(" (Unselect all on every page) ")])),_:1})])]),_:2},1032,["modelValue","headers","items","loading"]),t(At,{modelValue:u.value,"onUpdate:modelValue":n[3]||(n[3]=r=>u.value=r),details:b.value,"onUpdate:details":n[4]||(n[4]=r=>b.value=r),"model-type":"registration",convention:v.value,"onUpdate:convention":n[5]||(n[5]=r=>v.value=r)},null,8,["modelValue","details","convention"])]),_:1})):G("",!0)}}),ca=O({__name:"Reports",emits:["pageTitle"],setup(a,{emit:h}){h("pageTitle","Reports"),Z();const s=g("Hotel"),m=g(["Hotel","Tickets"]);return(v,V)=>(w(),_(kt,null,{default:l(()=>[t(Rt,{color:"blue-darken-4"},{default:l(()=>[t(ht,{modelValue:s.value,"onUpdate:modelValue":V[0]||(V[0]=u=>s.value=u),"show-arrows":""},{default:l(()=>[(w(!0),Q(ee,null,Oe(m.value,u=>(w(),_(Dt,null,{default:l(()=>[k(J(u),1)]),_:2},1024))),256))]),_:1},8,["modelValue"])]),_:1}),t(wt,{modelValue:s.value,"onUpdate:modelValue":V[1]||(V[1]=u=>s.value=u)},{default:l(()=>[t(pe,{value:"Hotel"},{default:l(()=>[t(Ct)]),_:1}),t(pe,{value:"Tickets"},{default:l(()=>[t(Ht)]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{ca as default};
