import{p as ye,d as be,a7 as xe,t as f,c as N,s as J,a9 as Ve,f as l,L as q,m as C,U as De,P as ae,i as Te,r as R,C as ke,q as z,v as n,R as we,n as _,D as Re,Q as Ne,H as Se,x as B,G as X,y as j,A as Ie}from"./index-FxmlW5zV.js";import{V as Y,a as Ee}from"./VTable-q67WtlrN.js";import{a as Ce,V as _e}from"./VTabs-D_Ja2bsR.js";import{V as Be}from"./VToolbar-Ok8wwxH0.js";import{V as Fe,a as Z}from"./VRow-lGjmVsai.js";import{m as Ge,a as Pe,u as Ue,b as Ae,c as He,V as We}from"./filter-lJuFbPbI.js";import{V as Le}from"./scopeId-DIwfd5MI.js";import{u as Oe,V as qe,e as ze}from"./VContainer-DI__1DxU.js";import{e as je}from"./VCard-DojOZbAm.js";import{b as Ke,s as Me,d as Qe,e as $e,g as Je,u as Xe,p as Ye,h as Ze,t as et,j as tt,k as at,l as ot,n as lt,q as ee,r as te,v as st}from"./VDataTable-CJMQxeyQ.js";import"./forwardRefs-eETTs2OE.js";import"./VOverlay-CvyUcxRh.js";import"./VList-C1UxxvK8.js";import"./createSimpleFunctional-CHcR6aXl.js";import"./VDivider-ZcqsG1Jq.js";import"./VChip-B2JV4aHF.js";import"./VTextField-DRCp0z1p.js";import"./form-CgSGftDi.js";import"./VCheckboxBtn-DiqW-hDf.js";const rt=ye({...Ke(),...Me(),...Ge(),...Pe()},"VDataTableVirtual"),nt=be()({name:"VDataTableVirtual",props:rt(),emits:{"update:modelValue":e=>!0,"update:sortBy":e=>!0,"update:options":e=>!0,"update:groupBy":e=>!0,"update:expanded":e=>!0},setup(e,b){let{attrs:u,slots:a}=b;const{groupBy:x}=Qe(e),{sortBy:v,multiSort:F,mustSort:m}=$e(e),{disableSort:h}=xe(e),{columns:c,headers:S,filterFunctions:G,sortFunctions:V,sortRawFunctions:I}=Je(e,{groupBy:x,showSelect:f(e,"showSelect"),showExpand:f(e,"showExpand")}),{items:P}=Xe(e,c),E=f(e,"search"),{filteredItems:U}=Ue(e,P,E,{transform:i=>i.columns,customKeyFilter:G}),{toggleSort:A}=Ye({sortBy:v,multiSort:F,mustSort:m}),{sortByWithGroups:H,opened:s,extractRows:o,isGroupOpen:t,toggleGroup:d}=Ze({groupBy:x,sortBy:v,disableSort:h}),{sortedItems:W}=et(e,U,H,{transform:i=>({...i.raw,...i.columns}),sortFunctions:V,sortRawFunctions:I}),{flatItems:r}=tt(W,x,s),g=N(()=>o(r.value)),{isSelected:D,select:T,selectAll:k,toggleSelect:L,someSelected:oe,allSelected:le}=at(e,{allItems:g,currentPage:g}),{isExpanded:se,toggleExpand:re}=ot(e),{containerRef:ne,markerRef:ie,paddingTop:ue,paddingBottom:me,computedItems:ce,handleItemResize:de,handleScroll:pe,handleScrollend:ve}=Ae(e,r),fe=N(()=>ce.value.map(i=>i.raw));lt({sortBy:v,page:J(1),itemsPerPage:J(-1),groupBy:x,search:E}),Ve({VDataTableRows:{hideNoData:f(e,"hideNoData"),noDataText:f(e,"noDataText"),loading:f(e,"loading"),loadingText:f(e,"loadingText")}});const w=N(()=>({sortBy:v.value,toggleSort:A,someSelected:oe.value,allSelected:le.value,isSelected:D,select:T,selectAll:k,toggleSelect:L,isExpanded:se,toggleExpand:re,isGroupOpen:t,toggleGroup:d,items:g.value.map(i=>i.raw),internalItems:g.value,groupedItems:r.value,columns:c.value,headers:S.value}));Oe(()=>{const i=ee.filterProps(e),he=te.filterProps(e),ge=Y.filterProps(e);return l(Y,C({class:["v-data-table",{"v-data-table--loading":e.loading},e.class],style:e.style},ge),{top:()=>{var p;return(p=a.top)==null?void 0:p.call(a,w.value)},wrapper:()=>{var p,K,M;return l("div",{ref:ne,onScrollPassive:pe,onScrollend:ve,class:"v-table__wrapper",style:{height:q(e.height)}},[l("table",null,[(p=a.colgroup)==null?void 0:p.call(a,w.value),!e.hideDefaultHeader&&l("thead",{key:"thead"},[l(ee,C(i,{sticky:e.fixedHeader}),a)]),!e.hideDefaultBody&&l("tbody",null,[l("tr",{ref:ie,style:{height:q(ue.value),border:0}},[l("td",{colspan:c.value.length,style:{height:0,border:0}},null)]),(K=a["body.prepend"])==null?void 0:K.call(a,w.value),l(te,C(u,he,{items:fe.value}),{...a,item:y=>l(He,{key:y.internalItem.index,renderless:!0,"onUpdate:height":O=>de(y.internalItem.index,O)},{default:O=>{var $;let{itemRef:Q}=O;return(($=a.item)==null?void 0:$.call(a,{...y,itemRef:Q}))??l(st,C(y.props,{ref:Q,key:y.internalItem.index,index:y.internalItem.index}),a)}})}),(M=a["body.append"])==null?void 0:M.call(a,w.value),l("tr",{style:{height:q(me.value),border:0}},[l("td",{colspan:c.value.length,style:{height:0,border:0}},null)])])])])},bottom:()=>{var p;return(p=a.bottom)==null?void 0:p.call(a,w.value)}})})}});async function it(){var a;const e=De(),b=ae(),u=((a=e.params.convention)==null?void 0:a.toString())||"";if(u)return await b.getConvention(u)}const St=Te({__name:"Reports",emits:["pageTitle"],async setup(e,{emit:b}){let u,a;b("pageTitle","Reports");const v=ae(),F=we(),m=R(),h=R([{Name:"Hotel",Data:[]}]),c=R(),S=R([]);try{const s=([u,a]=ke(()=>it()),u=await u,a(),u);if(s){const o=h.value.find(t=>t.Name=="Hotel");o&&(v.getHotelReport(s.ConventionUUID).then(t=>{o.Data=t}),v.getConventionVenues(s.ConventionUUID).then(t=>{S.value=t}))}}catch{F.push("/")}const G=N(()=>h.value.find(o=>o.Name===m.value)?m.value!=="Hotel"?[]:[{title:"First Name",align:"start",key:"FirstName"},{title:"Last Name",align:"start",key:"LastName"},{title:"Room Partners",align:"start",key:"Guests"},{title:"Venue",align:"start",key:"Venue"},{title:"Room Type",align:"start",key:"RoomType"},{title:"Arrival",align:"start",key:"ArrivalDay"},{title:"Departure",align:"start",key:"DepartureDay"}]:[]),V=N(()=>{const s=h.value.find(t=>t.Name===m.value);if(!s)return[];if(m.value!=="Hotel")return s.Data;const o=[];return s.Data.forEach(t=>{c.value&&t.Venue!=c.value||t.Guests.forEach((d,W)=>{const r={FirstName:"",LastName:"",Guests:"",Venue:"",Accommodation:"",RoomType:"",ArrivalDay:"",DepartureDay:""};r.FirstName=d.FirstName,r.LastName=d.LastName;const g=t.Guests.filter((k,L)=>L!==W);let D="";g.forEach(k=>{D+=k.FirstName+" "+k.LastName+","}),r.Guests=D.substring(0,D.length-1),r.Venue=t.Venue;const T=t.Accommodation.match(/\((.*?)\)/);T&&T.length>=1&&(r.Accommodation=T[1]),r.RoomType=t.RoomType,r.ArrivalDay=t.Days[0],r.DepartureDay=t.Days[t.Days.length-1],o.push(r)})}),o}),I=R(),P="data:application/vnd.ms-excel;base64,",E='<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><!--[if gte mso 9]><?xml version="1.0" encoding="UTF-8" standalone="yes"?><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>{worksheet}</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--><meta http-equiv="content-type" content="text/plain; charset=UTF-8"/></head><body><table>{table}</table></body></html>',U=function(s){return btoa(unescape(encodeURIComponent(s)))},A=function(s,o){return s.replace(/{(\w+)}/g,function(t,d){return o[d]})},H=s=>{var d;const o=(d=I.value)==null?void 0:d.getElementsByTagName("table")[0],t={worksheet:s||"Worksheet",table:o.innerHTML};window.location.href=P+U(A(E,t))};return(s,o)=>(_(),z(Ee,null,{default:n(()=>[l(Be,{color:"blue-darken-4"},{default:n(()=>[l(Ce,{modelValue:m.value,"onUpdate:modelValue":o[0]||(o[0]=t=>m.value=t),"show-arrows":""},{default:n(()=>[(_(!0),Re(Se,null,Ne(h.value,t=>(_(),z(_e,{key:t.Name,value:t.Name},{default:n(()=>[B(j(t.Name),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(ze,{fluid:""},{default:n(()=>[l(Fe,null,{default:n(()=>[l(Z,{cols:"12",sm:"6",md:"4",lg:"3",xl:"2"},{default:n(()=>[l(We,{modelValue:c.value,"onUpdate:modelValue":o[1]||(o[1]=t=>c.value=t),label:"Venue",items:S.value,"item-value":"Name","item-title":"Name",clearable:"",variant:"outlined","hide-details":""},null,8,["modelValue","items"])]),_:1}),l(Le),l(Z,{cols:"12",sm:"5",md:"3",lg:"2",xl:"2",class:"text-right"},{default:n(()=>[l(qe,{onClick:o[2]||(o[2]=t=>H(m.value)),color:"primary","prepend-icon":"mdi:mdi-table",class:"w-100 w-sm-auto"},{default:n(()=>o[3]||(o[3]=[B(" Download Excel ")])),_:1})]),_:1})]),_:1})]),_:1}),V.value?(_(),z(je,{key:0,class:"pa-2"},{default:n(()=>[X("div",{ref_key:"reportTable",ref:I},[l(nt,{headers:G.value,items:V.value,"items-length":V.value.length},{"item.RoomType":n(({item:t})=>[B(j(t.RoomType)+" ",1),o[4]||(o[4]=X("br",null,null,-1)),B(" ("+j(t.Accommodation)+") ",1)]),_:2},1032,["headers","items","items-length"])],512)]),_:1})):Ie("",!0)]),_:1}))}});export{St as default};
